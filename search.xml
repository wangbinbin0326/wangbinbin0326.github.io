<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[ORACLE简单易懂之Rman备份恢复概念]]></title>
      <url>http://wangbinbin0326.github.io/2017/01/20/ORACLE%E7%AE%80%E5%8D%95%E6%98%93%E6%87%82%E4%B9%8BRman%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%A6%82%E5%BF%B5/</url>
      <content type="html"><![CDATA[<h3 id="8-1-Rman恢复的概念"><a href="#8-1-Rman恢复的概念" class="headerlink" title="8.1 Rman恢复的概念"></a>8.1 Rman恢复的概念</h3><h4 id="8-1-1-Restore-和-Recovery的区别"><a href="#8-1-1-Restore-和-Recovery的区别" class="headerlink" title="8.1.1 Restore 和 Recovery的区别"></a>8.1.1 Restore 和 Recovery的区别</h4><blockquote>
<p><strong>Restoration</strong>: A corrupted data file is overwritten from a backup of the data file .The data file is at a prior point of time than the current database.</p>
<p><strong>Recovery</strong>: Recovery applies the changes to the individual blocks,using archive and redo information,to move the database forward to the current point in time.</p>
<p>从原理上解释，Restore是使用备份文件，将数据库还原到过去的某个状态。</p>
<p>Recovery是使用redo日志和归档日志将数据库向前恢复，一步步的恢复到现在这个时点。</p>
<p><strong>举个例子。</strong><br>某生产环境的数据库，每天凌晨一点会作一次备份。某天下午两点时数据库文件损害，同时数据库宕机。<br>接着DBA开始恢复数据库。</p>
<p>1.首先,使用最近一次的备份文件还原数据库到当天凌晨一点的状态。但是凌晨一点到下午两点的数据丢失了。<br>2.接着,使用redo日志和归档日志，把当天凌晨一点开始的数据库操作重做一遍，直到下午两点数据库宕机前。<br>这样数据库就一点都不差的被恢复起来了。</p>
</blockquote>
<a id="more"></a>
<blockquote>
<p><strong>操作步骤</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">#设置表空间为offline</div><div class="line">RMAN&gt; SQL &apos;alter tablespace tab01 offline immediate&apos;;</div><div class="line"></div><div class="line">sql statement: alter tablespace tab01 offline immediate</div><div class="line"></div><div class="line">#Restore还原物理文件</div><div class="line">RMAN&gt; restore tablespace tab01;</div><div class="line"></div><div class="line">Starting restore at 30-DEC-16</div><div class="line">using channel ORA_DISK_1</div><div class="line"></div><div class="line">skipping datafile 5; already restored to file /home/oracle/app/oracle/oradata/mmpdb3/tab01.dbf</div><div class="line">restore not done; all files read only, offline, or already restored</div><div class="line">Finished restore at 30-DEC-16</div><div class="line"></div><div class="line">#Recover恢复数据</div><div class="line">RMAN&gt; recover tablespace tab01;</div><div class="line"></div><div class="line">Starting recover at 30-DEC-16</div><div class="line">using channel ORA_DISK_1</div><div class="line">channel ORA_DISK_1: starting incremental datafile backup set restore</div><div class="line">channel ORA_DISK_1: specifying datafile(s) to restore from backup set</div><div class="line">destination for restore of datafile 00005: /home/oracle/app/oracle/oradata/mmpdb3/tab01.dbf</div><div class="line">channel ORA_DISK_1: reading from backup piece /home/oracle/dbbak/rman/mmpdb3_level_1_database_MMPDB3_20161229_328</div><div class="line">channel ORA_DISK_1: piece handle=/home/oracle/dbbak/rman/mmpdb3_level_1_database_MMPDB3_20161229_328 tag=TAG20161229T230036</div><div class="line">channel ORA_DISK_1: restored backup piece 1</div><div class="line">channel ORA_DISK_1: restore complete, elapsed time: 00:00:07</div><div class="line"></div><div class="line">starting media recovery</div><div class="line">media recovery complete, elapsed time: 00:00:00</div><div class="line"></div><div class="line">Finished recover at 30-DEC-16</div><div class="line"></div><div class="line">#设置表空间为online</div><div class="line">RMAN&gt; SQL &apos;alter tablespace tab01 online&apos;;</div><div class="line"></div><div class="line">sql statement: alter tablespace tab01 online</div></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="8-1-2-数据文件恢复–nologging创建表"><a href="#8-1-2-数据文件恢复–nologging创建表" class="headerlink" title="8.1.2 数据文件恢复–nologging创建表"></a>8.1.2 数据文件恢复–nologging创建表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div></pre></td><td class="code"><pre><div class="line">#对数据库在20170101做0级zhen备份</div><div class="line">RMAN&gt; list backup tag TAG20170101T230014;</div><div class="line">BS Key  Type LV Size       Device Type Elapsed Time Completion Time</div><div class="line">------- ---- -- ---------- ----------- ------------ ---------------</div><div class="line">101223  Incr 0  2.65G      DISK        00:01:24     01-JAN-17</div><div class="line">        BP Key: 101230   Status: AVAILABLE  Compressed: NO  Tag: TAG20170101T230014</div><div class="line">        Piece Name: /home/oracle/dbbak/rman/mmpdb3_level_0_database_MMPDB3_20170101_350</div><div class="line">  List of Datafiles in backup set 101223</div><div class="line">  File LV Type Ckp SCN    Ckp Time  Name</div><div class="line">  ---- -- ---- ---------- --------- ----</div><div class="line">  1    0  Incr 6243420    01-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/system01.dbf</div><div class="line">  2    0  Incr 6243420    01-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/sysaux01.dbf</div><div class="line">  3    0  Incr 6243420    01-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/undotbs01.dbf</div><div class="line">  4    0  Incr 6243420    01-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/users01.dbf</div><div class="line">  5    0  Incr 6243420    01-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/bak/tab01.dbf</div><div class="line">  6    0  Incr 6243420    01-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/tab02.dbf</div><div class="line">  7    0  Incr 6243420    01-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/tab03.dbf</div><div class="line"></div><div class="line">#对数据库在20170102做1级差异增量备份</div><div class="line">BS Key  Type LV Size       Device Type Elapsed Time Completion Time</div><div class="line">------- ---- -- ---------- ----------- ------------ ---------------</div><div class="line">102676  Incr 1  90.34M     DISK        00:00:02     02-JAN-17</div><div class="line">        BP Key: 102682   Status: AVAILABLE  Compressed: NO  Tag: TAG20170102T230015</div><div class="line">        Piece Name: /home/oracle/dbbak/rman/mmpdb3_level_1_database_MMPDB3_20170102_354</div><div class="line">  List of Datafiles in backup set 102676</div><div class="line">  File LV Type Ckp SCN    Ckp Time  Name</div><div class="line">  ---- -- ---- ---------- --------- ----</div><div class="line">  1    1  Incr 6324265    02-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/system01.dbf</div><div class="line">  2    1  Incr 6324265    02-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/sysaux01.dbf</div><div class="line">  3    1  Incr 6324265    02-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/undotbs01.dbf</div><div class="line">  4    1  Incr 6324265    02-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/users01.dbf</div><div class="line">  5    1  Incr 6324265    02-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/bak/tab01.dbf</div><div class="line">  6    1  Incr 6324265    02-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/tab02.dbf</div><div class="line">  7    1  Incr 6324265    02-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/tab03.dbf</div><div class="line"></div><div class="line">#对数据库在20170103做1级差异增量备份</div><div class="line">BS Key  Type LV Size       Device Type Elapsed Time Completion Time</div><div class="line">------- ---- -- ---------- ----------- ------------ ---------------</div><div class="line">104200  Incr 1  91.21M     DISK        00:00:02     03-JAN-17</div><div class="line">        BP Key: 104206   Status: AVAILABLE  Compressed: NO  Tag: TAG20170103T230015</div><div class="line">        Piece Name: /home/oracle/dbbak/rman/mmpdb3_level_1_database_MMPDB3_20170103_358</div><div class="line">  List of Datafiles in backup set 104200</div><div class="line">  File LV Type Ckp SCN    Ckp Time  Name</div><div class="line">  ---- -- ---- ---------- --------- ----</div><div class="line">  1    1  Incr 6405618    03-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/system01.dbf</div><div class="line">  2    1  Incr 6405618    03-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/sysaux01.dbf</div><div class="line">  3    1  Incr 6405618    03-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/undotbs01.dbf</div><div class="line">  4    1  Incr 6405618    03-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/users01.dbf</div><div class="line">  5    1  Incr 6405618    03-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/bak/tab01.dbf</div><div class="line">  6    1  Incr 6405618    03-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/tab02.dbf</div><div class="line">  7    1  Incr 6405618    03-JAN-17 /home/oracle/app/oracle/oradata/mmpdb3/tab03.dbf</div><div class="line"></div><div class="line">#对数据库在20170104创建表mp.t170104_2 nologging</div><div class="line">SQL&gt; variable redo number;</div><div class="line">SQL&gt;</div><div class="line">SQL&gt; execute :redo :=get_stat_val(&apos;redo size&apos;);</div><div class="line"></div><div class="line">SQL&gt; create table mp.t170104_2 nologging as select * from mp.objects;</div><div class="line"></div><div class="line">Table created.</div><div class="line"></div><div class="line">#查看redo size</div><div class="line">SQL&gt; exec dbms_output.put_line((get_stat_val(&apos;redo size&apos;)-:redo) || &apos; byte of redo....&apos;);</div><div class="line">325836 byte of redo....</div><div class="line"></div><div class="line">#模拟删除数据文件</div><div class="line">[root@hzvscmdb bak]# ll</div><div class="line">-rw-r----- 1 oracle oinstall 2313428992 Jan  4 07:12 tab01.dbf-bak</div><div class="line"></div><div class="line">#还原数据库，恢复数据</div><div class="line">RMAN&gt; sql &apos;alter database datafile 5 offline&apos;;</div><div class="line"></div><div class="line">starting full resync of recovery catalog</div><div class="line">full resync complete</div><div class="line">sql statement: alter database datafile 5 offline</div><div class="line"></div><div class="line">RMAN&gt; restore datafile 5;</div><div class="line"></div><div class="line">Starting restore at 04-JAN-17</div><div class="line">using channel ORA_DISK_1</div><div class="line"></div><div class="line">channel ORA_DISK_1: starting datafile backup set restore</div><div class="line">channel ORA_DISK_1: specifying datafile(s) to restore from backup set</div><div class="line">channel ORA_DISK_1: restoring datafile 00005 to /home/oracle/app/oracle/oradata/mmpdb3/bak/tab01.dbf</div><div class="line">channel ORA_DISK_1: reading from backup piece /home/oracle/dbbak/rman/mmpdb3_level_0_database_MMPDB3_20170101_350</div><div class="line">channel ORA_DISK_1: piece handle=/home/oracle/dbbak/rman/mmpdb3_level_0_database_MMPDB3_20170101_350 tag=TAG20170101T230014</div><div class="line">channel ORA_DISK_1: restored backup piece 1</div><div class="line">channel ORA_DISK_1: restore complete, elapsed time: 00:00:55</div><div class="line">Finished restore at 04-JAN-17</div><div class="line"></div><div class="line">RMAN&gt; recover datafile 5;</div><div class="line"></div><div class="line">Starting recover at 04-JAN-17</div><div class="line">using channel ORA_DISK_1</div><div class="line">channel ORA_DISK_1: starting incremental datafile backup set restore</div><div class="line">channel ORA_DISK_1: specifying datafile(s) to restore from backup set</div><div class="line">destination for restore of datafile 00005: /home/oracle/app/oracle/oradata/mmpdb3/bak/tab01.dbf</div><div class="line">channel ORA_DISK_1: reading from backup piece /home/oracle/dbbak/rman/mmpdb3_level_1_database_MMPDB3_20170102_354</div><div class="line">channel ORA_DISK_1: piece handle=/home/oracle/dbbak/rman/mmpdb3_level_1_database_MMPDB3_20170102_354 tag=TAG20170102T230015</div><div class="line">channel ORA_DISK_1: restored backup piece 1</div><div class="line">channel ORA_DISK_1: restore complete, elapsed time: 00:00:01</div><div class="line">channel ORA_DISK_1: starting incremental datafile backup set restore</div><div class="line">channel ORA_DISK_1: specifying datafile(s) to restore from backup set</div><div class="line">destination for restore of datafile 00005: /home/oracle/app/oracle/oradata/mmpdb3/bak/tab01.dbf</div><div class="line">channel ORA_DISK_1: reading from backup piece /home/oracle/dbbak/rman/mmpdb3_level_1_database_MMPDB3_20170103_358</div><div class="line">channel ORA_DISK_1: piece handle=/home/oracle/dbbak/rman/mmpdb3_level_1_database_MMPDB3_20170103_358 tag=TAG20170103T230015</div><div class="line">channel ORA_DISK_1: restored backup piece 1</div><div class="line">channel ORA_DISK_1: restore complete, elapsed time: 00:00:01</div><div class="line"></div><div class="line">starting media recovery</div><div class="line"></div><div class="line">........</div><div class="line">........</div><div class="line"></div><div class="line">media recovery complete, elapsed time: 00:00:48</div><div class="line">Finished recover at 04-JAN-17</div><div class="line">starting full resync of recovery catalog</div><div class="line">full resync complete</div><div class="line"></div><div class="line">RMAN&gt; sql &apos;alter database datafile 5 online&apos;;</div><div class="line"></div><div class="line">sql statement: alter database datafile 5 online</div><div class="line"></div><div class="line">[root@hzvscmdb bak]# ll</div><div class="line">total 4518424</div><div class="line">-rw-r----- 1 oracle oinstall 2313428992 Jan  4 07:17 tab01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall 2313428992 Jan  4 07:12 tab01.dbf-bak</div><div class="line"></div><div class="line">SQL&gt; select count(*) from mp.t170104_2;</div><div class="line">select count(*) from mp.t170104_2</div><div class="line">*</div><div class="line">ERROR at line 1:</div><div class="line">ORA-01578: ORACLE data block corrupted (file # 5, block # 208651)</div><div class="line">ORA-01110: data file 5: &apos;/home/oracle/app/oracle/oradata/mmpdb3/bak/tab01.dbf&apos;</div><div class="line">ORA-26040: Data block was loaded using the NOLOGGING option</div><div class="line"></div><div class="line">SQL&gt; select count(*) from mp.t170104_1;</div><div class="line"></div><div class="line">  COUNT(*)</div><div class="line">----------</div><div class="line">   3619650</div><div class="line">   </div><div class="line">ORA-26040: Data block was loaded using the NOLOGGING option</div><div class="line"></div><div class="line"></div><div class="line">Cause: Trying to access data in block that was loaded without redo generation using the NOLOGGING/UNRECOVERABLE option</div><div class="line"></div><div class="line">Action: Drop the object containing the block.</div></pre></td></tr></table></figure>
<h4 id="8-1-3-恢复初始化参数文件spfile"><a href="#8-1-3-恢复初始化参数文件spfile" class="headerlink" title="8.1.3 恢复初始化参数文件spfile"></a>8.1.3 恢复初始化参数文件spfile</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line">[root@hzvscmdb dbs]# mv spfilemmpdb3.ora spfilemmpdb3.ora-bak</div><div class="line"></div><div class="line">SQL&gt; startup;</div><div class="line">ORA-01078: failure in processing system parameters</div><div class="line">LRM-00109: could not open parameter file &apos;/home/oracle/app/oracle/product/11.2.0/dbhome_1/dbs/initmmpdb3.ora&apos;</div><div class="line">SQL&gt;</div><div class="line"></div><div class="line">[oracle@hzvscmdb 2017_01_10]$ rman target / catalog rmanmmp/pass@rmanmmpcatalog</div><div class="line"></div><div class="line">Recovery Manager: Release 11.2.0.2.0 - Production on Wed Jan 11 05:13:20 2017</div><div class="line"></div><div class="line">Copyright (c) 1982, 2009, Oracle and/or its affiliates.  All rights reserved.</div><div class="line"></div><div class="line">connected to target database (not started)</div><div class="line">connected to recovery catalog database</div><div class="line"></div><div class="line">RMAN&gt; startup nomount;</div><div class="line"></div><div class="line">startup failed: ORA-01078: failure in processing system parameters</div><div class="line">LRM-00109: could not open parameter file &apos;/home/oracle/app/oracle/product/11.2.0/dbhome_1/dbs/initmmpdb3.ora&apos;</div><div class="line"></div><div class="line">starting Oracle instance without parameter file for retrieval of spfile</div><div class="line">Oracle instance started</div><div class="line"></div><div class="line">Total System Global Area     158662656 bytes</div><div class="line"></div><div class="line">Fixed Size                     2224584 bytes</div><div class="line">Variable Size                100666936 bytes</div><div class="line">Database Buffers              50331648 bytes</div><div class="line">Redo Buffers                   5439488 bytes</div><div class="line"></div><div class="line">RMAN&gt; restore spfile from autobackup;</div><div class="line"></div><div class="line">Starting restore at 11-JAN-17</div><div class="line">allocated channel: ORA_DISK_1</div><div class="line">channel ORA_DISK_1: SID=67 device type=DISK</div><div class="line"></div><div class="line">channel ORA_DISK_1: looking for AUTOBACKUP on day: 20170111</div><div class="line">channel ORA_DISK_1: looking for AUTOBACKUP on day: 20170110</div><div class="line">channel ORA_DISK_1: AUTOBACKUP found: /home/oracle/dbbak/rman/controlfile_c-1519826042-20170110-03</div><div class="line">channel ORA_DISK_1: restoring spfile from AUTOBACKUP /home/oracle/dbbak/rman/controlfile_c-1519826042-20170110-03</div><div class="line">channel ORA_DISK_1: SPFILE restore from AUTOBACKUP complete</div><div class="line">Finished restore at 11-JAN-17</div><div class="line"></div><div class="line"></div><div class="line">[root@hzvscmdb dbs]# ll spfilemmpdb3.ora</div><div class="line">-rw-r-----  1 oracle oinstall     3584 Jan 11 05:16 spfilemmpdb3.ora</div><div class="line">-rw-r-----  1 oracle oinstall     3584 Jan 11 05:10 spfilemmpdb3.ora-bak</div><div class="line"></div><div class="line"></div><div class="line">[oracle@hzvscmdb ~]$ sqlplus / as sysdba</div><div class="line"></div><div class="line">SQL*Plus: Release 11.2.0.2.0 Production on Wed Jan 11 05:15:37 2017</div><div class="line"></div><div class="line">Copyright (c) 1982, 2010, Oracle.  All rights reserved.</div><div class="line"></div><div class="line"></div><div class="line">Connected to:</div><div class="line">Oracle Database 11g Enterprise Edition Release 11.2.0.2.0 - 64bit Production</div><div class="line">With the Partitioning option</div><div class="line"></div><div class="line">SQL&gt; shutdown immediate;</div><div class="line">ORA-01507: database not mounted</div><div class="line"></div><div class="line"></div><div class="line">ORACLE instance shut down.</div><div class="line">SQL&gt; startup;</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 6664212480 bytes</div><div class="line">Fixed Size                  2239072 bytes</div><div class="line">Variable Size            4311745952 bytes</div><div class="line">Database Buffers         2332033024 bytes</div><div class="line">Redo Buffers               18194432 bytes</div><div class="line">Database mounted.</div><div class="line">Database opened.</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Oracle简单易懂之事务流程分析]]></title>
      <url>http://wangbinbin0326.github.io/2017/01/13/Oracle%E7%AE%80%E5%8D%95%E6%98%93%E6%87%82%E4%B9%8B%E4%BA%8B%E5%8A%A1%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/</url>
      <content type="html"><![CDATA[<h2 id="事务的完整流程分析"><a href="#事务的完整流程分析" class="headerlink" title="事务的完整流程分析"></a>事务的完整流程分析</h2><h3 id="一个事务的简单流程分析"><a href="#一个事务的简单流程分析" class="headerlink" title="一个事务的简单流程分析"></a>一个事务的简单流程分析</h3><blockquote>
<p>1、事务开始；</p>
<p>2、在buffer cache中找到需要的数据块，如果没有找到，则从数据文件中载入buffer cache中；</p>
<p>3、事务修改buffer cache的数据块，该数据被标识为“脏数据”，并被写入log buffer中；</p>
<p>4、事务提交，LGWR进程将log buffer中的“脏数据”写入redo log file中；</p>
<p>5、当发生checkpoint，CKPT进程更新所有数据文件的文件头中的信息，DBWn进程则负责将Buffer Cache中的脏数据写入到数据文件中。</p>
<p>附:checkpoint由ckpt进程触发oracle进行checkpoint动作,将data buffer中的脏块(已经写在redo里记录但是没有写到datafile里的)的内容写入到data file里并释放站用的空间,由dbw后台进程完成,并修改controlfile和datafile的scn.<br>一般手工执行(alter system checkpoint)是由于要删除某个日志但是该日志里还有没有同步到data file里的内容,就需要手工check point来同步数据,然后就可以drop logfile group n.</p>
</blockquote>
<a id="more"></a>
<h3 id="一个事务的完整详细流程分析"><a href="#一个事务的完整详细流程分析" class="headerlink" title="一个事务的完整详细流程分析"></a>一个事务的完整详细流程分析</h3><blockquote>
<p>oracle服务进程如何处理用户进程的请求<br>服务器进程在完成用户进程的请求过程中，主要完成如下7个任务：</p>
<p>0.sql语句的解析<br>1.数据块的读入db buffer<br>2.记日志<br>3.为事务建立回滚段<br>4.本事务修改数据块<br>5.放入dirty list<br>6.用户commit或rollback</p>
</blockquote>
<h4 id="sql语句的解析"><a href="#sql语句的解析" class="headerlink" title="sql语句的解析"></a>sql语句的解析</h4><blockquote>
<p>下面要讲oracle服务器进程如可处理用户进程的请求，当一用户进程提交一个sql时：<code>update temp set a=a*2</code>；</p>
<ul>
<li><p><strong>首先</strong> oracle服务器进程从用户进程把信息接收到后，在PGA中就要此进程分配所需内存，存储相关的信息，如在会话内存存储相关的登录信息等；服务器进程把这个sql语句的字符转化为ASCII等效数字码，接着这个ASCII码被传递给一个HASH函数，并返回一个hash值，</p>
</li>
<li><p><strong>然后</strong>服务器进程将到<code>shared pool</code>中的<code>library cache</code>中去查找是否存在相同的hash值，如果存在，服务器进程将使用这条语句已高速缓存在<code>SHARED POOL</code>的<code>library cache</code>中的已分析过的版本来执行，如果不存在，服务器进程将在PGA中，配合UGA内容对sql，进行语法分析，首先检查语法的正确性，接着对语句中涉及的表，索引，视图等对象进行解析，并对照数据字典检查这些对象的名称以及相关结构，并根据ORACLE选用的优化模式以及数据字典中是否存在相应对象的统计数据和是否使用了存储大纲来生成一个执行计划或从存储大纲中选用一个执行计划，然后再用数据字典核对此用户对相应对象的执行权限，最后生成一个编译代码。ORACLE将这条sql语句的本身实际文本、HASH值、编译代码、与此语名相关联的任何统计数据和该语句的执行计划缓存在<code>SHARED POOL</code>的<code>library cache</code>中。服务器进程通过<code>SHARED POOL</code> 锁存器<code>（shared pool latch）</code>来申请可以向哪些共享PL/SQL区中缓存这此内容，也就是说被<code>SHARED POOL</code>锁存器锁定的PL/SQL区中的块不可被覆盖，因为这些块可能被其它进程所使用。在SQL分析阶段将用到<code>LIBRARY CACHE</code>，从数据字典中核对表、视图等结构的时候，需要将数据字典从磁盘读入<code>LIBRARY CACHE</code>，因此，在读入之前也要使用<code>LIBRARY CACHE</code>锁存器<code>（library cache pin，library cache lock）</code>来申请用于缓存数据字典。</p>
</li>
</ul>
<p>到现在为止，这个sql语句已经被编译成可执行的代码了，但还不知道要操作哪些数据，所以服务器进程还要为这个sql准备预处理数据。</p>
</blockquote>
<h4 id="数据块的读入db-buffer"><a href="#数据块的读入db-buffer" class="headerlink" title="数据块的读入db buffer"></a>数据块的读入db buffer</h4><blockquote>
<p>Oracle处理数据，都需要把数据读取到内存中（即<code>db buffer</code>中），首先服务器进程要判断所需数据是否在<code>db buffer</code>存在，如果存在且可用，则直接获取该数据，同时根据<code>LRU</code>算法增加其访问计数；如果<code>db buffer</code>不存在所需数据，则要从数据文件上读取。首先服务器进程将在表头部请求<code>TM锁</code>（保证此事务执行过程其他用户不能修改表的结构），如果成功加TM锁，再请求一些行级锁<code>（TX锁）</code>，如果TM、TX锁都成功加锁，那么才开始从数据文件读数据，在读数据之前，要先为读取的文件准备好buffer空间。服务器进程需要扫面<code>LRU list</code>寻找<code>free db buffer</code>，扫描的过程中，服务器进程会把发现的所有已经被修改过的<code>db buffer</code>注册到<code>dirty list</code>中，</p>
<p>这些<code>dirty buffer</code>会通过<code>dbwr</code>的触发条件，随后会被写出到数据文件，找到了足够的空闲buffer，就可以把请求的数据行所在的数据块放入到<code>db buffer</code>的空闲区域或者覆盖已经被挤出<code>LRU list</code>的非脏数据块缓冲区，并排列在LRU list的头部，也就是在数据块放入DB BUFFER之前也是要先申请db buffer中的锁存器，成功加锁后，才能读数据到db buffer。</p>
</blockquote>
<h4 id="记日志"><a href="#记日志" class="headerlink" title="记日志"></a>记日志</h4><blockquote>
<p>现在数据已经被读入到db buffer了，现在服务器进程将该语句所影响的并被读入db buffer中的这些行数据的<code>rowid</code>及要更新的原值和新值及<code>scn</code>等信息从<code>PGA</code>逐条的写入<code>redo log buffer</code>中。在写入<code>redo log buffer</code>之前也要事先请求<code>redo log buffer的锁存器</code>，成功加锁后才开始写入，当写入达到<code>redo log buffer大小的三分之一</code>或<code>写入量达到1M</code>或<code>超过三秒后</code>或<code>发生检查点时</code>或者<code>dbwr之前发生</code>，都会<strong>触发lgwr进程把redo log buffer的数据写入磁盘上的redo file文件中</strong>（这个时候会产生log file sync等待事件），已经被写入redo file的redo log buffer所持有的锁存器会被释放，并可被后来的写入信息覆盖，redo log buffer是循环使用的。Redo file也是循环使用的，当一个redo file 写满后，lgwr进程会自动切换到下一redo file（这个时候可能出现log file switch（checkpoint complete）等待事件）。如果是归档模式，归档进程还要将前一个写满的redo file文件的内容写到归档日志文件中（这个时候可能出现log file switch（archiving needed））。</p>
</blockquote>
<h4 id="为事务建立回滚段"><a href="#为事务建立回滚段" class="headerlink" title="为事务建立回滚段"></a>为事务建立回滚段</h4><blockquote>
<p>在完成本事务所有相关的redo log buffer之后，服务器进程开始改写这个db buffer的块头部事务列表并写入scn，然后copy包含这个块的头部事务列表及scn信息的数据副本放入回滚段中，将这时回滚段中的信息称为数据块的“前映像“，这个”前映像“用于以后的回滚、恢复和一致性读。（回滚段可以存储在专门的回滚表空间中，这个表空间由一个或多个物理文件组成，并专用于回滚表空间，回滚段也可在其它表空间中的数据文件中开辟。）</p>
</blockquote>
<h4 id="本事务修改数据块"><a href="#本事务修改数据块" class="headerlink" title="本事务修改数据块"></a>本事务修改数据块</h4><blockquote>
<p>准备工作都已经做好了，现在可以改写db buffer块的数据内容了，并在块的头部写入回滚段的地址。</p>
</blockquote>
<h4 id="放入dirty-list"><a href="#放入dirty-list" class="headerlink" title="放入dirty list"></a>放入dirty list</h4><blockquote>
<p>如果一个行数据多次update而未commit，则在回滚段中将会有多个“前映像“，除了第一个”前映像“含有scn信息外，其他每个“前映像“的头部都有scn信息和“前前映像”回滚段地址。一个update只对应一个scn，然后服务器进程将在dirty list中建立一条指向此db buffer块的指针（方便dbwr进程可以找到dirty list的db buffer数据块并写入数据文件中）。</p>
<p>接着服务器进程会从数据文件中继续读入第二个数据块，重复前一数据块的动作，数据块的读入、记日志、建立回滚段、修改数据块、放入dirty list。当dirty queue的长度达到阀值（一般是25%），服务器进程将通知dbwr把脏数据写出，就是释放db buffer上的锁存器，腾出更多的free db buffer。前面一直都是在说明oracle一次读一个数据块，其实oracle可以一次读入多个数据块（db_file_multiblock_read_count来设置一次读入块的个数）</p>
<p><strong>说明：</strong></p>
<p>在预处理的数据已经缓存在db buffer或刚刚被从数据文件读入到db buffer中，就要根据sql语句的类型来决定接下来如何操作。</p>
<ol>
<li><p>如果是<code>select</code>语句，则要查看db buffer块的头部是否有事务，如果有事务，则从回滚段中读取数据；如果没有事务，则比较select的scn和db buffer块头部的scn，如果前者小于后者，仍然要从回滚段中读取数据；如果前者大于后者，说明这是一非脏缓存，可以直接读取这个db buffer块的中内容。</p>
</li>
<li><p>如果是<code>DML</code>操作，则即使在db buffer中找到一个没有事务，而且SCN比自己小的非脏缓存数据块，服务器进程仍然要到表的头部对这条记录申请加锁，加锁成功才能进行后续动作，如果不成功，则要等待前面的进程解锁后才能进行动作（这个时候阻塞是tx锁阻塞）。</p>
</li>
</ol>
</blockquote>
<h4 id="用户commit或rollback"><a href="#用户commit或rollback" class="headerlink" title="用户commit或rollback"></a>用户commit或rollback</h4><blockquote>
<p>到现在为止，数据已经在db buffer或数据文件中修改完成，但是否要永久写到数文件中，要由用户来决定commit（保存更改到数据文件）和rollback（撤销数据的更改），下面来看看在commit和rollback时，oracle都在做什么。</p>
<p><strong>用户执行commit命令</strong></p>
<p>只有当sql语句所影响的所有行所在的最后一个块被读入db buffer并且重做信息被写入redo log buffer（仅指日志缓冲区，而不包括日志文件）之后，用户才可以发去<code>commit</code>命令，<strong>commit触发lgwr进程，但不强制立即dbwr来释放所有相应db buffer块的锁（也就是<code>no-force-at-commit</code>,即提交不强制写），也就是说有可能虽然已经commit了，但在随后的一段时间内dbwr还在写这条sql语句所涉及的数据块。</strong>表头部的行锁并不在commit之后立即释放，而是要等dbwr进程完成之后才释放，这就可能会出现一个用户请求另一用户已经commit的资源不成功的现象。</p>
<ul>
<li><p>情景1：从Commit和dbwr进程结束之间的时间很短，如果恰巧在commit之后，dbwr未结束之前断电，因为commit之后的数据已经属于<br>数据文件的内容，但这部分文件没有完全写入到数据文件中。所以需要前滚。由于commit已经触发lgwr，这些所有未来得及写入数据文件的更改会在实例重启后，由smon进程根据重做日志文件来前滚，完成之前commit未完成的工作（即把更改写入数据文件）。</p>
</li>
<li><p>情景2：如果未commit就断电了，因为数据已经在db buffer更改了，没有commit，说明这部分数据不属于数据文件，由于dbwr之前触发lgwr（也就是只要数据更改，肯定要先有log），所有DBWR在数据文件上的修改都会被先一步记入重做日志文件，实例重启后，SMON进程再根据重做日志文件来回滚。</p>
</li>
</ul>
<p>其实<code>smon</code>的前滚回滚是根据检查点来完成的，当一个全部检查点发生的时候，首先让LGWR进程将redo log buffer中的所有缓冲（包含未提交的重做信息）写入重做日志文件，然后让dbwr进程将db buffer已提交的缓冲写入数据文件（不强制写未提交的）。然后更新控制文件和数据文件头部的SCN，表明当前数据库是一致的，在相邻的两个检查点之间有很多事务，有提交和未提交的。像前面的前滚回滚比较完整的说法是如下的说明：</p>
<ul>
<li><p>情景1：发生检查点之前断电，并且当时有一个未提交的改变正在进行，实例重启之后，SMON进程将从上一个检查点开始核对这个检查点之后记录在重做日志文件中已提交的和未提交改变，因为dbwr之前会触发lgwr，所以dbwr对数据文件的修改一定会被先记录在重做日志文件中。因此，断电前被DBWN写进数据文件的改变将通过重做日志文件中的记录进行还原，叫做回滚，</p>
</li>
<li><p>情景2：如果断电时有一个已提交，但dbwr动作还没有完全完成的改变存在，因为已经提交，提交会触发lgwr进程，所以不管dbwr动作是否已完成，该语句将要影响的行及其产生的结果一定已经记录在重做日志文件中了，则实例重启后，SMON进程根据重做日志文件进行前滚;</p>
</li>
</ul>
<p>实例失败后用于恢复的时间由两个检查点之间的间隔大小来决定，可以通个四个参数设置检查点执行的频率：<br><code>Log_checkpoint_interval</code>:决定两个检查点之间写入重做日志文件的系统物理块(redo blocks)的大小，默认值是0，无限制<br><code>log_checkpoint_timeout</code>: 决定了两个检查点之间的时间长度（秒），默认值是1800s<br><code>fast_start_io_target</code>：决定了用于恢复时需要处理的块的多少，默认值是0，无限制<br><code>fast_start_mttr_target</code>：直接决定了用于恢复的时间的长短，默认值是0，无限制</p>
<p><code>SMON</code>进程执行的前滚和回滚与用户的回滚是不同的，SMON是根据重做日志文件进行前滚或回滚，而用户的回滚一定是根据回滚段的内容进行回滚的。在这里要说一下回滚段存储的数据，假如是delete操作，则回滚段将会记录整个行的数据，假如是update,则回滚段只记录被修改了的字段的变化前的数据（前映像），也就是没有被修改的字段是不会被记录的，假如是insert，则回滚段只记录插入记录的rowid。这样假如事务提交，那回滚段中简单标记该事务已经提交；假如是回退，则如果操作是delete,回退的时候把回滚段中数据重新写回数据块，操作如果是update，则把变化前数据修改回去，操作如果是insert，则根据记录的rowid 把该记录删除。</p>
<p>用户执行rollback</p>
<p>如果用户<code>rollback</code>，则<strong>服务器进程会根据数据文件块和DB BUFFER中块的头部的事务列表和SCN以及回滚段地址找到回滚段中相应的修改前的副本，并且用这些原值来还原当前数据文件中已修改但未提交的改变</strong>。如果有多个“前映像”，服务器进程会在一个“前映像”的头部找到“前前映像”的回滚段地址，一直找到同一事务下的最早的一个“前映像”为止。一旦发出了COMMIT，用户就不能rollback，这使得COMMIT后DBWR进程还没有全部完成的后续动作得到了保障。</p>
<p>到现在为例一个事务已经结束了。</p>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Oracle简单易懂之logminer]]></title>
      <url>http://wangbinbin0326.github.io/2017/01/06/Oracle%E7%AE%80%E5%8D%95%E6%98%93%E6%87%82%E4%B9%8Blogminer/</url>
      <content type="html"><![CDATA[<h2 id="Logminer操作"><a href="#Logminer操作" class="headerlink" title="Logminer操作"></a>Logminer操作</h2><h3 id="LogMiner介绍"><a href="#LogMiner介绍" class="headerlink" title="LogMiner介绍"></a>LogMiner介绍</h3><blockquote>
<p>Oracle LogMiner 是Oracle公司从产品8i以后提供的一个实际非常有用的分析工具，使用该工具可以轻松获得Oracle 在线/归档日志文件中的具体内容，特别是该工具可以分析出所有对于数据库操作的DML和DDL语句。该工具特别适用于调试、审计或者回退某个特定的事务。</p>
<p>LogMiner分析工具实际上是由一组PL/SQL包和一些动态视图（Oracle8i内置包的一部分）组成，它作为Oracle数据库的一部分来发布是8i产品提供的一个完全免费的工具。但该工具和其他Oracle内建工具相比使用起来显得有些复杂，主要原因是该工具没有提供任何的图形用户界面（GUI）。</p>
</blockquote>
<p><img src="https://wangbinbin0326.github.io/images/database/oracle/logminer.gif" alt="此处输入图片的描述"></p>
<blockquote>
<p>Figure shows a sample LogMiner configuration. In this figure, the source database in Boston generates redo log files that are archived and shipped to a database in San Francisco. A LogMiner dictionary has been extracted to these redo log files. The mining database, where LogMiner will actually analyze the redo log files, is in San Francisco. The Boston database is running Oracle9i, and the San Francisco database is running Oracle Database 10g.</p>
</blockquote>
<a id="more"></a>
<h3 id="LogMiner作用"><a href="#LogMiner作用" class="headerlink" title="LogMiner作用"></a>LogMiner作用</h3><blockquote>
<p>在Oracle 8i之前，Oracle没有提供任何协助数据库管理员来读取和解释重作日志文件内容的工具。系统出现问题，对于一个普通的数据管理员来讲，唯一可以作的工作就是将所有的log文件打包，然后发给Oracle公司的技术支持，然后静静地等待Oracle 公司技术支持给我们最后的答案。然而从8i以后，Oracle提供了这样一个强有力的工具–LogMiner。</p>
<p>LogMiner 工具即可以用来分析在线，也可以用来分析离线日志文件，即可以分析本身自己数据库的重作日志文件，也可以用来分析其他数据库的重作日志文件。</p>
<p>总的说来，LogMiner工具的主要用途有：</p>
<p>1、跟踪数据库的变化：可以离线的跟踪数据库的变化，而不会影响在线系统的性能。<br>2、回退数据库的变化：回退特定的变化数据，减少point-in-time recovery的执行。<br>3、优化和扩容计划：可通过分析日志文件中的数据以分析数据增长模式。</p>
</blockquote>
<h3 id="LogMiner安装"><a href="#LogMiner安装" class="headerlink" title="LogMiner安装"></a>LogMiner安装</h3><h4 id="运行dbmslm-dbmslmd包"><a href="#运行dbmslm-dbmslmd包" class="headerlink" title="运行dbmslm, dbmslmd包"></a>运行dbmslm, dbmslmd包</h4><blockquote>
<ul>
<li><code>$ORACLE_HOME/rdbms/admin/dbmslm.sql</code></li>
<li><code>$ORACLE_HOME/rdbms/admin/dbmslmd.sql</code></li>
</ul>
<p>这两个脚本必须均以DBA用户身份运行。其中第一个脚本用来创建DBMS_LOGMNR包，该包用来分析日志文件。第二个脚本用来创建DBMS_LOGMNR_D包，该包用来创建数据字典文件。</p>
</blockquote>
<table>
<thead>
<tr>
<th>类型</th>
<th style="text-align:left">名称</th>
<th style="text-align:left">用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>过程</td>
<td style="text-align:left">Dbms_logmnr_d.build</td>
<td style="text-align:left">创建一个数据字典文件</td>
</tr>
<tr>
<td>过程</td>
<td style="text-align:left">Dbms_logmnr.add_logfile</td>
<td style="text-align:left">在类表中增加日志文件以供分析</td>
</tr>
<tr>
<td>过程</td>
<td style="text-align:left">Dbms_logmnr.start_logmnr</td>
<td style="text-align:left">使用一个外部的字典文件和前面确定要分析日志文件来启动LogMiner</td>
</tr>
<tr>
<td>过程</td>
<td style="text-align:left">Dbms_logmnr.end_logmnr</td>
<td style="text-align:left">停止LogMiner分析</td>
</tr>
<tr>
<td>视图</td>
<td style="text-align:left">V\$logmnr_dictionary</td>
<td style="text-align:left">显示用来决定对象ID名称的字典文件的信息</td>
</tr>
<tr>
<td>视图</td>
<td style="text-align:left">V\$logmnr_logs</td>
<td style="text-align:left">在LogMiner启动时显示分析的日志列表</td>
</tr>
<tr>
<td>视图</td>
<td style="text-align:left">V\$logmnr_contents</td>
<td style="text-align:left">LogMiner启动后，查询重做日志的内容</td>
</tr>
</tbody>
</table>
<h4 id="创建数据字典文件"><a href="#创建数据字典文件" class="headerlink" title="创建数据字典文件"></a>创建数据字典文件</h4><blockquote>
<p>LogMiner工具实际上是由两个新的PL/SQL内建包（(DBMS<em>LOGMNR 和 DBMS</em> LOGMNR_D）和四个V$动态性能视图（视图是在利用过程DBMS_LOGMNR.START_LOGMNR启动LogMiner时创建）组成。在使用LogMiner工具分析redo log文件之前，可以使用DBMS_LOGMNR_D 包将数据字典导出为一个文本文件。该字典文件是可选的，但是如果没有它，LogMiner解释出来的语句中关于数据字典中的部分（如表名、列名等）和数值都将是16进制的形式，我们是无法直接理解的。例如，下面的sql语句：<br><code>INSERT INTO dm_dj_swry (rydm, rymc) VALUES (00005, &#39;张三&#39;);</code></p>
<p>LogMiner解释出来的结果将是下面这个样子：<br><code>insert into Object#308(col#1, col#2) values (hextoraw(&#39;c30rte567e436&#39;), hextoraw(&#39;4a6f686e20446f65&#39;));</code></p>
<p>创建数据字典的目的就是让LogMiner引用涉及到内部数据字典中的部分时为他们实际的名字，而不是系统内部的16进制。数据字典文件是一个文本文件，使用包DBMS_LOGMNR_D来创建。如果我们要分析的数据库中的表有变化，影响到库的数据字典也发生变化，这时就需要重新创建该字典文件。另外一种情况是在分析另外一个数据库文件的重作日志时，也必须要重新生成一遍被分析数据库的数据字典文件。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">#创建数据字典文件之前需要配置LogMiner文件夹：</div><div class="line">SQL&gt; create directory utlfile as &apos;/home/oracle/app/oracle/diag/logmnr&apos;;</div><div class="line"></div><div class="line">Directory created.</div><div class="line"></div><div class="line">SQL&gt; show parameter utl_file_dir;</div><div class="line"></div><div class="line">NAME                                 TYPE        VALUE</div><div class="line">------------------------------------ ----------- ------------------------------</div><div class="line">utl_file_dir                         string</div><div class="line"></div><div class="line">SQL&gt; alter system set utl_file_dir=&apos;/home/oracle/app/oracle/diag/logmnr&apos; scope=spfile;</div><div class="line"></div><div class="line">System altered.</div><div class="line"></div><div class="line">#需要重启DB，才会s</div><div class="line">SQL&gt; show parameter utl_file_dir;</div><div class="line"></div><div class="line">NAME                                 TYPE        VALUE</div><div class="line">------------------------------------ ----------- ------------------------------</div><div class="line">utl_file_dir                         string</div><div class="line"></div><div class="line">SQL&gt; shutdown immediate;</div><div class="line">Database closed.</div><div class="line">Database dismounted.</div><div class="line">ORACLE instance shut down.</div><div class="line">SQL&gt;</div><div class="line">SQL&gt;</div><div class="line">SQL&gt; startup;</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 6664212480 bytes</div><div class="line">Fixed Size                  2239072 bytes</div><div class="line">Variable Size            4311745952 bytes</div><div class="line">Database Buffers         2332033024 bytes</div><div class="line">Redo Buffers               18194432 bytes</div><div class="line">Database mounted.</div><div class="line">Database opened.</div><div class="line">SQL&gt;</div><div class="line">SQL&gt; show parameter utl_file_dir;</div><div class="line"></div><div class="line">NAME                                 TYPE        VALUE</div><div class="line">------------------------------------ ----------- ------------------------------</div><div class="line">utl_file_dir                         string      /home/oracle/app/oracle/diag/l</div><div class="line">                                                 ogmnr</div><div class="line">#以DBA用户登录，创建数据字典文件，也称为外部数据字典</div><div class="line">SQL&gt; EXECUTE dbms_logmnr_d.build(dictionary_filename =&gt; &apos;dictionary.ora&apos;, dictionary_location =&gt;&apos;/home/oracle/app/oracle/diag/logmnr&apos;);</div><div class="line"></div><div class="line">PL/SQL procedure successfully completed.</div></pre></td></tr></table></figure>
<h4 id="加入需分析的日志文件"><a href="#加入需分析的日志文件" class="headerlink" title="加入需分析的日志文件"></a>加入需分析的日志文件</h4><blockquote>
<p>Oracle的LogMiner可以分析在线（online）和归档（offline）两种日志文件，加入分析日志文件使用dbms_logmnr.add_logfile过程，第一个文件使用dbms_logmnr.NEW参数，后面文件使用dbms_logmnr.ADDFILE参数。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">#添加redo log日志分析</div><div class="line">begin</div><div class="line">    dbms_logmnr.add_logfile(logfilename=&gt;&apos;/home/oracle/app/oracle/oradata/mmpdb3/redo02.log&apos;, options=&gt;dbms_logmnr.NEW);</div><div class="line">    dbms_logmnr.add_logfile(logfilename=&gt;&apos;/home/oracle/app/oracle/oradata/mmpdb3/redo01.log&apos;, options=&gt;dbms_logmnr.ADDFILE);</div><div class="line">    dbms_logmnr.add_logfile(logfilename=&gt;&apos;/home/oracle/app/oracle/oradata/mmpdb3/redo03.log&apos;, options=&gt;dbms_logmnr.ADDFILE);</div><div class="line">end;</div><div class="line">/</div><div class="line"></div><div class="line">#添加归档日志分析</div><div class="line">SQL&gt; select name from v$archived_log where first_time &gt; to_date(&apos;2017-1-5 00:00:00&apos;,&apos;YYYY-MM-DD HH24:MI:SS&apos;);</div><div class="line"></div><div class="line">NAME</div><div class="line">----------------------------------------------------------------------------------------------------</div><div class="line">/home/oracle/app/oracle/fast_recovery_area/MMPDB3/archivelog/2017_01_05/o1_mf_1_196_d6vnqpo3_.arc</div><div class="line">/home/oracle/app/oracle/fast_recovery_area/MMPDB3/archivelog/2017_01_05/o1_mf_1_197_d6vpn2xx_.arc</div><div class="line">/home/oracle/app/oracle/fast_recovery_area/MMPDB3/archivelog/2017_01_05/o1_mf_1_198_d6vpn9fb_.arc</div><div class="line"></div><div class="line">begin</div><div class="line">    dbms_logmnr.add_logfile(logfilename=&gt;&apos;/home/oracle/app/oracle/fast_recovery_area/MMPDB3/archivelog/2017_01_05/o1_mf_1_198_d6vpn9fb_.arc&apos;, options=&gt;dbms_logmnr.ADDFILE);</div><div class="line">end;</div><div class="line">/</div></pre></td></tr></table></figure>
<h4 id="使用LogMiner进行日志分析"><a href="#使用LogMiner进行日志分析" class="headerlink" title="使用LogMiner进行日志分析"></a>使用LogMiner进行日志分析</h4><blockquote>
<p>Oracle的LogMiner分析时分为无限制条件和限制条件两种，无限制条件中分析所有加入到分析列表日志文件，限制条件根据限制条件分析指定范围日志文件。</p>
<p>1、无限制条件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SQL&gt; execute dbms_logmnr.start_logmnr(dictfilename=&gt;&apos;/home/oracle/app/oracle/diag/logmnr/dictionary.ora&apos;);</div><div class="line"></div><div class="line">PL/SQL procedure successfully completed.</div></pre></td></tr></table></figure>
<blockquote>
<p>2、有条件的</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ALTER SESSION SET NLS_DATE_FORMAT = &apos;YYYY-MM-DD HH24:MI:SS&apos;;</div><div class="line"></div><div class="line">EXECUTE DBMS_LOGMNR.START_LOGMNR( -</div><div class="line">   DICTFILENAME =&gt; &apos;/home/oracle/app/oracle/diag/logmnr/dictionary.ora&apos;, -</div><div class="line">   STARTTIME =&gt; &apos;2017-1-5 08:30:00&apos;, -</div><div class="line">   ENDTIME =&gt; &apos;2017-1-5 09:00:00&apos;);</div></pre></td></tr></table></figure>
<h4 id="观察分析结果（v-logmnr-contents）"><a href="#观察分析结果（v-logmnr-contents）" class="headerlink" title="观察分析结果（v$logmnr_contents）"></a>观察分析结果（v$logmnr_contents）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select timestamp, username, table_name, SQL_REDO from v$logmnr_contents where table_name = &apos;TLOG&apos;;</div><div class="line"></div><div class="line">TIMESTAMP USERNAME   TABLE_NAME      SQL_REDO</div><div class="line">--------- ---------- --------------- ------------------------------------------------------------</div><div class="line">05-JAN-17 MP         TLOG            insert into &quot;MP&quot;.&quot;TLOG&quot;(&quot;ID&quot;,&quot;NAME&quot;) values (&apos;10&apos;,&apos;log10&apos;);</div></pre></td></tr></table></figure>
<blockquote>
<p>需要强调一点的是，视图v$logmnr_contents中的分析结果仅在我们运行过程’dbms_logmrn.start_logmnr’这个会话的生命期中存在。这是因为所有的LogMiner存储都在PGA内存中，所有其他的进程是看不到它的，同时随着进程的结束，分析结果也随之消失。</p>
<p>最后，使用过程SYS.DBMS_LOGMNR.END_LOGMNR终止日志分析事务，此时PGA内存区域被清除，分析结果也随之不再存在。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">SQL&gt; EXECUTE SYS.DBMS_LOGMNR.END_LOGMNR;</div><div class="line"></div><div class="line">PL/SQL procedure successfully completed.</div><div class="line"></div><div class="line">SQL&gt; select timestamp, username, table_name, SQL_REDO from v$logmnr_contents where table_name = &apos;TLOG&apos;;</div><div class="line">select timestamp, username, table_name, SQL_REDO from v$logmnr_contents where table_name = &apos;TLOG&apos;</div><div class="line">*</div><div class="line">ERROR at line 1:</div><div class="line">ORA-01306: dbms_logmnr.start_logmnr() must be invoked before selecting from v$logmnr_contents</div></pre></td></tr></table></figure>
<h4 id="logminer-遇到问题"><a href="#logminer-遇到问题" class="headerlink" title="logminer 遇到问题"></a>logminer 遇到问题</h4><blockquote>
<p><strong>issue1:</strong> 查找v$logmnr_contents表没有找到insert,update 操作的记录 </p>
<p>使用logmnr分析日志，查找v$logmnr_contents表，发现不到对表的insert ,update记录，后来才知道原来是Supplemental logging is turned off。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select supplemental_log_data_pk, supplemental_log_data_ui from v$database;</div><div class="line">SUPPLEMENTAL_LOG_DATA_PK SUPPLEMENTAL_LOG_DATA_UI</div><div class="line">------------------------ ------------------------</div><div class="line">NO NO</div><div class="line">对数据库作如下修改：</div><div class="line">SQL&gt; alter database add supplemental log data (primary key, unique index) columns;</div><div class="line">Database altered</div><div class="line">SQL&gt; select supplemental_log_data_pk, supplemental_log_data_ui from v$database;</div><div class="line">SUPPLEMENTAL_LOG_DATA_PK SUPPLEMENTAL_LOG_DATA_UI</div><div class="line">------------------------ -----------------------</div><div class="line">YES YES</div></pre></td></tr></table></figure>
<h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><blockquote>
<p>实例一：使用LogMiner读取在线日志</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line">#在数据库创建LOGMINER用户，该用户需要具有DBA权限</div><div class="line">SQL&gt; create user logminer identified by pass;</div><div class="line"></div><div class="line">User created.</div><div class="line"></div><div class="line">SQL&gt; grant connect, resource, dba to logminer;</div><div class="line"></div><div class="line">Grant succeeded.</div><div class="line"></div><div class="line">#以mp用户，进行测试数据准备</div><div class="line">SQL&gt; create table t_redo(id number, name varchar(20));</div><div class="line"></div><div class="line">Table created.</div><div class="line"></div><div class="line">SQL&gt; insert into t_redo values(1, &apos;redo log 1&apos;);</div><div class="line"></div><div class="line">1 row created.</div><div class="line"></div><div class="line">SQL&gt; insert into t_redo values(2, &apos;redo log 2&apos;);</div><div class="line"></div><div class="line">1 row created.</div><div class="line"></div><div class="line">SQL&gt; commit;</div><div class="line"></div><div class="line">Commit complete.</div><div class="line"></div><div class="line">#创建数据字典文件</div><div class="line">#数据库对象发生变化，需要重新创建数据字典文件</div><div class="line">#以LOGMINER用户（DBA权限）登录，生成字典文件</div><div class="line">[oracle@hzvscmdb ~]$ sqlplus logminer/pass as sysdba</div><div class="line"></div><div class="line">SQL&gt; execute dbms_logmnr_d.build(dictionary_filename =&gt; &apos;dictionary.ora&apos;, dictionary_location =&gt; &apos;/home/oracle/app/oracle/diag/logmnr&apos;);</div><div class="line"></div><div class="line">PL/SQL procedure successfully completed.</div><div class="line"></div><div class="line">#确认当前处于联机状态的日志文件</div><div class="line">SQL&gt; select group#, sequence#, status, first_change#, first_time from v$log order by first_change#;</div><div class="line"></div><div class="line">    GROUP#  SEQUENCE# STATUS           FIRST_CHANGE# FIRST_TIM</div><div class="line">---------- ---------- ---------------- ------------- ---------</div><div class="line">         2        203 INACTIVE               6691353 05-JAN-17</div><div class="line">         3        204 INACTIVE               6691760 05-JAN-17</div><div class="line">         1        205 CURRENT                6699917 06-JAN-17</div><div class="line"></div><div class="line">SQL&gt; select GROUP#, STATUS, TYPE, MEMBER from v$logfile;</div><div class="line"></div><div class="line">    GROUP# STATUS  TYPE    MEMBER</div><div class="line">---------- ------- ------- ------------------------------------------------------------</div><div class="line">         1         ONLINE  /home/oracle/app/oracle/oradata/mmpdb3/redo01.log</div><div class="line">         3         ONLINE  /home/oracle/app/oracle/oradata/mmpdb3/redo03.log</div><div class="line">         2         ONLINE  /home/oracle/app/oracle/oradata/mmpdb3/redo02.log</div><div class="line">         1         ONLINE  /home/oracle/app/oracle/oradata/mmpdb3/redo01-1.log</div><div class="line"></div><div class="line">#加入解析在线日志文件</div><div class="line">begin</div><div class="line">    dbms_logmnr.add_logfile(logfilename=&gt;&apos;/home/oracle/app/oracle/oradata/mmpdb3/redo01.log&apos;, options=&gt;dbms_logmnr.NEW);</div><div class="line">end;</div><div class="line">/</div><div class="line"></div><div class="line">#启动LogMiner进行分析</div><div class="line">execute dbms_logmnr.start_logmnr(dictfilename=&gt;&apos;/home/oracle/app/oracle/diag/logmnr/dictionary.ora&apos;);</div><div class="line"></div><div class="line">#观察分析结果</div><div class="line">SQL&gt; select sql_redo, sql_undo, table_name, username from v$logmnr_contents where seg_name=&apos;T_REDO&apos;;</div><div class="line"></div><div class="line">SQL_REDO                            SQL_UNDO                            TABLE_NAME USERNAME</div><div class="line">----------------------------------- ----------------------------------- ---------- ----------</div><div class="line">create table t_redo(id number, name                                     T_REDO     MP</div><div class="line"> varchar(20));</div><div class="line"></div><div class="line">insert into &quot;MP&quot;.&quot;T_REDO&quot;(&quot;ID&quot;,&quot;NAM delete from &quot;MP&quot;.&quot;T_REDO&quot; where &quot;ID T_REDO     MP</div><div class="line">E&quot;) values (&apos;1&apos;,&apos;redo log 1&apos;);      &quot; = &apos;1&apos; and &quot;NAME&quot; = &apos;redo log 1&apos; a</div><div class="line">                                    nd ROWID = &apos;AAATeZAAFAAA6OTAAA&apos;;</div><div class="line"></div><div class="line">insert into &quot;MP&quot;.&quot;T_REDO&quot;(&quot;ID&quot;,&quot;NAM delete from &quot;MP&quot;.&quot;T_REDO&quot; where &quot;ID T_REDO     MP</div><div class="line">E&quot;) values (&apos;2&apos;,&apos;redo log 2&apos;);      &quot; = &apos;2&apos; and &quot;NAME&quot; = &apos;redo log 2&apos; a</div><div class="line">                                    nd ROWID = &apos;AAATeZAAFAAA6OTAAB&apos;;</div></pre></td></tr></table></figure>
<blockquote>
<p>实例二：使用LogMiner读取归档日志</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line">[oracle@hzvscmdb ~]$ sqlplus mp/pass</div><div class="line"></div><div class="line">SQL&gt; create table t_arch(id number, name varchar(20));</div><div class="line"></div><div class="line">Table created.</div><div class="line"></div><div class="line">SQL&gt; insert into t_arch values(1, &apos;arch log 1&apos;);</div><div class="line"></div><div class="line">1 row created.</div><div class="line"></div><div class="line">SQL&gt; insert into t_arch values(2, &apos;arch log 2&apos;);</div><div class="line"></div><div class="line">1 row created.</div><div class="line"></div><div class="line">SQL&gt; commit;</div><div class="line"></div><div class="line">Commit complete.</div><div class="line"></div><div class="line">#从v$log视图中找出日志文件的序号</div><div class="line">[oracle@hzvscmdb ~]$ sqlplus logminer/pass as sysdba</div><div class="line"></div><div class="line">SQL&gt; select GROUP#, SEQUENCE#, ARCHIVED, STATUS, FIRST_CHANGE#, FIRST_TIME, NEXT_CHANGE#, NEXT_TIME from v$log;</div><div class="line"></div><div class="line">    GROUP#  SEQUENCE# ARC STATUS           FIRST_CHANGE# FIRST_TIM         NEXT_CHANGE# NEXT_TIME</div><div class="line">---------- ---------- --- ---------------- ------------- --------- -------------------- ---------</div><div class="line">         1        205 YES INACTIVE               6699917 06-JAN-17              6718064 06-JAN-17</div><div class="line">         2        206 NO  CURRENT                6718064 06-JAN-17      281474976710655</div><div class="line">         3        204 YES INACTIVE               6691760 05-JAN-17              6699917 06-JAN-17</div><div class="line"></div><div class="line">SQL&gt; select SEQUENCE#, FIRST_TIME, NEXT_CHANGE#, NEXT_TIME, STATUS, NAME from v$archived_log order by NEXT_TIME desc;</div><div class="line"></div><div class="line"> SEQUENCE# FIRST_TIM NEXT_CHANGE# NEXT_TIME S NAME</div><div class="line">---------- --------- ------------ --------- - ------------------------------------------------------------</div><div class="line">       205 06-JAN-17      6718064 06-JAN-17 A /home/oracle/app/oracle/fast_recovery_area/MMPDB3/archivelog</div><div class="line">                                              /2017_01_06/o1_mf_1_205_d6y93ow0_.arc</div><div class="line"></div><div class="line">       204 05-JAN-17      6699917 06-JAN-17 A /home/oracle/app/oracle/fast_recovery_area/MMPDB3/archivelog</div><div class="line">                                              /2017_01_06/o1_mf_1_204_d6xrnj1p_.arc</div><div class="line"></div><div class="line">       203 05-JAN-17      6691760 05-JAN-17 D</div><div class="line">       202 05-JAN-17      6691353 05-JAN-17 D</div><div class="line"></div><div class="line"></div><div class="line">SQL&gt; alter system switch logfile;</div><div class="line"></div><div class="line">System altered.</div><div class="line"></div><div class="line"></div><div class="line">SQL&gt; select GROUP#, SEQUENCE#, ARCHIVED, STATUS, FIRST_CHANGE#, FIRST_TIME, NEXT_CHANGE#, NEXT_TIME from v$log;</div><div class="line"></div><div class="line">    GROUP#  SEQUENCE# ARC STATUS           FIRST_CHANGE# FIRST_TIM         NEXT_CHANGE# NEXT_TIME</div><div class="line">---------- ---------- --- ---------------- ------------- --------- -------------------- ---------</div><div class="line">         1        205 YES INACTIVE               6699917 06-JAN-17              6718064 06-JAN-17</div><div class="line">         2        206 YES ACTIVE                 6718064 06-JAN-17              6720936 06-JAN-17</div><div class="line">         3        207 NO  CURRENT                6720936 06-JAN-17      281474976710655</div><div class="line"></div><div class="line">SQL&gt; select SEQUENCE#, FIRST_TIME, NEXT_CHANGE#, NEXT_TIME, STATUS, NAME from v$archived_log order by NEXT_TIME desc;</div><div class="line"></div><div class="line"> SEQUENCE# FIRST_TIM         NEXT_CHANGE# NEXT_TIME S NAME</div><div class="line">---------- --------- -------------------- --------- - ------------------------------------------------------------</div><div class="line">       206 06-JAN-17              6720936 06-JAN-17 A /home/oracle/app/oracle/fast_recovery_area/MMPDB3/archivelog</div><div class="line">                                                      /2017_01_06/o1_mf_1_206_d6ydh37f_.arc</div><div class="line"></div><div class="line">       205 06-JAN-17              6718064 06-JAN-17 A /home/oracle/app/oracle/fast_recovery_area/MMPDB3/archivelog</div><div class="line">                                                      /2017_01_06/o1_mf_1_205_d6y93ow0_.arc</div><div class="line"></div><div class="line">       204 05-JAN-17              6699917 06-JAN-17 A /home/oracle/app/oracle/fast_recovery_area/MMPDB3/archivelog</div><div class="line">                                                      /2017_01_06/o1_mf_1_204_d6xrnj1p_.arc</div><div class="line"></div><div class="line">       203 05-JAN-17              6691760 05-JAN-17 D</div><div class="line">       202 05-JAN-17              6691353 05-JAN-17 D</div><div class="line"></div><div class="line">#创建数据字典文件</div><div class="line">#数据库对象发生变化，需要重新创建数据字典文件</div><div class="line">#以LOGMINER用户（DBA权限）登录，生成字典文件</div><div class="line">[oracle@hzvscmdb ~]$ sqlplus logminer/pass as sysdba</div><div class="line"></div><div class="line">SQL&gt; execute dbms_logmnr_d.build(dictionary_filename =&gt; &apos;dictionary.ora&apos;, dictionary_location =&gt; &apos;/home/oracle/app/oracle/diag/logmnr&apos;);</div><div class="line"></div><div class="line">PL/SQL procedure successfully completed.</div><div class="line"></div><div class="line">#加入需分析的归档日志文件</div><div class="line">#加入解析在线日志文件</div><div class="line">begin</div><div class="line">    dbms_logmnr.add_logfile(logfilename=&gt;&apos;/home/oracle/app/oracle/fast_recovery_area/MMPDB3/archivelog/2017_01_06/o1_mf_1_206_d6ydh37f_.arc&apos;, options=&gt;dbms_logmnr.NEW);</div><div class="line">end;</div><div class="line">/</div><div class="line"></div><div class="line">#启动LogMiner进行分析</div><div class="line">execute dbms_logmnr.start_logmnr(dictfilename=&gt;&apos;/home/oracle/app/oracle/diag/logmnr/dictionary.ora&apos;);</div><div class="line"></div><div class="line">#观察分析结果</div><div class="line">SQL&gt; select sql_redo, sql_undo, table_name, username from v$logmnr_contents where seg_name=&apos;T_ARCH&apos;;</div><div class="line"></div><div class="line">SQL_REDO                            SQL_UNDO                            TABLE_NAME      USERNAME</div><div class="line">----------------------------------- ----------------------------------- --------------- ----------</div><div class="line">create table t_arch(id number, name                                     T_ARCH          MP</div><div class="line"> varchar(20));</div><div class="line"></div><div class="line">insert into &quot;MP&quot;.&quot;T_ARCH&quot;(&quot;ID&quot;,&quot;NAM delete from &quot;MP&quot;.&quot;T_ARCH&quot; where &quot;ID T_ARCH          MP</div><div class="line">E&quot;) values (&apos;1&apos;,&apos;arch log 1&apos;);      &quot; = &apos;1&apos; and &quot;NAME&quot; = &apos;arch log 1&apos; a</div><div class="line">                                    nd ROWID = &apos;AAATeaAAFAAA6ObAAA&apos;;</div><div class="line"></div><div class="line">insert into &quot;MP&quot;.&quot;T_ARCH&quot;(&quot;ID&quot;,&quot;NAM delete from &quot;MP&quot;.&quot;T_ARCH&quot; where &quot;ID T_ARCH          MP</div><div class="line">E&quot;) values (&apos;2&apos;,&apos;arch log 2&apos;);      &quot; = &apos;2&apos; and &quot;NAME&quot; = &apos;arch log 2&apos; a</div><div class="line">                                    nd ROWID = &apos;AAATeaAAFAAA6ObAAB&apos;;</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Rman恢复-Restore和Recovery的区别]]></title>
      <url>http://wangbinbin0326.github.io/2016/12/30/Rman%E6%81%A2%E5%A4%8D-Restore%E5%92%8CRecovery%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
      <content type="html"><![CDATA[<h4 id="Restore和Recovery的区别"><a href="#Restore和Recovery的区别" class="headerlink" title="Restore和Recovery的区别"></a>Restore和Recovery的区别</h4><blockquote>
<p><strong>Restoration</strong>: A corrupted data file is overwritten from a backup of the data file .The data file is at a prior point of time than the current database.</p>
<p><strong>Recovery</strong>: Recovery applies the changes to the individual blocks,using archive and redo information,to move the database forward to the current point in time.</p>
<p>从原理上解释，Restore是使用备份文件，将数据库还原到过去的某个状态。</p>
<p>Recovery是使用redo日志和归档日志将数据库向前恢复，一步步的恢复到现在这个时点。</p>
<p><strong>举个例子</strong><br>某生产环境的数据库，每天凌晨一点会作一次备份。某天下午两点时数据库文件损害，同时数据库宕机。<br>接着DBA开始恢复数据库。</p>
<p>1.首先,使用最近一次的备份文件还原数据库到当天凌晨一点的状态。但是凌晨一点到下午两点的数据丢失了。<br>2.接着,使用redo日志和归档日志，把当天凌晨一点开始的数据库操作重做一遍，直到下午两点数据库宕机前。<br>这样数据库就一点都不差的被恢复起来了。</p>
</blockquote>
<a id="more"></a>
<blockquote>
<p><strong>操作步骤</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">#设置表空间为offline</div><div class="line">RMAN&gt; SQL &apos;alter tablespace tab01 offline immediate&apos;;</div><div class="line"></div><div class="line">sql statement: alter tablespace tab01 offline immediate</div><div class="line"></div><div class="line">#Restore还原物理文件</div><div class="line">RMAN&gt; restore tablespace tab01;</div><div class="line"></div><div class="line">Starting restore at 30-DEC-16</div><div class="line">using channel ORA_DISK_1</div><div class="line"></div><div class="line">skipping datafile 5; already restored to file /home/oracle/app/oracle/oradata/mmpdb3/tab01.dbf</div><div class="line">restore not done; all files read only, offline, or already restored</div><div class="line">Finished restore at 30-DEC-16</div><div class="line"></div><div class="line">#Recover恢复数据</div><div class="line">RMAN&gt; recover tablespace tab01;</div><div class="line"></div><div class="line">Starting recover at 30-DEC-16</div><div class="line">using channel ORA_DISK_1</div><div class="line">channel ORA_DISK_1: starting incremental datafile backup set restore</div><div class="line">channel ORA_DISK_1: specifying datafile(s) to restore from backup set</div><div class="line">destination for restore of datafile 00005: /home/oracle/app/oracle/oradata/mmpdb3/tab01.dbf</div><div class="line">channel ORA_DISK_1: reading from backup piece /home/oracle/dbbak/rman/mmpdb3_level_1_database_MMPDB3_20161229_328</div><div class="line">channel ORA_DISK_1: piece handle=/home/oracle/dbbak/rman/mmpdb3_level_1_database_MMPDB3_20161229_328 tag=TAG20161229T230036</div><div class="line">channel ORA_DISK_1: restored backup piece 1</div><div class="line">channel ORA_DISK_1: restore complete, elapsed time: 00:00:07</div><div class="line"></div><div class="line">starting media recovery</div><div class="line">media recovery complete, elapsed time: 00:00:00</div><div class="line"></div><div class="line">Finished recover at 30-DEC-16</div><div class="line"></div><div class="line">#设置表空间为online</div><div class="line">RMAN&gt; SQL &apos;alter tablespace tab01 online&apos;;</div><div class="line"></div><div class="line">sql statement: alter tablespace tab01 online</div></pre></td></tr></table></figure></p>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[zabbix-pyora定制监控Oracle数据库]]></title>
      <url>http://wangbinbin0326.github.io/2016/12/05/zabbix-pyora%E5%AE%9A%E5%88%B6%E7%9B%91%E6%8E%A7Oracle%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
      <content type="html"><![CDATA[<h3 id="安装Pyora-监控oracle"><a href="#安装Pyora-监控oracle" class="headerlink" title="安装Pyora 监控oracle"></a>安装Pyora 监控oracle</h3><blockquote>
<p>Today Zabbix have some nice improvements like macros and Discovery, so we can set the database settings(user,password,database and such) on the host using macros and not hard code it on a script that you have to access a server to change it. Also if Zabbix already discovery disks and network interfaces why not Oracle tablespaces? Then Pyora was born:</p>
<p>Pyora is a clean python script that uses cxOracle library to fetch data from the database. To use Pyora you need Oracle client and the cxOracle. I’m assuming that you have both installed on your system, if you don’t have it you check this page and install it.</p>
</blockquote>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div></pre></td><td class="code"><pre><div class="line">####################################################################################################</div><div class="line">#运行pyora之前，需要安装以下软件</div><div class="line">OS: </div><div class="line">[root@ct7 Pyora-master]# more /etc/redhat-release</div><div class="line">CentOS Linux release 7.2.1511 (Core)</div><div class="line"></div><div class="line">注意stop firewalld, disable SElinux, 否则zabbix 报 no permission</div><div class="line">[root@ct7 Pyora-master]# systemctl stop firewalld</div><div class="line">[root@ct7 agent]# vi /etc/sysconfig/selinux</div><div class="line">SELINUX=disabled</div><div class="line">[root@ct7 agent]# setenforce 0</div><div class="line"></div><div class="line"></div><div class="line">Python:</div><div class="line">[root@ct7 Pyora-master]# python -V</div><div class="line">Python 2.7.5</div><div class="line"></div><div class="line">#安装Oracle instance-client:</div><div class="line">[root@ct7 oracle]# pwd</div><div class="line">/home/tony/oracle</div><div class="line"></div><div class="line">[root@ct7 oracle]# ls</div><div class="line">oracle-instantclient12.1-basic-12.1.0.2.0-1.x86_64.rpm</div><div class="line">oracle-instantclient12.1-devel-12.1.0.2.0-1.x86_64.rpm </div><div class="line">oracle-instantclient12.1-sqlplus-12.1.0.2.0-1.x86_64.rpm</div><div class="line"></div><div class="line">[root@ct7 oracle]# yum localinstall oracle* --nogpgcheck</div><div class="line"></div><div class="line">[root@ct7 oracle]# more /etc/hosts</div><div class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</div><div class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">10.224.188.59   ct7.qa.webex.com</div><div class="line"></div><div class="line">[root@ct7 oracle]# more /etc/profile</div><div class="line">export ORACLE_HOME=/usr/lib/oracle/12.1/client64/</div><div class="line">export PATH=$PATH:$ORACLE_HOME/bin</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib</div><div class="line">export TNS_ADMIN=$ORACLE_HOME/network/admin</div><div class="line"></div><div class="line">[root@ct7 oracle]# mkdir -p $ORACLE_HOME/network/admin</div><div class="line"></div><div class="line">[root@ct7 oracle]# more $ORACLE_HOME/network/admin/tnsnames.ora</div><div class="line">cha=</div><div class="line">  (DESCRIPTION=</div><div class="line">    (ADDRESS=</div><div class="line">      (PROTOCOL=TCP)</div><div class="line">      (HOST=10.224.188.188)</div><div class="line">      (PORT=1521)</div><div class="line">    )</div><div class="line">    (CONNECT_DATA=</div><div class="line">      (SERVER=dedicated)</div><div class="line">      (SERVICE_NAME=cha.qa.webex.com)</div><div class="line">    )</div><div class="line">  )</div><div class="line"></div><div class="line">[root@ct7 oracle]# sqlplus system/pass@cha</div><div class="line"></div><div class="line">SQL*Plus: Release 12.1.0.2.0 Production on Thu Sep 8 09:39:04 2016</div><div class="line"></div><div class="line">Copyright (c) 1982, 2014, Oracle.  All rights reserved.</div><div class="line"></div><div class="line">Oracle Database 11g Enterprise Edition Release 11.2.0.2.0 - 64bit Production</div><div class="line">With the Partitioning option</div><div class="line"></div><div class="line">SQL&gt;</div><div class="line"></div><div class="line">#安装cxOracle</div><div class="line">[root@ct7 oracle]# rpm -ivh cx_Oracle-5.2.1-12c-py27-1.x86_64.rpm</div><div class="line"></div><div class="line">[root@ct7 python]# more con-cha.py</div><div class="line">#!/usr/bin/python</div><div class="line">#FileName: con_ora.py</div><div class="line"></div><div class="line">import cx_Oracle</div><div class="line"></div><div class="line">conn = cx_Oracle.connect(&apos;ch/pass@10.224.188.188:1521/cha.qa.webex.com&apos;)</div><div class="line">cursor = conn.cursor()</div><div class="line">cursor.execute(&quot;select * from dept&quot;)</div><div class="line">row = cursor.fetchone()</div><div class="line">print row[0]</div><div class="line"></div><div class="line">cursor.close()</div><div class="line">conn.close()</div><div class="line"></div><div class="line">[root@ct7 python]# python con-cha.py</div><div class="line">300</div><div class="line"></div><div class="line">####################################################################################################</div><div class="line">#安装Pyora</div><div class="line">https://github.com/bicofino/Pyora.git</div><div class="line"></div><div class="line">[root@ct7 Pyora-master]# ll</div><div class="line">total 28</div><div class="line">-rwxrwxrwx. 1 root root 20799 Jun  6 23:23 pyora.py</div><div class="line">-rw-r--r--. 1 root root  2899 Jun  6 23:23 README.md</div><div class="line">drwxr-xr-x. 2 root root    52 Jun  6 23:23 zabbix-template</div><div class="line"></div><div class="line">[root@ct7 Pyora-master]# python pyora.py -h</div><div class="line">usage: pyora.py [-h] [--username USERNAME] [--password PASSWORD]</div><div class="line">                [--address ADDRESS] [--database DATABASE]</div><div class="line"></div><div class="line">                &#123;activeusercount,asm_volume_use,bufbusywaits,check_active,check_archive,commits,db_close,db_connect,dbfilesize,dbprllwrite,dbscattread,dbseqread,dbsize,dbsnglwrite,deadlocks,directread,directwrite,dsksortratio,enqueue,fra_use,freebufwaits,hparsratio,indexffs,lastapplarclog,lastarclog,latchfree,logfilesync,logonscurrent,logprllwrite,logswcompletion,netresv,netroundtrips,netsent,query_lock,query_redologs,query_rollbacks,query_sessions,query_sysmetrics,rcachehit,redowrites,rollbacks,show_asm_volumes,show_tablespaces,show_tablespaces_temp,show_users,tablespace,tablespace_abs,tablespace_temp,tblrowsscans,tblscans,uptime,user_status,version&#125;</div><div class="line">                ...</div><div class="line"></div><div class="line">positional arguments:</div><div class="line">  &#123;activeusercount,asm_volume_use,bufbusywaits,check_active,check_archive,commits,db_close,db_connect,dbfilesize,dbprllwrite,dbscattread,dbseqread,dbsize,dbsnglwrite,deadlocks,directread,directwrite,dsksortratio,enqueue,fra_use,freebufwaits,hparsratio,indexffs,lastapplarclog,lastarclog,latchfree,logfilesync,logonscurrent,logprllwrite,logswcompletion,netresv,netroundtrips,netsent,query_lock,query_redologs,query_rollbacks,query_sessions,query_sysmetrics,rcachehit,redowrites,rollbacks,show_asm_volumes,show_tablespaces,show_tablespaces_temp,show_users,tablespace,tablespace_abs,tablespace_temp,tblrowsscans,tblscans,uptime,user_status,version&#125;</div><div class="line"></div><div class="line">optional arguments:</div><div class="line">  -h, --help            show this help message and exit</div><div class="line">  --username USERNAME</div><div class="line">  --password PASSWORD</div><div class="line">  --address ADDRESS</div><div class="line">  --database DATABASE</div><div class="line"></div><div class="line">Show the tablespaces names in a JSON format</div><div class="line">[root@ct7 Pyora-master]# python pyora.py --username zabbix --password pass --address 10.224.188.188 --database cha.qa.webex.com show_tablespaces</div><div class="line">&#123;&quot;data&quot;: [&#123;&quot;&#123;#TABLESPACE&#125;&quot;: &quot;SYSAUX&quot;&#125;, &#123;&quot;&#123;#TABLESPACE&#125;&quot;: &quot;SYSTEM&quot;&#125;, &#123;&quot;&#123;#TABLESPACE&#125;&quot;: &quot;TBS_01&quot;&#125;, &#123;&quot;&#123;#TABLESPACE&#125;&quot;: &quot;TBS_ZABBIX_01&quot;&#125;, &#123;&quot;&#123;#TABLESPACE&#125;&quot;: &quot;TEMP&quot;&#125;, &#123;&quot;&#123;#TABLESPACE&#125;&quot;: &quot;TPCCTAB&quot;&#125;, &#123;&quot;&#123;#TABLESPACE&#125;&quot;: &quot;UNDOTBS1&quot;&#125;, &#123;&quot;&#123;#TABLESPACE&#125;&quot;: &quot;USERS&quot;&#125;]&#125;</div><div class="line"></div><div class="line">####################################################################################################</div><div class="line">#install zabbix agent</div><div class="line">[root@ct7 agent]# wget http://repo.zabbix.com/zabbix/3.0/rhel/7/x86_64/zabbix-agent-3.0.4-1.el7.x86_64.rpm</div><div class="line"></div><div class="line">[root@ct7 agent]# rpm -ivh zabbix-agent-3.0.4-1.el7.x86_64.rpm</div><div class="line"></div><div class="line">[root@ct7 agent]# more /etc/zabbix/zabbix_agentd.conf</div><div class="line">Server=10.224.188.55</div><div class="line">UserParameter=pyora[*],/home/tony/zabbix/pyora/Pyora-master/pyora.py --username $1 --password $2 --address $3 --database $4 $5 $6 $7 $8</div><div class="line"></div><div class="line">[root@ct7 agent]# systemctl start zabbix-agent</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>Import the template zabbix-template/Pyora.xml to your new host</li>
</ul>
</blockquote>
<p><img src="http://wangbinbin0326.github.io/images/software/zabbix-pyora-1.JPG" alt="此处输入图片的描述"></p>
<p><img src="http://wangbinbin0326.github.io/images/software/zabbix-pyora-3.JPG" alt="此处输入图片的描述"></p>
<blockquote>
<ul>
<li>add a new host and configure the required macros</li>
</ul>
</blockquote>
<p><img src="http://wangbinbin0326.github.io/images/software/zabbix-pyora-2.JPG" alt="此处输入图片的描述"></p>
<p><img src="http://wangbinbin0326.github.io/images/software/zabbix-pyora-4.JPG" alt="此处输入图片的描述"></p>
<p><img src="http://wangbinbin0326.github.io/images/software/zabbix-pyora-5.JPG" alt="此处输入图片的描述"></p>
<blockquote>
<ul>
<li>Now you just have to wait and check later the information, Remember that the tablespace discovery take one hour to complete.</li>
</ul>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Oracle备份恢复案例3-控制文件的恢复]]></title>
      <url>http://wangbinbin0326.github.io/2016/11/17/Oracle%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%A1%88%E4%BE%8B3-%E6%8E%A7%E5%88%B6%E6%96%87%E4%BB%B6%E7%9A%84%E6%81%A2%E5%A4%8D/</url>
      <content type="html"><![CDATA[<h2 id="7-5-3-案例3-（控制文件的恢复）"><a href="#7-5-3-案例3-（控制文件的恢复）" class="headerlink" title="7.5.3 案例3 （控制文件的恢复）"></a>7.5.3 案例3 （控制文件的恢复）</h2><h3 id="7-5-3-1-场景1-控制文件没有全坏-有一个是好的"><a href="#7-5-3-1-场景1-控制文件没有全坏-有一个是好的" class="headerlink" title="7.5.3.1 场景1 控制文件没有全坏,有一个是好的"></a>7.5.3.1 场景1 控制文件没有全坏,有一个是好的</h3><blockquote>
<p>step 1: 查看控制文件记录的序列号，控制文件和数据文件的SCN</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">-- Control file sequence number incremented by control file transactions</div><div class="line">-- V$DATABASE displays information about the database from the control file.</div><div class="line">SQL&gt; select CONTROLFILE_SEQUENCE# from v$database;</div><div class="line"></div><div class="line">CONTROLFILE_SEQUENCE#</div><div class="line">---------------------</div><div class="line">                 1676</div><div class="line"></div><div class="line">-- The x$kcvfh table is a fixed table in Oracle. The table naming stands for Kernel, Cache, recoVery, File, Header.</div><div class="line">-- FHCSQ：controlfile sequence number in the Memory</div><div class="line">SQL&gt; select hxfil as file#, FHCSQ from x$kcvfh;</div><div class="line"></div><div class="line">     FILE#      FHCSQ</div><div class="line">---------- ----------</div><div class="line">         1       1644</div><div class="line">         2       1644</div><div class="line">         3       1644</div><div class="line">         4       1644</div><div class="line">         5       1644</div><div class="line">         6       1644</div><div class="line"></div><div class="line">-- Last SCN in backup control file; null if the control file is not a backup</div><div class="line">SQL&gt; select controlfile_change# from v$database;</div><div class="line"></div><div class="line">CONTROLFILE_CHANGE#</div><div class="line">-------------------</div><div class="line">            1152251</div><div class="line"></div><div class="line">-- Last SCN checkpointed</div><div class="line">SQL&gt; select checkpoint_change# from v$database;</div><div class="line"></div><div class="line">CHECKPOINT_CHANGE#</div><div class="line">------------------</div><div class="line">           1146902</div><div class="line"></div><div class="line">-- Data file checkpoint change# </div><div class="line">-- &quot;V$DATAFILE_HEADER&quot;, which displays information from data file headers</div><div class="line">SQL&gt; select file#, checkpoint_change# from v$datafile_header;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1146902</div><div class="line">         2            1146902</div><div class="line">         3            1146902</div><div class="line">         4            1146902</div><div class="line">         5            1146902</div><div class="line">         6            1146902           </div><div class="line"></div><div class="line">-- SCN at last checkpoint </div><div class="line">-- V$DATAFILE displays datafile information from the control file.</div><div class="line">SQL&gt; select file#, checkpoint_change# from v$datafile;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1146902</div><div class="line">         2            1146902</div><div class="line">         3            1146902</div><div class="line">         4            1146902</div><div class="line">         5            1146902</div><div class="line">         6            1146902</div></pre></td></tr></table></figure>
<a id="more"></a>
<blockquote>
<p>step 2: 模拟事故，删除一个control文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">SQL&gt; shutdown immediate;</div><div class="line">Database closed.</div><div class="line">Database dismounted.</div><div class="line">ORACLE instance shut down.</div><div class="line"></div><div class="line"></div><div class="line">[oracle@hzvscmdb mmpdb3]$ mv control01.ctl control01.ctl-bak</div><div class="line"></div><div class="line">SQL&gt; startup;</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 6664212480 bytes</div><div class="line">Fixed Size                  2239072 bytes</div><div class="line">Variable Size            3456107936 bytes</div><div class="line">Database Buffers         3187671040 bytes</div><div class="line">Redo Buffers               18194432 bytes</div><div class="line">ORA-00205: error in identifying control file, check alert log for more info</div><div class="line"></div><div class="line">[oracle@hzvscmdb alert]$ vi log.xml</div><div class="line">&lt;txt&gt;ORA-00210: cannot open the specified control file</div><div class="line">ORA-00202: control file: &amp;apos;/home/oracle/app/oracle/oradata/mmpdb3/control01.ctl&amp;apos;</div><div class="line">ORA-27037: unable to obtain file status</div><div class="line">Linux-x86_64 Error: 2: No such file or directory</div><div class="line">Additional information: 3</div></pre></td></tr></table></figure>
<blockquote>
<p>step 3: 用好的control文件来，替换换掉的文件。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[oracle@hzvscmdb mmpdb3]$ cp -a control02.ctl ../../oradata/mmpdb3/control01.ctl</div><div class="line"></div><div class="line">SQL&gt; alter database mount;</div><div class="line"></div><div class="line">Database altered.</div><div class="line"></div><div class="line">SQL&gt; alter database open;</div><div class="line"></div><div class="line">Database altered.</div></pre></td></tr></table></figure>
<hr>
<h3 id="7-5-3-2-场景2-所有控制文件都坏了-但损坏前有备份-二进制"><a href="#7-5-3-2-场景2-所有控制文件都坏了-但损坏前有备份-二进制" class="headerlink" title="7.5.3.2 场景2 所有控制文件都坏了,但损坏前有备份(二进制)"></a>7.5.3.2 场景2 所有控制文件都坏了,但损坏前有备份(二进制)</h3><blockquote>
<p>step 1: 备份control文件为二进制格式，并查看控制文件和数据文件的SCN</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter database backup controlfile to &apos;/home/oracle/dbbak/control.bin&apos;;</div><div class="line"></div><div class="line">Database altered.</div><div class="line"></div><div class="line">SQL&gt; select checkpoint_change# from v$database;</div><div class="line"></div><div class="line">CHECKPOINT_CHANGE#</div><div class="line">------------------</div><div class="line">           1152702</div><div class="line"></div><div class="line">SQL&gt; select File#, checkpoint_change# from v$datafile;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1152702</div><div class="line">         2            1152702</div><div class="line">         3            1152702</div><div class="line">         4            1152702</div><div class="line">         5            1152702</div><div class="line">         6            1152702</div><div class="line"></div><div class="line">6 rows selected.</div><div class="line"></div><div class="line">SQL&gt; select file#, checkpoint_change# from v$datafile_header;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1152702</div><div class="line">         2            1152702</div><div class="line">         3            1152702</div><div class="line">         4            1152702</div><div class="line">         5            1152702</div><div class="line">         6            1152702</div><div class="line"></div><div class="line">6 rows selected.</div></pre></td></tr></table></figure>
<blockquote>
<p>step 2: 插入新的数据，并提交，并查看控制文件和数据文件的SCN，发现SNC没有变化</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">SQL&gt; insert into mp.obj(OBJECT_NAME, OBJECT_ID) values(&apos;control&apos;,1);</div><div class="line"></div><div class="line">1 row created.</div><div class="line"></div><div class="line">SQL&gt; commit;</div><div class="line"></div><div class="line">Commit complete.</div><div class="line"></div><div class="line">SQL&gt; select checkpoint_change# from v$database;</div><div class="line"></div><div class="line">CHECKPOINT_CHANGE#</div><div class="line">------------------</div><div class="line">           1152702</div><div class="line"></div><div class="line">SQL&gt; select File#, checkpoint_change# from v$datafile;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1152702</div><div class="line">         2            1152702</div><div class="line">         3            1152702</div><div class="line">         4            1152702</div><div class="line">         5            1152702</div><div class="line">         6            1152702</div><div class="line"></div><div class="line">6 rows selected.</div><div class="line"></div><div class="line">SQL&gt; select file#, checkpoint_change# from v$datafile_header;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1152702</div><div class="line">         2            1152702</div><div class="line">         3            1152702</div><div class="line">         4            1152702</div><div class="line">         5            1152702</div><div class="line">         6            1152702</div><div class="line"></div><div class="line">6 rows selected.</div></pre></td></tr></table></figure>
<blockquote>
<p>step 3: 将所有的数据变化，写入到disk，发现SNC有变化<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">-- Specify CHECKPOINT to explicitly force Oracle Database to perform a checkpoint, </div><div class="line">-- ensuring that all changes made by committed transactions are written to datafiles on disk. </div><div class="line">SQL&gt; alter system checkpoint;</div><div class="line"></div><div class="line">System altered.</div><div class="line"></div><div class="line">SQL&gt; select checkpoint_change# from v$database;</div><div class="line"></div><div class="line">CHECKPOINT_CHANGE#</div><div class="line">------------------</div><div class="line">           1157349</div><div class="line"></div><div class="line">SQL&gt; select File#, checkpoint_change# from v$datafile;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1157349</div><div class="line">         2            1157349</div><div class="line">         3            1157349</div><div class="line">         4            1157349</div><div class="line">         5            1157349</div><div class="line">         6            1157349</div><div class="line"></div><div class="line">6 rows selected.</div><div class="line"></div><div class="line">SQL&gt; select file#, checkpoint_change# from v$datafile_header;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1157349</div><div class="line">         2            1157349</div><div class="line">         3            1157349</div><div class="line">         4            1157349</div><div class="line">         5            1157349</div><div class="line">         6            1157349</div><div class="line"></div><div class="line">6 rows selected.</div></pre></td></tr></table></figure></p>
<p>step 4: 模拟事故，删除所有的control file<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[oracle@hzvscmdb mmpdb3]$ mv control01.ctl control01.ctl-bak</div><div class="line">[oracle@hzvscmdb mmpdb3]$ mv control02.ctl control02.ctl-bak</div><div class="line"></div><div class="line">SQL&gt; shutdown abort;</div><div class="line">ORACLE instance shut down.</div><div class="line"></div><div class="line">SQL&gt; startup;</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 6664212480 bytes</div><div class="line">Fixed Size                  2239072 bytes</div><div class="line">Variable Size            3456107936 bytes</div><div class="line">Database Buffers         3187671040 bytes</div><div class="line">Redo Buffers               18194432 bytes</div><div class="line">ORA-00205: error in identifying control file, check alert log for more info</div></pre></td></tr></table></figure></p>
<p>step 5: copy 备份的control file 二进制文件到默认相应的目录，然后开启数据库发现错误，查看数据文件记录的SCN与控制文件记录的SCN不一致。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">[oracle@hzvscmdb mmpdb3]$ cp -a /home/oracle/dbbak/control.bin control01.ctl</div><div class="line">[oracle@hzvscmdb mmpdb3]$ cp -a /home/oracle/dbbak/control.bin /home/oracle/app/oracle/fast_recovery_area/mmpdb3/control02.ctl</div><div class="line"></div><div class="line">SQL&gt; startup;</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 6664212480 bytes</div><div class="line">Fixed Size                  2239072 bytes</div><div class="line">Variable Size            3456107936 bytes</div><div class="line">Database Buffers         3187671040 bytes</div><div class="line">Redo Buffers               18194432 bytes</div><div class="line">Database mounted.</div><div class="line">ORA-01589: must use RESETLOGS or NORESETLOGS option for database open</div><div class="line"></div><div class="line">SQL&gt; select checkpoint_change# from v$database;</div><div class="line"></div><div class="line">CHECKPOINT_CHANGE#</div><div class="line">------------------</div><div class="line">           1152702</div><div class="line"></div><div class="line">SQL&gt; select File#, checkpoint_change# from v$datafile;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1152702</div><div class="line">         2            1152702</div><div class="line">         3            1152702</div><div class="line">         4            1152702</div><div class="line">         5            1152702</div><div class="line">         6            1152702</div><div class="line"></div><div class="line">6 rows selected.</div><div class="line"></div><div class="line">SQL&gt; select file#, checkpoint_change# from v$datafile_header;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1157349</div><div class="line">         2            1157349</div><div class="line">         3            1157349</div><div class="line">         4            1157349</div><div class="line">         5            1157349</div><div class="line">         6            1157349</div><div class="line"></div><div class="line">6 rows selected.</div></pre></td></tr></table></figure></p>
<p>step 6: 进行恢复<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter database open noresetlogs;</div><div class="line">alter database open noresetlogs</div><div class="line">*</div><div class="line">ERROR at line 1:</div><div class="line">ORA-01610: recovery using the BACKUP CONTROLFILE option must be done</div><div class="line"></div><div class="line">SQL&gt; recover database using backup controlfile until cancel</div><div class="line">ORA-00275: media recovery has already been started</div><div class="line"></div><div class="line">SQL&gt; recover database using backup controlfile until cancel</div><div class="line">ORA-00279: change 1157117 generated at 11/15/2016 23:37:55 needed for thread 1</div><div class="line">ORA-00289: suggestion : /home/oracle/app/oracle/fast_recovery_area/MMPDB3/archivelog/2016_11_16/o1_mf_1_11_%u_.arc</div><div class="line">ORA-00280: change 1157117 for thread 1 is in sequence #11</div><div class="line"></div><div class="line"></div><div class="line">Specify log: &#123;&lt;RET&gt;=suggested | filename | AUTO | CANCEL&#125;</div><div class="line">/home/oracle/app/oracle/oradata/mmpdb3/redo01.log</div><div class="line">ORA-00328: archived log ends at change 1146901, need later change 1157117</div><div class="line">ORA-00334: archived log: &apos;/home/oracle/app/oracle/oradata/mmpdb3/redo01.log&apos;</div><div class="line"></div><div class="line"></div><div class="line">ORA-10879: error signaled in parallel recovery slave</div><div class="line">ORA-01547: warning: RECOVER succeeded but OPEN RESETLOGS would get error below</div><div class="line">ORA-01194: file 1 needs more recovery to be consistent</div><div class="line">ORA-01110: data file 1: &apos;/home/oracle/app/oracle/oradata/mmpdb3/system01.dbf&apos;</div><div class="line"></div><div class="line">SQL&gt; alter database recover cancel;</div><div class="line"></div><div class="line">Database altered.</div><div class="line"></div><div class="line">SQL&gt; select GROUP#, STATUS, ARCHIVED, MEMBERS, FIRST_CHANGE#, to_char(NEXT_CHANGE#, 9999999999999999999)  from v$log;</div><div class="line"></div><div class="line">    GROUP# STATUS           ARC    MEMBERS FIRST_CHANGE# TO_CHAR(NEXT_CHANGE#</div><div class="line">---------- ---------------- --- ---------- ------------- --------------------</div><div class="line">         1 INACTIVE         YES          1       1127994              1146902</div><div class="line">         3 INACTIVE         YES          1       1095072              1127994</div><div class="line">         2 CURRENT          NO           1       1146902      281474976710655</div><div class="line"></div><div class="line">-- Note: You can specify the name of an online CURRENT redo log </div><div class="line">SQL&gt; recover database using backup controlfile until cancel</div><div class="line">ORA-00279: change 1157117 generated at 11/15/2016 23:37:55 needed for thread 1</div><div class="line">ORA-00289: suggestion : /home/oracle/app/oracle/fast_recovery_area/MMPDB3/archivelog/2016_11_16/o1_mf_1_11_%u_.arc</div><div class="line">ORA-00280: change 1157117 for thread 1 is in sequence #11</div><div class="line"></div><div class="line"></div><div class="line">Specify log: &#123;&lt;RET&gt;=suggested | filename | AUTO | CANCEL&#125;</div><div class="line">/home/oracle/app/oracle/oradata/mmpdb3/redo02.log</div><div class="line">Log applied.</div><div class="line">Media recovery complete.</div><div class="line"></div><div class="line">SQL&gt; alter database open resetlogs;</div><div class="line"></div><div class="line">Database altered.</div><div class="line"></div><div class="line">SQL&gt; select GROUP#, STATUS, ARCHIVED, MEMBERS, FIRST_CHANGE#, to_char(NEXT_CHANGE#, 9999999999999999999)  from v$log;</div><div class="line"></div><div class="line">    GROUP# STATUS           ARC    MEMBERS FIRST_CHANGE# TO_CHAR(NEXT_CHANGE#</div><div class="line">---------- ---------------- --- ---------- ------------- --------------------</div><div class="line">         1 CURRENT          NO           1       1157419      281474976710655</div><div class="line">         2 UNUSED           YES          1             0                    0</div><div class="line">         3 UNUSED           YES          1             0                    0</div><div class="line">         </div><div class="line">SQL&gt; select checkpoint_change# from v$database;</div><div class="line"></div><div class="line">CHECKPOINT_CHANGE#</div><div class="line">------------------</div><div class="line">           1157422</div><div class="line"></div><div class="line">SQL&gt; select File#, checkpoint_change# from v$datafile;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1157422</div><div class="line">         2            1157422</div><div class="line">         3            1157422</div><div class="line">         4            1157422</div><div class="line">         5            1157422</div><div class="line">         6            1157422</div><div class="line"></div><div class="line">6 rows selected.</div><div class="line"></div><div class="line">SQL&gt; select file#, checkpoint_change# from v$datafile_header;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1157422</div><div class="line">         2            1157422</div><div class="line">         3            1157422</div><div class="line">         4            1157422</div><div class="line">         5            1157422</div><div class="line">         6            1157422</div><div class="line"></div><div class="line">6 rows selected.</div></pre></td></tr></table></figure></p>
</blockquote>
<hr>
<h3 id="7-5-3-3-场景3-所有控制文件都坏了-但损坏前有备份-文本"><a href="#7-5-3-3-场景3-所有控制文件都坏了-但损坏前有备份-文本" class="headerlink" title="7.5.3.3 场景3 所有控制文件都坏了,但损坏前有备份(文本)"></a>7.5.3.3 场景3 所有控制文件都坏了,但损坏前有备份(文本)</h3><blockquote>
<p>step 1: 备份control文件为文本，并查看控制文件和数据文件的SCN<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter database backup controlfile to trace as &apos;/home/oracle/dbbak/control.txt&apos;;</div><div class="line"></div><div class="line">Database altered.</div><div class="line"></div><div class="line">SQL&gt; insert into mp.T_LOAD_DATA values(1888, &apos;t888&apos;);</div><div class="line"></div><div class="line">1 row created.</div><div class="line"></div><div class="line">SQL&gt; commit;</div><div class="line"></div><div class="line">Commit complete.</div><div class="line"></div><div class="line">SQL&gt; select checkpoint_change# from v$database;</div><div class="line"></div><div class="line">CHECKPOINT_CHANGE#</div><div class="line">------------------</div><div class="line">           1875087</div><div class="line"></div><div class="line">SQL&gt; select File#, checkpoint_change# from v$datafile;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1875087</div><div class="line">         2            1875087</div><div class="line">         3            1875087</div><div class="line">         4            1875087</div><div class="line">         5            1875087</div><div class="line">         6            1875087</div><div class="line"></div><div class="line">6 rows selected.</div><div class="line"></div><div class="line">SQL&gt; select file#, checkpoint_change# from v$datafile_header;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1875087</div><div class="line">         2            1875087</div><div class="line">         3            1875087</div><div class="line">         4            1875087</div><div class="line">         5            1875087</div><div class="line">         6            1875087</div><div class="line"></div><div class="line">6 rows selected.</div></pre></td></tr></table></figure></p>
<p>step 2: 模拟事故，删除control 文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[oracle@hzvscmdb mmpdb3]$ rm -rf control01.ctl</div><div class="line"></div><div class="line">SQL&gt; shutdown abort;</div><div class="line">ORACLE instance shut down.</div><div class="line">SQL&gt; startup;</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 6664212480 bytes</div><div class="line">Fixed Size                  2239072 bytes</div><div class="line">Variable Size            3724543392 bytes</div><div class="line">Database Buffers         2919235584 bytes</div><div class="line">Redo Buffers               18194432 bytes</div><div class="line">ORA-00205: error in identifying control file, check alert log for more info</div></pre></td></tr></table></figure></p>
<p>step 3: 利用备份的control文件，来恢复<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line">STARTUP NOMOUNT</div><div class="line">CREATE CONTROLFILE REUSE DATABASE &quot;MMPDB3&quot; NORESETLOGS  ARCHIVELOG</div><div class="line">    MAXLOGFILES 16</div><div class="line">    MAXLOGMEMBERS 3</div><div class="line">    MAXDATAFILES 100</div><div class="line">    MAXINSTANCES 8</div><div class="line">    MAXLOGHISTORY 292</div><div class="line">LOGFILE</div><div class="line">  GROUP 1 &apos;/home/oracle/app/oracle/oradata/mmpdb3/redo01.log&apos;  SIZE 50M BLOCKSIZE 512,</div><div class="line">  GROUP 2 &apos;/home/oracle/app/oracle/oradata/mmpdb3/redo02.log&apos;  SIZE 50M BLOCKSIZE 512,</div><div class="line">  GROUP 3 &apos;/home/oracle/app/oracle/oradata/mmpdb3/redo03.log&apos;  SIZE 50M BLOCKSIZE 512</div><div class="line">-- STANDBY LOGFILE</div><div class="line">DATAFILE</div><div class="line">  &apos;/home/oracle/app/oracle/oradata/mmpdb3/system01.dbf&apos;,</div><div class="line">  &apos;/home/oracle/app/oracle/oradata/mmpdb3/sysaux01.dbf&apos;,</div><div class="line">  &apos;/home/oracle/app/oracle/oradata/mmpdb3/undotbs01.dbf&apos;,</div><div class="line">  &apos;/home/oracle/app/oracle/oradata/mmpdb3/users01.dbf&apos;,</div><div class="line">  &apos;/home/oracle/app/oracle/oradata/mmpdb3/tab01.dbf&apos;,</div><div class="line">  &apos;/home/oracle/app/oracle/oradata/mmpdb3/tab02.dbf&apos;</div><div class="line">CHARACTER SET WE8ISO8859P1</div><div class="line">;</div><div class="line"></div><div class="line">SQL&gt; select checkpoint_change# from v$database;</div><div class="line"></div><div class="line">CHECKPOINT_CHANGE#</div><div class="line">------------------</div><div class="line">           1875087</div><div class="line"></div><div class="line">SQL&gt; select File#, checkpoint_change# from v$datafile;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1875087</div><div class="line">         2            1875087</div><div class="line">         3            1875087</div><div class="line">         4            1875087</div><div class="line">         5            1875087</div><div class="line">         6            1875087</div><div class="line"></div><div class="line">6 rows selected.</div><div class="line"></div><div class="line">SQL&gt; select file#, checkpoint_change# from v$datafile_header;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1875087</div><div class="line">         2            1875087</div><div class="line">         3            1875087</div><div class="line">         4            1875087</div><div class="line">         5            1875087</div><div class="line">         6            1875087</div><div class="line"></div><div class="line">6 rows selected.</div><div class="line"></div><div class="line">SQL&gt; alter database open;</div><div class="line">alter database open</div><div class="line">*</div><div class="line">ERROR at line 1:</div><div class="line">ORA-01113: file 1 needs media recovery</div><div class="line">ORA-01110: data file 1: &apos;/home/oracle/app/oracle/oradata/mmpdb3/system01.dbf&apos;</div><div class="line"></div><div class="line">SQL&gt; recover database;</div><div class="line">Media recovery complete.</div><div class="line">SQL&gt; ALTER SYSTEM ARCHIVE LOG ALL;</div><div class="line"></div><div class="line">System altered.</div><div class="line"></div><div class="line">SQL&gt; ALTER DATABASE OPEN;</div><div class="line"></div><div class="line">Database altered.</div></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="7-5-3-4-场景4-备份控制文件的恢复-控制文件中不包含数据文件-但联机日志中有"><a href="#7-5-3-4-场景4-备份控制文件的恢复-控制文件中不包含数据文件-但联机日志中有" class="headerlink" title="7.5.3.4 场景4 备份控制文件的恢复,控制文件中不包含数据文件,但联机日志中有"></a>7.5.3.4 场景4 备份控制文件的恢复,控制文件中不包含数据文件,但联机日志中有</h3><blockquote>
<p>step 1: 先备份control文件为二进制，然后创建新的表空间，并查看控制文件与数据文件的SCN，发现新创建的表空间tab03 CHECKPOINT_CHANGE# 与其它的不一致。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter database backup controlfile to &apos;/home/oracle/dbbak/control.ctl&apos;;</div><div class="line"></div><div class="line">Database altered.</div><div class="line"></div><div class="line"></div><div class="line">SQL&gt; create tablespace tab03 datafile &apos;/home/oracle/app/oracle/oradata/mmpdb3/tab03.dbf&apos; size 10m;</div><div class="line"></div><div class="line">Tablespace created.</div><div class="line"></div><div class="line">SQL&gt; select file#,name from v$datafile;</div><div class="line"></div><div class="line">     FILE# NAME</div><div class="line">---------- ------------------------------------------------------------</div><div class="line">         1 /home/oracle/app/oracle/oradata/mmpdb3/system01.dbf</div><div class="line">         2 /home/oracle/app/oracle/oradata/mmpdb3/sysaux01.dbf</div><div class="line">         3 /home/oracle/app/oracle/oradata/mmpdb3/undotbs01.dbf</div><div class="line">         4 /home/oracle/app/oracle/oradata/mmpdb3/users01.dbf</div><div class="line">         5 /home/oracle/app/oracle/oradata/mmpdb3/tab01.dbf</div><div class="line">         6 /home/oracle/app/oracle/oradata/mmpdb3/tab02.dbf</div><div class="line">         7 /home/oracle/app/oracle/oradata/mmpdb3/tab03.dbf</div><div class="line"></div><div class="line">SQL&gt; select checkpoint_change# from v$database;</div><div class="line"></div><div class="line">CHECKPOINT_CHANGE#</div><div class="line">------------------</div><div class="line">           1900834</div><div class="line"></div><div class="line">SQL&gt; select File#, checkpoint_change# from v$datafile;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1900834</div><div class="line">         2            1900834</div><div class="line">         3            1900834</div><div class="line">         4            1900834</div><div class="line">         5            1900834</div><div class="line">         6            1900834</div><div class="line">         7            1901199</div><div class="line"></div><div class="line">7 rows selected.</div><div class="line"></div><div class="line">SQL&gt; select file#, checkpoint_change# from v$datafile_header;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1900834</div><div class="line">         2            1900834</div><div class="line">         3            1900834</div><div class="line">         4            1900834</div><div class="line">         5            1900834</div><div class="line">         6            1900834</div><div class="line">         7            1901199</div><div class="line"></div><div class="line">7 rows selected.</div><div class="line"></div><div class="line">SQL&gt; create table mp.t03(id number(10), name varchar(10)) tablespace tab03;</div><div class="line"></div><div class="line">Table created.</div><div class="line"></div><div class="line">SQL&gt; insert into mp.t03 values(1,&apos;t1&apos;);</div><div class="line"></div><div class="line">1 row created.</div><div class="line"></div><div class="line">SQL&gt; commit;</div><div class="line"></div><div class="line">Commit complete.</div></pre></td></tr></table></figure></p>
<p>step 2: 模拟事故，删除控制文件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[oracle@hzvscmdb mmpdb3]$ mv control01.ctl control01.ctl-bak</div><div class="line"></div><div class="line">SQL&gt; shutdown abort;</div><div class="line">ORACLE instance shut down.</div></pre></td></tr></table></figure></p>
<p>step 3: copy备份的control 文件到默认的目录，启动数据库。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">[oracle@hzvscmdb mmpdb3]$ cp -a /home/oracle/dbbak/control.ctl /home/oracle/app/oracle/oradata/control01.ctl</div><div class="line">[oracle@hzvscmdb mmpdb3]$ cp -a /home/oracle/dbbak/control.ctl /home/oracle/app/oracle/fast_recovery_area/mmpdb3/control02.ctl</div><div class="line"></div><div class="line">SQL&gt; startup;</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 6664212480 bytes</div><div class="line">Fixed Size                  2239072 bytes</div><div class="line">Variable Size            3724543392 bytes</div><div class="line">Database Buffers         2919235584 bytes</div><div class="line">Redo Buffers               18194432 bytes</div><div class="line">Database mounted.</div><div class="line">ORA-01589: must use RESETLOGS or NORESETLOGS option for database open</div><div class="line"></div><div class="line">SQL&gt; select checkpoint_change# from v$database;</div><div class="line"></div><div class="line">CHECKPOINT_CHANGE#</div><div class="line">------------------</div><div class="line">           1900834</div><div class="line"></div><div class="line">SQL&gt; select File#, checkpoint_change# from v$datafile;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1900834</div><div class="line">         2            1900834</div><div class="line">         3            1900834</div><div class="line">         4            1900834</div><div class="line">         5            1900834</div><div class="line">         6            1900834</div><div class="line"></div><div class="line">6 rows selected.</div><div class="line"></div><div class="line">SQL&gt; select file#, checkpoint_change# from v$datafile_header;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1900834</div><div class="line">         2            1900834</div><div class="line">         3            1900834</div><div class="line">         4            1900834</div><div class="line">         5            1900834</div><div class="line">         6            1900834</div><div class="line"></div><div class="line">6 rows selected.</div></pre></td></tr></table></figure></p>
<p>step 4: 利用redo log 进行不完全恢复。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select GROUP#, ARCHIVED, STATUS, to_char(NEXT_CHANGE#, 99999999999999999) from v$log;</div><div class="line"></div><div class="line">    GROUP# ARC STATUS           TO_CHAR(NEXT_CHANG</div><div class="line">---------- --- ---------------- ------------------</div><div class="line">         1 YES INACTIVE                    1899844</div><div class="line">         3 YES INACTIVE                    1875087</div><div class="line">         2 NO  CURRENT             281474976710655</div><div class="line"></div><div class="line">SQL&gt; recover database using backup controlfile;</div><div class="line">ORA-00279: change 1900834 generated at 11/17/2016 05:40:17 needed for thread 1</div><div class="line">ORA-00289: suggestion : /home/oracle/app/oracle/fast_recovery_area/MMPDB3/archivelog/2016_11_17/o1_mf_1_167_%u_.arc</div><div class="line">ORA-00280: change 1900834 for thread 1 is in sequence #167</div><div class="line"></div><div class="line"></div><div class="line">Specify log: &#123;&lt;RET&gt;=suggested | filename | AUTO | CANCEL&#125;</div><div class="line">/home/oracle/app/oracle/oradata/mmpdb3/redo02.log</div><div class="line">ORA-00283: recovery session canceled due to errors</div><div class="line">ORA-01244: unnamed datafile(s) added to control file by media recovery</div><div class="line">ORA-01110: data file 7: &apos;/home/oracle/app/oracle/oradata/mmpdb3/tab03.dbf&apos;</div><div class="line"></div><div class="line"></div><div class="line">ORA-01112: media recovery not started</div></pre></td></tr></table></figure></p>
<p>step 5: 发现redo log里面记录的数据文件‘tab03’不存在， 查看v$datafile发现名字不一致，将其重命名后，进行恢复<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select file#, CHECKPOINT_CHANGE#, name from v$datafile;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE# NAME</div><div class="line">---------- ------------------ ------------------------------------------------------------</div><div class="line">         1            1900834 /home/oracle/app/oracle/oradata/mmpdb3/system01.dbf</div><div class="line">         2            1900834 /home/oracle/app/oracle/oradata/mmpdb3/sysaux01.dbf</div><div class="line">         3            1900834 /home/oracle/app/oracle/oradata/mmpdb3/undotbs01.dbf</div><div class="line">         4            1900834 /home/oracle/app/oracle/oradata/mmpdb3/users01.dbf</div><div class="line">         5            1900834 /home/oracle/app/oracle/oradata/mmpdb3/tab01.dbf</div><div class="line">         6            1900834 /home/oracle/app/oracle/oradata/mmpdb3/tab02.dbf</div><div class="line">         7            1901198 /home/oracle/app/oracle/product/11.2.0/dbhome_1/dbs/UNNAMED0</div><div class="line">                              0007</div><div class="line"></div><div class="line">SQL&gt; alter database rename file &apos;/home/oracle/app/oracle/product/11.2.0/dbhome_1/dbs/UNNAMED00007&apos;</div><div class="line">     to &apos;/home/oracle/app/oracle/oradata/mmpdb3/tab03.dbf&apos;;</div><div class="line"></div><div class="line">Database altered.</div><div class="line"></div><div class="line">SQL&gt; select file#, CHECKPOINT_CHANGE#, name from v$datafile;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE# NAME</div><div class="line">---------- ------------------ ------------------------------------------------------------</div><div class="line">         1            1900834 /home/oracle/app/oracle/oradata/mmpdb3/system01.dbf</div><div class="line">         2            1900834 /home/oracle/app/oracle/oradata/mmpdb3/sysaux01.dbf</div><div class="line">         3            1900834 /home/oracle/app/oracle/oradata/mmpdb3/undotbs01.dbf</div><div class="line">         4            1900834 /home/oracle/app/oracle/oradata/mmpdb3/users01.dbf</div><div class="line">         5            1900834 /home/oracle/app/oracle/oradata/mmpdb3/tab01.dbf</div><div class="line">         6            1900834 /home/oracle/app/oracle/oradata/mmpdb3/tab02.dbf</div><div class="line">         7            1901198 /home/oracle/app/oracle/oradata/mmpdb3/tab03.dbf</div><div class="line"></div><div class="line">7 rows selected.</div><div class="line"></div><div class="line">SQL&gt; recover database using backup controlfile;</div><div class="line">ORA-00279: change 1901199 generated at 11/17/2016 05:43:21 needed for thread 1</div><div class="line">ORA-00289: suggestion : /home/oracle/app/oracle/fast_recovery_area/MMPDB3/archivelog/2016_11_17/o1_mf_1_167_%u_.arc</div><div class="line">ORA-00280: change 1901199 for thread 1 is in sequence #167</div><div class="line"></div><div class="line"></div><div class="line">Specify log: &#123;&lt;RET&gt;=suggested | filename | AUTO | CANCEL&#125;</div><div class="line">/home/oracle/app/oracle/oradata/mmpdb3/redo02.log</div><div class="line">Log applied.</div><div class="line">Media recovery complete.</div></pre></td></tr></table></figure></p>
<p>step 6: 查看系统检查点，数据文件与控制文件的SCN，发现系统检查点与数据文件SCN，不一致，用resetlogs的方式打开数据库。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select checkpoint_change# from v$database;</div><div class="line"></div><div class="line">CHECKPOINT_CHANGE#</div><div class="line">------------------</div><div class="line">           1900834</div><div class="line"></div><div class="line">SQL&gt; select File#, checkpoint_change# from v$datafile;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1901610</div><div class="line">         2            1901610</div><div class="line">         3            1901610</div><div class="line">         4            1901610</div><div class="line">         5            1901610</div><div class="line">         6            1901610</div><div class="line">         7            1901610</div><div class="line"></div><div class="line">7 rows selected.</div><div class="line"></div><div class="line">SQL&gt; select file#, checkpoint_change# from v$datafile_header;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1901610</div><div class="line">         2            1901610</div><div class="line">         3            1901610</div><div class="line">         4            1901610</div><div class="line">         5            1901610</div><div class="line">         6            1901610</div><div class="line">         7            1901610</div><div class="line"></div><div class="line">7 rows selected.</div><div class="line"></div><div class="line">SQL&gt; alter database open resetlogs;</div><div class="line"></div><div class="line">Database altered.</div><div class="line"></div><div class="line">SQL&gt; select checkpoint_change# from v$database;</div><div class="line"></div><div class="line">CHECKPOINT_CHANGE#</div><div class="line">------------------</div><div class="line">           1901614</div><div class="line"></div><div class="line">SQL&gt; select File#, checkpoint_change# from v$datafile;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1901614</div><div class="line">         2            1901614</div><div class="line">         3            1901614</div><div class="line">         4            1901614</div><div class="line">         5            1901614</div><div class="line">         6            1901614</div><div class="line">         7            1901614</div><div class="line"></div><div class="line">7 rows selected.</div><div class="line"></div><div class="line">SQL&gt; select file#, checkpoint_change# from v$datafile_header;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1            1901614</div><div class="line">         2            1901614</div><div class="line">         3            1901614</div><div class="line">         4            1901614</div><div class="line">         5            1901614</div><div class="line">         6            1901614</div><div class="line">         7            1901614</div><div class="line"></div><div class="line">7 rows selected.</div></pre></td></tr></table></figure></p>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Oracle备份恢复案例2-表空间热备恢复]]></title>
      <url>http://wangbinbin0326.github.io/2016/11/16/Oracle%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%A1%88%E4%BE%8B2-%E8%A1%A8%E7%A9%BA%E9%97%B4%E7%83%AD%E5%A4%87%E6%81%A2%E5%A4%8D/</url>
      <content type="html"><![CDATA[<h4 id="7-5-2-案例2-（数据库打开时的恢复以用户数据的表空间为例-热备-）"><a href="#7-5-2-案例2-（数据库打开时的恢复以用户数据的表空间为例-热备-）" class="headerlink" title="7.5.2 案例2 （数据库打开时的恢复以用户数据的表空间为例(热备)）"></a>7.5.2 案例2 （数据库打开时的恢复以用户数据的表空间为例(<strong>热备</strong>)）</h4><blockquote>
<p><strong>热备份</strong>是当数据库打开并对用户有效是的OS级的数据备份。热备份只能用于<code>ARCHIVELOG</code>方式的数据库。在数据文件备份之前，对应的表空间必须通过使用<code>ALTER TABLESPACE …… BEGIN BACKUP</code>以备份方式放置。然后组成表空间的数据文件可以使用类似冷备份的操作系统命令进行拷贝。在数据文件用操作系统命令拷贝后，应使用<code>ALTER TABLESPACE …… END BACKUP</code>命令使表空间脱离热备份方式。<br>热备份没有必要备份联机日志，但必须是归档状态，在实例恢复的时候，可能需要用到归档日志。当前联机日志一定要保护好或是处于镜相状态，当前联机日志的损坏，对于数据库的损坏是巨大的，只能以数据的丢失来进行数据库的恢复工作。 </p>
<p>对于临时表空间，存放的是临时信息，在热备份是也可以考虑不用备份，如果临时文件发生故障，可以删除该数据文件与表空间，重建一个临时表空间。</p>
<p>热备份的优点:</p>
<ul>
<li>可在表空间或数据文件级备份，备份时间短。  </li>
<li>备份时数据库仍可使用。  </li>
<li>可达到秒级恢复（恢复到某一时间点上）。  </li>
<li>可对几乎所有数据库实体作恢复。  </li>
<li>恢复是快速的，在大多数情况下在数据库仍工作时恢复。</li>
</ul>
</blockquote>
<a id="more"></a>
<blockquote>
<p>场景: 数据库打开时的恢复以用户数据的表空间为例(热备)</p>
<p>step 1: 创建新的表空间（tab02）<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">SQL&gt; create tablespace tab02 datafile '/home/oracle/app/oracle/oradata/mmpdb3/tab02.dbf' size 10M;</div><div class="line"></div><div class="line">Tablespace created.</div><div class="line"></div><div class="line">SQL&gt; select FILE#, TS#, NAME from v$datafile;</div><div class="line"></div><div class="line">     FILE#        TS# NAME</div><div class="line">---------- ---------- ------------------------------------------------------------</div><div class="line">         6          7 /home/oracle/app/oracle/oradata/mmpdb3/tab02.dbf</div></pre></td></tr></table></figure></p>
<p>step 2: 创建新的表（t02），使用tab02表空间<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">SQL&gt; create table t02(id number(10), name varchar(10)) tablespace tab02;</div><div class="line"></div><div class="line">Table created.</div><div class="line"></div><div class="line">SQL&gt; insert into t02 values(1, 'test01');</div><div class="line"></div><div class="line">1 row created.</div><div class="line"></div><div class="line">SQL&gt; commit;</div><div class="line"></div><div class="line">Commit complete.</div><div class="line"></div><div class="line">SQL&gt; select * from t02;</div><div class="line"></div><div class="line">        ID NAME</div><div class="line">---------- ---------------</div><div class="line">         1 test01</div></pre></td></tr></table></figure></p>
<p>step 3: 热备份表空间（tab02）<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter tablespace tab02 begin backup;</div><div class="line">alter tablespace tab02 begin backup</div><div class="line">*</div><div class="line">ERROR at line 1:</div><div class="line">ORA-01123: cannot start online backup; media recovery not enabled</div><div class="line"></div><div class="line">SQL&gt; archive log list;</div><div class="line">Database log mode              No Archive Mode</div><div class="line">Automatic archival             Disabled</div><div class="line">Archive destination            USE_DB_RECOVERY_FILE_DEST</div><div class="line">Oldest online log sequence     7</div><div class="line">Current log sequence           9</div><div class="line"></div><div class="line">SQL&gt; startup mount;</div><div class="line">SQL&gt; alter database archivelog;</div><div class="line">SQL&gt; alter database open;</div><div class="line"></div><div class="line">SQL&gt; alter tablespace tab02 begin backup;</div><div class="line"></div><div class="line">Tablespace altered.</div><div class="line"></div><div class="line">[root@hzvscmdb mmpdb3]# cp -a /home/oracle/app/oracle/oradata/mmpdb3/tab02.dbf /home/oracle/dbbak/hot</div><div class="line"></div><div class="line">SQL&gt; alter tablespace tab02 end backup;</div><div class="line"></div><div class="line">Tablespace altered.</div></pre></td></tr></table></figure></p>
<p>step 4: 向表t02, 插入新的数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">SQL&gt; insert into t02 values(2, &apos;test02&apos;);</div><div class="line"></div><div class="line">1 row created.</div><div class="line"></div><div class="line">SQL&gt; commit;</div><div class="line"></div><div class="line">Commit complete.</div><div class="line"></div><div class="line">SQL&gt; select * from t02;</div><div class="line"></div><div class="line">        ID NAME</div><div class="line">---------- -----------------</div><div class="line">         1 test01</div><div class="line">         2 test02</div></pre></td></tr></table></figure></p>
<p>step 4: 模拟删除表空间，并进行恢复<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">[root@hzvscmdb mmpdb3]# rm -rf tab02.dbf</div><div class="line"></div><div class="line">SQL&gt; select * from t02;</div><div class="line"></div><div class="line">        ID NAME</div><div class="line">---------- -----------------</div><div class="line">         1 test01</div><div class="line">         2 test02</div><div class="line"></div><div class="line">SQL&gt; alter database datafile 6 offline;</div><div class="line"></div><div class="line">Database altered.</div><div class="line"></div><div class="line"></div><div class="line">[root@hzvscmdb mmpdb3]# cp -a /home/oracle/dbbak/hot/tab02.dbf ./</div><div class="line"></div><div class="line">SQL&gt; select * from t02;</div><div class="line">select * from t02</div><div class="line">*</div><div class="line">ERROR at line 1:</div><div class="line">ORA-00376: file 6 cannot be read at this time</div><div class="line">ORA-01110: data file 6: '/home/oracle/app/oracle/oradata/mmpdb3/tab02.dbf'</div><div class="line"></div><div class="line">SQL&gt; recover datafile 6;</div><div class="line">Media recovery complete.</div><div class="line"></div><div class="line">SQL&gt; select FILE#, TS#, NAME, status  from v$datafile;</div><div class="line"></div><div class="line">     FILE#        TS# NAME                                                         STATUS</div><div class="line">---------- ---------- ------------------------------------------------------------ -------</div><div class="line">         1          0 /home/oracle/app/oracle/oradata/mmpdb3/system01.dbf          SYSTEM</div><div class="line">         2          1 /home/oracle/app/oracle/oradata/mmpdb3/sysaux01.dbf          ONLINE</div><div class="line">         3          2 /home/oracle/app/oracle/oradata/mmpdb3/undotbs01.dbf         ONLINE</div><div class="line">         4          4 /home/oracle/app/oracle/oradata/mmpdb3/users01.dbf           ONLINE</div><div class="line">         5          6 /home/oracle/app/oracle/oradata/mmpdb3/tab01.dbf             ONLINE</div><div class="line">         6          7 /home/oracle/app/oracle/oradata/mmpdb3/tab02.dbf             OFFLINE</div><div class="line"></div><div class="line">SQL&gt; alter database datafile 6 online;</div><div class="line"></div><div class="line">Database altered.</div><div class="line"></div><div class="line">SQL&gt; select * from t02;</div><div class="line"></div><div class="line">        ID NAME</div><div class="line">---------- -----------------</div><div class="line">         1 test01</div><div class="line">         2 test02</div></pre></td></tr></table></figure></p>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Oracle备份恢复案例1-使用冷备份数据文件实现恢复]]></title>
      <url>http://wangbinbin0326.github.io/2016/11/16/Oracle%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%A1%88%E4%BE%8B1-%E4%BD%BF%E7%94%A8%E5%86%B7%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6%E5%AE%9E%E7%8E%B0%E6%81%A2%E5%A4%8D/</url>
      <content type="html"><![CDATA[<blockquote>
<p>场景: 数据库关闭时的恢复(system,sysaux,undo,whole database):user表空间为例(冷备)</p>
<p>step 1: 查看有哪些数据文件</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> v$dbfile;</div><div class="line">     FILE NAME</div><div class="line"><span class="comment">---------- ------------------------------------------------------------</span></div><div class="line">         4 /home/oracle/app/oracle/oradata/mmpdb3/users01.dbf</div><div class="line">         3 /home/oracle/app/oracle/oradata/mmpdb3/undotbs01.dbf</div><div class="line">         2 /home/oracle/app/oracle/oradata/mmpdb3/sysaux01.dbf</div><div class="line">         1 /home/oracle/app/oracle/oradata/mmpdb3/system01.dbf</div><div class="line">         5 /home/oracle/app/oracle/oradata/mmpdb3/tab01.dbf</div></pre></td></tr></table></figure>
<a id="more"></a>
<blockquote>
<p>step 2: 冷备整个数据文件</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">SQL&gt; shutdown immediate;</div><div class="line">Database closed.</div><div class="line">Database dismounted.</div><div class="line">ORACLE instance shut down.</div><div class="line"></div><div class="line">[root@hzvscmdb mmpdb3]# cp -a -r /home/oracle/app/oracle/oradata/mmpdb3/ /home/oracle/dbbak/cold/</div></pre></td></tr></table></figure>
<blockquote>
<p>step 3: 删除users01数据文件，模拟发送事故</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">SQL&gt; startup;</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 6664212480 bytes</div><div class="line">Fixed Size                  2239072 bytes</div><div class="line">Variable Size            3456107936 bytes</div><div class="line">Database Buffers         3187671040 bytes</div><div class="line">Redo Buffers               18194432 bytes</div><div class="line">Database mounted.</div><div class="line">Database opened.</div><div class="line"></div><div class="line">SQL&gt; insert into mp.obj(OBJECT_ID, OBJECT_NAME) values(88888, 'test888');</div><div class="line"></div><div class="line">1 row created.</div><div class="line"></div><div class="line">SQL&gt; commit;</div><div class="line"></div><div class="line">Commit complete.</div><div class="line"></div><div class="line">SQL&gt; select count(*) from mp.obj;</div><div class="line"></div><div class="line">  COUNT(*)</div><div class="line">----------</div><div class="line">     72395</div><div class="line"></div><div class="line">SQL&gt; alter system switch logfile;</div><div class="line"></div><div class="line">System altered.</div><div class="line"></div><div class="line">SQL&gt; shutdown abort;</div><div class="line">ORACLE instance shut down.</div><div class="line">SQL&gt; startup;</div><div class="line"></div><div class="line">SQL&gt; startup;</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 6664212480 bytes</div><div class="line">Fixed Size                  2239072 bytes</div><div class="line">Variable Size            3456107936 bytes</div><div class="line">Database Buffers         3187671040 bytes</div><div class="line">Redo Buffers               18194432 bytes</div><div class="line">Database mounted.</div><div class="line">ORA-01157: cannot identify/lock data file 4 - see DBWR trace file</div><div class="line">ORA-01110: data file 4: '/home/oracle/app/oracle/oradata/mmpdb3/users01.dbf'</div></pre></td></tr></table></figure>
<blockquote>
<p>step 4: copy冷备份的users01.dbf，并采用介质恢复</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@hzvscmdb mmpdb3]# cp -a /home/oracle/dbbak/cold/mmpdb3/users01.dbf ./</div><div class="line"></div><div class="line">SQL&gt; recover datafile 4;</div><div class="line">Media recovery complete.</div><div class="line"></div><div class="line">SQL&gt; alter database open;</div><div class="line"></div><div class="line">Database altered.</div><div class="line"></div><div class="line">SQL&gt; select count(*) from mp.obj;</div><div class="line"></div><div class="line">  COUNT(*)</div><div class="line">----------</div><div class="line">     72395</div></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Oracle清除离线数据文件记录]]></title>
      <url>http://wangbinbin0326.github.io/2016/11/11/Oracle%E6%B8%85%E9%99%A4%E7%A6%BB%E7%BA%BF%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6%E8%AE%B0%E5%BD%95/</url>
      <content type="html"><![CDATA[<h2 id="Oracle清除离线数据文件记录"><a href="#Oracle清除离线数据文件记录" class="headerlink" title="Oracle清除离线数据文件记录"></a>Oracle清除离线数据文件记录</h2><blockquote>
<p>测试前提：数据文件离线，系统上删除了该文件，需要删除在数据字典中，关于这条离线数据文件记录</p>
</blockquote>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div></pre></td><td class="code"><pre><div class="line">SQL&gt; archive log list;</div><div class="line">Database log mode              Archive Mode</div><div class="line">Automatic archival             Enabled</div><div class="line">Archive destination            /opt/oracle/oradata/test/archivelog</div><div class="line">Oldest online log sequence     210</div><div class="line">Next log sequence to archive   212</div><div class="line">Current log sequence           212</div><div class="line">--数据库是归档模式</div><div class="line"> </div><div class="line">SQL&gt; col file_name for a40</div><div class="line">SQL&gt;  select file_id,file_name,bytes from dba_data_files order by 1;</div><div class="line"> </div><div class="line">   FILE_ID FILE_NAME                                     BYTES</div><div class="line">---------- ---------------------------------------- ----------</div><div class="line">         1 /opt/oracle/oradata/test/system01.dbf     524288000</div><div class="line">         2 /opt/oracle/oradata/test/undotbs01.dbf   1289748480</div><div class="line">         3 /opt/oracle/oradata/test/sysaux01.dbf     377487360</div><div class="line">         4 /opt/oracle/oradata/test/users01.dbf        5242880</div><div class="line">         5 /opt/oracle/oradata/test/user32g.dbf       10485760</div><div class="line">         6 /opt/oracle/oradata/test/xifenfei01.dbf    20971520</div><div class="line">         7 /opt/oracle/oradata/test/user02.dbf        10485760</div><div class="line">         8 /opt/oracle/oradata/test/odu02.dbf       1.1283E+10</div><div class="line">         9 /opt/oracle/oradata/test/odu01.dbf        104857600</div><div class="line">        10 /opt/oracle/oradata/test/odu03.chf                            </div><div class="line"> </div><div class="line">10 rows selected.</div><div class="line"> </div><div class="line">SQL&gt; col error for a20</div><div class="line">SQL&gt;  select file#,ONLINE_STATUS,ERROR,CHANGE# from V$RECOVER_FILE order by 1;</div><div class="line"> </div><div class="line">     FILE# ONLINE_ ERROR                   CHANGE#</div><div class="line">---------- ------- -------------------- ----------</div><div class="line">        10 OFFLINE FILE NOT FOUND                0</div><div class="line"> </div><div class="line">SQL&gt; !ls /opt/oracle/oradata/test/odu03.chf</div><div class="line">ls: /opt/oracle/oradata/test/odu03.chf: No such file or directory</div><div class="line">--说明该数据文件已经从硬盘上删除</div><div class="line"> </div><div class="line">SQL&gt; shutdown immediate</div><div class="line">Database closed.</div><div class="line">Database dismounted.</div><div class="line">ORACLE instance shut down.</div><div class="line">SQL&gt; startup nomount</div><div class="line">ORACLE instance started.</div><div class="line"> </div><div class="line">Total System Global Area  209715200 bytes</div><div class="line">Fixed Size                  2082784 bytes</div><div class="line">Variable Size             130025504 bytes</div><div class="line">Database Buffers           71303168 bytes</div><div class="line">Redo Buffers                6303744 bytes</div><div class="line"> </div><div class="line">SQL&gt; CREATE CONTROLFILE REUSE DATABASE &quot;TEST&quot; NORESETLOGS  ARCHIVELOG</div><div class="line">  2      MAXLOGFILES 16</div><div class="line">  3      MAXLOGMEMBERS 3</div><div class="line">  4      MAXDATAFILES 100</div><div class="line">  5      MAXINSTANCES 8</div><div class="line">  6      MAXLOGHISTORY 292</div><div class="line">  7  LOGFILE</div><div class="line">  8    GROUP 1 &apos;/opt/oracle/oradata/test/redo01.log&apos;  SIZE 50M,</div><div class="line">  9    GROUP 2 &apos;/opt/oracle/oradata/test/redo02.log&apos;  SIZE 50M,</div><div class="line"> 10    GROUP 3 &apos;/opt/oracle/oradata/test/redo03.log&apos;  SIZE 50M</div><div class="line"> 11  DATAFILE</div><div class="line"> 12    &apos;/opt/oracle/oradata/test/system01.dbf&apos;,</div><div class="line"> 13    &apos;/opt/oracle/oradata/test/undotbs01.dbf&apos;,</div><div class="line"> 14    &apos;/opt/oracle/oradata/test/sysaux01.dbf&apos;,</div><div class="line"> 15    &apos;/opt/oracle/oradata/test/users01.dbf&apos;,</div><div class="line"> 16    &apos;/opt/oracle/oradata/test/user32g.dbf&apos;,</div><div class="line"> 17    &apos;/opt/oracle/oradata/test/xifenfei01.dbf&apos;,</div><div class="line"> 18    &apos;/opt/oracle/oradata/test/user02.dbf&apos;,</div><div class="line"> 19    &apos;/opt/oracle/oradata/test/odu02.dbf&apos;,</div><div class="line"> 20    &apos;/opt/oracle/oradata/test/odu01.dbf&apos;</div><div class="line">        ,&apos;/opt/oracle/oradata/test/odu03.chf&apos;     --文件不存在，创建控制文件这条记录需要除掉</div><div class="line"> 21  CHARACTER SET ZHS16GBK</div><div class="line"> 22  ;</div><div class="line"> </div><div class="line">Control file created.</div><div class="line"> </div><div class="line"> </div><div class="line">SQL&gt; alter database open;</div><div class="line"> </div><div class="line">Database altered.</div><div class="line"> </div><div class="line">SQL&gt; select file_id,file_name,bytes from dba_data_files order by 1;</div><div class="line"> </div><div class="line">   FILE_ID FILE_NAME                                     BYTES</div><div class="line">---------- ---------------------------------------- ----------</div><div class="line">         1 /opt/oracle/oradata/test/system01.dbf     524288000</div><div class="line">         2 /opt/oracle/oradata/test/undotbs01.dbf   1289748480</div><div class="line">         3 /opt/oracle/oradata/test/sysaux01.dbf     377487360</div><div class="line">         4 /opt/oracle/oradata/test/users01.dbf        5242880</div><div class="line">         5 /opt/oracle/oradata/test/user32g.dbf       10485760</div><div class="line">         6 /opt/oracle/oradata/test/xifenfei01.dbf    20971520</div><div class="line">         7 /opt/oracle/oradata/test/user02.dbf        10485760</div><div class="line">         8 /opt/oracle/oradata/test/odu02.dbf       1.1283E+10</div><div class="line">         9 /opt/oracle/oradata/test/odu01.dbf        104857600</div><div class="line">        10 /opt/oracle/product/10.2.0/db_1/dbs/MISSING00010     --系统默认创建了自定义的数据文件名称</div><div class="line"> </div><div class="line">10 rows selected.</div><div class="line"> </div><div class="line">SQL&gt; select file#,ONLINE_STATUS,ERROR,CHANGE# from V$RECOVER_FILE order by 1;</div><div class="line"> </div><div class="line">     FILE# ONLINE_ ERROR                   CHANGE#</div><div class="line">---------- ------- -------------------- ----------</div><div class="line">        10 OFFLINE FILE MISSING                  0  </div><div class="line">--提示该文件是离线状态，需要恢复，结果同开始时候状态</div><div class="line"> </div><div class="line">SQL&gt; select file#,STATUS$,TS#,RELFILE# from file$ order by 1;</div><div class="line"> </div><div class="line">     FILE#    STATUS$        TS#   RELFILE#</div><div class="line">---------- ---------- ---------- ----------</div><div class="line">         1          2          0          1</div><div class="line">         2          2          1          2</div><div class="line">         3          2          2          3</div><div class="line">         4          2          4          4</div><div class="line">         5          2          4          5</div><div class="line">         6          2          6          6</div><div class="line">         7          2          4          7</div><div class="line">         8          2          7          9</div><div class="line">         9          2          7          6</div><div class="line">        10          2          7         10</div><div class="line">        11          1</div><div class="line"> </div><div class="line">11 rows selected.</div><div class="line"> </div><div class="line">SQL&gt; delete from file$ where file#=10;    ---重要的就是这个操作</div><div class="line"> </div><div class="line">1 row deleted.</div><div class="line"> </div><div class="line">SQL&gt; select file#,STATUS$,TS#,RELFILE# from file$ order by 1;</div><div class="line"> </div><div class="line">     FILE#    STATUS$        TS#   RELFILE#</div><div class="line">---------- ---------- ---------- ----------</div><div class="line">         1          2          0          1</div><div class="line">         2          2          1          2</div><div class="line">         3          2          2          3</div><div class="line">         4          2          4          4</div><div class="line">         5          2          4          5</div><div class="line">         6          2          6          6</div><div class="line">         7          2          4          7</div><div class="line">         8          2          7          9</div><div class="line">         9          2          7          6</div><div class="line">        11          1</div><div class="line"> </div><div class="line">10 rows selected.</div><div class="line"> </div><div class="line">SQL&gt; col name for a40</div><div class="line">SQL&gt; select * from v$dbfile order by 1;</div><div class="line"> </div><div class="line">     FILE# NAME</div><div class="line">---------- ----------------------------------------</div><div class="line">         1 /opt/oracle/oradata/test/system01.dbf</div><div class="line">         2 /opt/oracle/oradata/test/undotbs01.dbf</div><div class="line">         3 /opt/oracle/oradata/test/sysaux01.dbf</div><div class="line">         4 /opt/oracle/oradata/test/users01.dbf</div><div class="line">         5 /opt/oracle/oradata/test/user32g.dbf</div><div class="line">         6 /opt/oracle/oradata/test/xifenfei01.dbf</div><div class="line">         7 /opt/oracle/oradata/test/user02.dbf</div><div class="line">         8 /opt/oracle/oradata/test/odu02.dbf</div><div class="line">         9 /opt/oracle/oradata/test/odu01.dbf</div><div class="line">        10 /opt/oracle/product/10.2.0/db_1/dbs/MISSING00010</div><div class="line"> </div><div class="line">10 rows selected.</div><div class="line">--需要重建控制文件，删除不存在的数据文件</div><div class="line"> </div><div class="line">SQL&gt; shutdown immediate</div><div class="line">Database closed.</div><div class="line">Database dismounted.</div><div class="line">ORACLE instance shut down.</div><div class="line">SQL&gt; STARTUP NOMOUNT</div><div class="line">ORACLE instance started.</div><div class="line"> </div><div class="line">Total System Global Area  209715200 bytes</div><div class="line">Fixed Size                  2082784 bytes</div><div class="line">Variable Size             130025504 bytes</div><div class="line">Database Buffers           71303168 bytes</div><div class="line">Redo Buffers                6303744 bytes</div><div class="line"> </div><div class="line">SQL&gt; CREATE CONTROLFILE REUSE DATABASE &quot;TEST&quot; NORESETLOGS  ARCHIVELOG</div><div class="line">  2      MAXLOGFILES 16</div><div class="line">  3      MAXLOGMEMBERS 3</div><div class="line">  4      MAXDATAFILES 100</div><div class="line">  5      MAXINSTANCES 8</div><div class="line">  6      MAXLOGHISTORY 292</div><div class="line">  7  LOGFILE</div><div class="line">  8    GROUP 1 &apos;/opt/oracle/oradata/test/redo01.log&apos;  SIZE 50M,</div><div class="line">  9    GROUP 2 &apos;/opt/oracle/oradata/test/redo02.log&apos;  SIZE 50M,</div><div class="line"> 10    GROUP 3 &apos;/opt/oracle/oradata/test/redo03.log&apos;  SIZE 50M</div><div class="line"> 11  DATAFILE</div><div class="line"> 12    &apos;/opt/oracle/oradata/test/system01.dbf&apos;,</div><div class="line"> 13    &apos;/opt/oracle/oradata/test/undotbs01.dbf&apos;,</div><div class="line"> 14    &apos;/opt/oracle/oradata/test/sysaux01.dbf&apos;,</div><div class="line"> 15    &apos;/opt/oracle/oradata/test/users01.dbf&apos;,</div><div class="line"> 16    &apos;/opt/oracle/oradata/test/user32g.dbf&apos;,</div><div class="line"> 17    &apos;/opt/oracle/oradata/test/xifenfei01.dbf&apos;,</div><div class="line"> 18    &apos;/opt/oracle/oradata/test/user02.dbf&apos;,</div><div class="line"> 19    &apos;/opt/oracle/oradata/test/odu02.dbf&apos;,</div><div class="line"> 20    &apos;/opt/oracle/oradata/test/odu01.dbf&apos;</div><div class="line"> 21  CHARACTER SET ZHS16GBK</div><div class="line"> 22  ;</div><div class="line"> </div><div class="line">Control file created.</div><div class="line"> </div><div class="line">SQL&gt; alter database open;</div><div class="line"> </div><div class="line">Database altered.</div><div class="line"> </div><div class="line">SQL&gt; select file_id,file_name,bytes from dba_data_files order by 1;</div><div class="line"> </div><div class="line">   FILE_ID FILE_NAME                                     BYTES</div><div class="line">---------- ---------------------------------------- ----------</div><div class="line">         1 /opt/oracle/oradata/test/system01.dbf     524288000</div><div class="line">         2 /opt/oracle/oradata/test/undotbs01.dbf   1289748480</div><div class="line">         3 /opt/oracle/oradata/test/sysaux01.dbf     377487360</div><div class="line">         4 /opt/oracle/oradata/test/users01.dbf        5242880</div><div class="line">         5 /opt/oracle/oradata/test/user32g.dbf       10485760</div><div class="line">         6 /opt/oracle/oradata/test/xifenfei01.dbf    20971520</div><div class="line">         7 /opt/oracle/oradata/test/user02.dbf        10485760</div><div class="line">         8 /opt/oracle/oradata/test/odu02.dbf       1.1283E+10</div><div class="line">         9 /opt/oracle/oradata/test/odu01.dbf        104857600</div><div class="line"> </div><div class="line">9 rows selected.</div><div class="line"> </div><div class="line">SQL&gt; select * from v$dbfile order by 1;</div><div class="line"> </div><div class="line">     FILE# NAME</div><div class="line">---------- ----------------------------------------</div><div class="line">         1 /opt/oracle/oradata/test/system01.dbf</div><div class="line">         2 /opt/oracle/oradata/test/undotbs01.dbf</div><div class="line">         3 /opt/oracle/oradata/test/sysaux01.dbf</div><div class="line">         4 /opt/oracle/oradata/test/users01.dbf</div><div class="line">         5 /opt/oracle/oradata/test/user32g.dbf</div><div class="line">         6 /opt/oracle/oradata/test/xifenfei01.dbf</div><div class="line">         7 /opt/oracle/oradata/test/user02.dbf</div><div class="line">         8 /opt/oracle/oradata/test/odu02.dbf</div><div class="line">         9 /opt/oracle/oradata/test/odu01.dbf</div><div class="line"> </div><div class="line">9 rows selected.</div></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Oracle无法删除数据文件]]></title>
      <url>http://wangbinbin0326.github.io/2016/11/11/Oracle%E6%97%A0%E6%B3%95%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6/</url>
      <content type="html"><![CDATA[<h2 id="Oracle无法删除数据文件"><a href="#Oracle无法删除数据文件" class="headerlink" title="Oracle无法删除数据文件"></a>Oracle无法删除数据文件</h2><blockquote>
<p>有些时候，想删除一个数据文件(临时文件),在10g之前的版本，要删除一个数据文件，必须删除该数据文件所属的表空间(特殊处理方法除外)。不太懂数据库的朋友直接os级别删除数据文件，导致数据库不能正常启动;稍微等点数据库的朋友，会先offline数据文件，然后os级别删除，但是这条数据文件的记录还保留在数据字典中，。在10g及其以后版本中，oracle提供了alter tablespace talbespace_name drop datafile/tempfile path/file_id进行删除某个数据文件。</p>
<p>Cannot Drop Empty Datafile From Tablespace ORA-03262 in oracle 11g R2</p>
</blockquote>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line">--删除数据文件</div><div class="line">SQL&gt; col tablespace_name for a20</div><div class="line">SQL&gt; col file_name for a50</div><div class="line">SQL&gt; set line 120</div><div class="line">SQL&gt; select file_id,file_name,tablespace_name </div><div class="line">   2 from dba_data_files order by tablespace_name;</div><div class="line"> </div><div class="line">   FILE_ID FILE_NAME                                          TABLESPACE_NAME</div><div class="line">---------- -------------------------------------------------- --------------------</div><div class="line">         9 /opt/oracle/oradata/test/odu01.dbf                 ODU</div><div class="line">        10 /opt/oracle/oradata/test/odu03.dbf                 ODU</div><div class="line">         8 /opt/oracle/oradata/test/odu02.dbf                 ODU</div><div class="line">         3 /opt/oracle/oradata/test/sysaux01.dbf              SYSAUX</div><div class="line">         1 /opt/oracle/oradata/test/system01.dbf              SYSTEM</div><div class="line">         2 /opt/oracle/oradata/test/undotbs01.dbf             UNDOTBS1</div><div class="line">         5 /opt/oracle/oradata/test/user32g.dbf               USERS</div><div class="line">         7 /opt/oracle/oradata/test/user02.dbf                USERS</div><div class="line">         4 /opt/oracle/oradata/test/users01.dbf               USERS</div><div class="line">         6 /opt/oracle/oradata/test/xifenfei01.dbf            XFF</div><div class="line">        11 /opt/oracle/oradata/test/xifenfei03.dbf            XFF</div><div class="line"> </div><div class="line">11 rows selected.</div><div class="line"> </div><div class="line">SQL&gt; !ls -l /opt/oracle/oradata/test/ *.dbf</div><div class="line">-rw-r----- 1 oracle oinstall   104865792 Dec  8 00:05 /opt/oracle/oradata/test/odu01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall 11282685952 Dec  8 00:05 /opt/oracle/oradata/test/odu02.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    10493952 Dec  8 00:05 /opt/oracle/oradata/test/odu03.dbf</div><div class="line">-rw-r----- 1 oracle oinstall   387981312 Dec  8 12:36 /opt/oracle/oradata/test/sysaux01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall   534781952 Dec  8 12:45 /opt/oracle/oradata/test/system01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall   104865792 Dec  7 22:01 /opt/oracle/oradata/test/temp01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall  1289756672 Dec  8 12:45 /opt/oracle/oradata/test/undotbs01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    10493952 Dec  8 00:05 /opt/oracle/oradata/test/user02.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    10493952 Dec  8 00:05 /opt/oracle/oradata/test/user32g.dbf</div><div class="line">-rw-r----- 1 oracle oinstall     5251072 Dec  8 00:05 /opt/oracle/oradata/test/users01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    20979712 Dec  8 00:05 /opt/oracle/oradata/test/xifenfei01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    10493952 Dec  8 00:05 /opt/oracle/oradata/test/xifenfei03.dbf</div><div class="line"> </div><div class="line">SQL&gt; alter tablespace xff drop datafile 11;</div><div class="line">alter tablespace xff drop datafile 11</div><div class="line">*</div><div class="line">ERROR at line 1:</div><div class="line">ORA-03262: the file is non-empty</div><div class="line"></div><div class="line">SQL&gt; col segment_name for a20</div><div class="line">SQL&gt; select owner,SEGMENT_NAME,FILE_ID,BLOCKS from dba_extents</div><div class="line">  2  where file_id=11;</div><div class="line"> </div><div class="line">OWNER                          SEGMENT_NAME            FILE_ID     BLOCKS</div><div class="line">------------------------------ -------------------- ---------- ----------</div><div class="line">CHF                            XFF_TEST                     11          8</div><div class="line">CHF                            XFF_TEST                     11        128</div><div class="line">CHF                            XFF_TEST                     11        128</div><div class="line">CHF                            T_XFF                        11        128</div><div class="line">CHF                            T_XFF                        11        128</div><div class="line"> </div><div class="line">SQL&gt; alter table chf.xff_test move tablespace users;</div><div class="line"> </div><div class="line">Table altered.</div><div class="line"> </div><div class="line">SQL&gt; alter table chf.t_xff move tablespace users;</div><div class="line"> </div><div class="line">Table altered.</div><div class="line"> </div><div class="line">SQL&gt; select owner,SEGMENT_NAME,FILE_ID,BLOCKS from dba_extents</div><div class="line">  2  where file_id=11;</div><div class="line"> </div><div class="line">no rows selected</div><div class="line"> </div><div class="line">SQL&gt; alter tablespace xff drop datafile 11;</div><div class="line"> </div><div class="line">Tablespace altered.</div><div class="line"> </div><div class="line">SQL&gt; select file_id,file_name,tablespace_name </div><div class="line">  2  from dba_data_files order by tablespace_name;</div><div class="line"> </div><div class="line">   FILE_ID FILE_NAME                                          TABLESPACE_NAME</div><div class="line">---------- -------------------------------------------------- --------------------</div><div class="line">         9 /opt/oracle/oradata/test/odu01.dbf                 ODU</div><div class="line">        10 /opt/oracle/oradata/test/odu03.dbf                 ODU</div><div class="line">         8 /opt/oracle/oradata/test/odu02.dbf                 ODU</div><div class="line">         3 /opt/oracle/oradata/test/sysaux01.dbf              SYSAUX</div><div class="line">         1 /opt/oracle/oradata/test/system01.dbf              SYSTEM</div><div class="line">         2 /opt/oracle/oradata/test/undotbs01.dbf             UNDOTBS1</div><div class="line">         4 /opt/oracle/oradata/test/users01.dbf               USERS</div><div class="line">         7 /opt/oracle/oradata/test/user02.dbf                USERS</div><div class="line">         5 /opt/oracle/oradata/test/user32g.dbf               USERS</div><div class="line">         6 /opt/oracle/oradata/test/xifenfei01.dbf            XFF</div><div class="line"> </div><div class="line">10 rows selected.</div><div class="line"> </div><div class="line">SQL&gt; !ls -l /opt/oracle/oradata/test/ *.dbf</div><div class="line">-rw-r----- 1 oracle oinstall   104865792 Dec  8 00:05 /opt/oracle/oradata/test/odu01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall 11282685952 Dec  8 00:05 /opt/oracle/oradata/test/odu02.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    10493952 Dec  8 00:05 /opt/oracle/oradata/test/odu03.dbf</div><div class="line">-rw-r----- 1 oracle oinstall   387981312 Dec  8 12:36 /opt/oracle/oradata/test/sysaux01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall   534781952 Dec  8 12:45 /opt/oracle/oradata/test/system01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall   104865792 Dec  7 22:01 /opt/oracle/oradata/test/temp01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall  1289756672 Dec  8 12:45 /opt/oracle/oradata/test/undotbs01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    10493952 Dec  8 12:52 /opt/oracle/oradata/test/user02.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    10493952 Dec  8 12:52 /opt/oracle/oradata/test/user32g.dbf</div><div class="line">-rw-r----- 1 oracle oinstall     5251072 Dec  8 12:52 /opt/oracle/oradata/test/users01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    20979712 Dec  8 12:52 /opt/oracle/oradata/test/xifenfei01.dbf</div></pre></td></tr></table></figure>
<blockquote>
<p>删除临时表空间文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter  tablespace temp add tempfile &apos;/opt/oracle/oradata/test/xff_temp02.dbf&apos; size 10m;</div><div class="line"> </div><div class="line">Tablespace altered.</div><div class="line"> </div><div class="line">SQL&gt; select file_id,file_name,tablespace_name from dba_temp_files;</div><div class="line"> </div><div class="line">   FILE_ID FILE_NAME                                          TABLESPACE_NAME</div><div class="line">---------- -------------------------------------------------- --------------------</div><div class="line">         2 /opt/oracle/oradata/test/xff_temp02.dbf            TEMP</div><div class="line">         1 /opt/oracle/oradata/test/temp01.dbf                TEMP</div><div class="line"> </div><div class="line">SQL&gt; !ls -l /opt/oracle/oradata/test/ *.dbf</div><div class="line">-rw-r----- 1 oracle oinstall   104865792 Dec  8 00:05 /opt/oracle/oradata/test/odu01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall 11282685952 Dec  8 00:05 /opt/oracle/oradata/test/odu02.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    10493952 Dec  8 00:05 /opt/oracle/oradata/test/odu03.dbf</div><div class="line">-rw-r----- 1 oracle oinstall   387981312 Dec  8 13:00 /opt/oracle/oradata/test/sysaux01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall   534781952 Dec  8 12:58 /opt/oracle/oradata/test/system01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall   104865792 Dec  7 22:01 /opt/oracle/oradata/test/temp01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall  1289756672 Dec  8 12:57 /opt/oracle/oradata/test/undotbs01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    10493952 Dec  8 12:57 /opt/oracle/oradata/test/user02.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    10493952 Dec  8 12:57 /opt/oracle/oradata/test/user32g.dbf</div><div class="line">-rw-r----- 1 oracle oinstall     5251072 Dec  8 12:57 /opt/oracle/oradata/test/users01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    10493952 Dec  8 13:00 /opt/oracle/oradata/test/xff_temp02.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    20979712 Dec  8 12:57 /opt/oracle/oradata/test/xifenfei01.dbf</div><div class="line"> </div><div class="line">SQL&gt; alter tablespace temp drop tempfile 2;</div><div class="line"> </div><div class="line">Tablespace altered.</div><div class="line"> </div><div class="line">SQL&gt; !ls -l /opt/oracle/oradata/test/ *.dbf</div><div class="line">-rw-r----- 1 oracle oinstall   104865792 Dec  8 00:05 /opt/oracle/oradata/test/odu01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall 11282685952 Dec  8 00:05 /opt/oracle/oradata/test/odu02.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    10493952 Dec  8 00:05 /opt/oracle/oradata/test/odu03.dbf</div><div class="line">-rw-r----- 1 oracle oinstall   387981312 Dec  8 13:00 /opt/oracle/oradata/test/sysaux01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall   534781952 Dec  8 12:58 /opt/oracle/oradata/test/system01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall   104865792 Dec  7 22:01 /opt/oracle/oradata/test/temp01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall  1289756672 Dec  8 12:57 /opt/oracle/oradata/test/undotbs01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    10493952 Dec  8 12:57 /opt/oracle/oradata/test/user02.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    10493952 Dec  8 12:57 /opt/oracle/oradata/test/user32g.dbf</div><div class="line">-rw-r----- 1 oracle oinstall     5251072 Dec  8 12:57 /opt/oracle/oradata/test/users01.dbf</div><div class="line">-rw-r----- 1 oracle oinstall    20979712 Dec  8 12:57 /opt/oracle/oradata/test/xifenfei01.dbf</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Oracle无法正常关闭]]></title>
      <url>http://wangbinbin0326.github.io/2016/11/11/Oracle%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E5%85%B3%E9%97%AD/</url>
      <content type="html"><![CDATA[<h2 id="Oracle-无法正常关闭"><a href="#Oracle-无法正常关闭" class="headerlink" title="Oracle 无法正常关闭"></a>Oracle 无法正常关闭</h2><blockquote>
<ol>
<li><p><strong>Stop the listener</strong> - you can at least prevent others from connecting to the instance that you’re trying to shut down:  <code>bash-3.00$ lsnrctl stop</code></p>
</li>
<li><p><strong>Get a list of processes hitting the database</strong>.  You’ll need that before you start killing them off one by one:  bash-3.00$ ps -eaf|grep LOCAL</p>
</li>
<li><p><strong>Kill the processes.</strong>  Take the second column’s output from step #2 and execute the following:  <code>bash-3.00$ kill -9 396</code> - where “396” is the processid you wish to kill.</p>
</li>
</ol>
</blockquote>
<a id="more"></a>
<blockquote>
<ol>
<li><p>Enter into SQLPlus and connect as SYSDBA:  <code>SQL&gt; conn /as sysdba</code> - you’ll receive <code>&quot;Connected to an idle instance&quot;</code></p>
</li>
<li><p><strong>Shutdown the database</strong> via <code>SQL&gt; shutdown immediate</code> You may be given the following:<br><code>ORA-24324: service handle not initialized</code><br><code>ORA-24323: value not allowed</code><br><code>ORA-01090: shutdown in progress - connection is not permitted</code></p>
</li>
<li><p><strong>Reconnect to SQLPlus via sysdba</strong> via <code>SQL&gt; conn /as sysdba</code></p>
</li>
<li><p><strong>Execute a <code>startup force</code> command</strong>.</p>
</li>
<li><p>Don’t forget to start the listener back up</p>
</li>
</ol>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">-- issue：主库运行了切换到standby, 失败后，发现数据库无法连接，与操作</div><div class="line">SQL&gt; alter database commit to switchover to physical standby;</div><div class="line">alter database commit to switchover to physical standby</div><div class="line">*</div><div class="line">ERROR at line 1:</div><div class="line">ORA-01093: ALTER DATABASE CLOSE only permitted with no sessions connected</div><div class="line"></div><div class="line">[root@hzvscmdb alert]# tail -f log.xml</div><div class="line">&lt;msg time=&apos;2016-11-10T02:09:42.814+00:00&apos; org_id=&apos;oracle&apos; comp_id=&apos;rdbms&apos;</div><div class="line"> msg_id=&apos;opiexe:3036:2780954927&apos; client_id=&apos;&apos; type=&apos;NOTIFICATION&apos;</div><div class="line"> group=&apos;admin_ddl&apos; level=&apos;16&apos; host_id=&apos;hzvscmdb&apos;</div><div class="line"> host_addr=&apos;10.224.188.188&apos; module=&apos;sqlplus@hzvscmdb (TNS V1-V3)&apos; pid=&apos;24748&apos;&gt;</div><div class="line"> &lt;txt&gt;ORA-1093 signalled during: alter database commit to switchover to physical standby...</div><div class="line"> &lt;/txt&gt;</div><div class="line">&lt;/msg&gt;</div><div class="line"></div><div class="line">[oracle@hzvscmdb dbs]$ sqlplus / as sysdba</div><div class="line"></div><div class="line">SQL*Plus: Release 11.2.0.2.0 Production on Thu Nov 10 02:40:32 2016</div><div class="line"></div><div class="line">Copyright (c) 1982, 2010, Oracle.  All rights reserved.</div><div class="line"></div><div class="line">Connected.</div><div class="line">SQL&gt; shutdown immediate;</div><div class="line">ORA-24324: service handle not initialized</div><div class="line">ORA-24323: value not allowed</div><div class="line">ORA-01094: ALTER DATABASE CLOSE in progress. Connections not permitted</div><div class="line"></div><div class="line">SQL&gt; startup;</div><div class="line">ORA-01031: insufficient privileges</div><div class="line"></div><div class="line">--解决方法用 startup force; 是shutdown abort + startup的组合，即强制关闭数据库+ 正常启动数据库</div><div class="line">SQL&gt; conn / as sysdba</div><div class="line">Connected to an idle instance.</div><div class="line">SQL&gt; startup;</div><div class="line">ORA-01012: not logged on</div><div class="line">SQL&gt; startup force;</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 1603411968 bytes</div><div class="line">Fixed Size                  2226912 bytes</div><div class="line">Variable Size            1124074784 bytes</div><div class="line">Database Buffers          469762048 bytes</div><div class="line">Redo Buffers                7348224 bytes</div><div class="line">Database mounted.</div><div class="line">Database opened.</div></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL-转换函数]]></title>
      <url>http://wangbinbin0326.github.io/2016/11/04/SQL-%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0/</url>
      <content type="html"><![CDATA[<h2 id="4-使用转换函数和条件表达式"><a href="#4-使用转换函数和条件表达式" class="headerlink" title="4. 使用转换函数和条件表达式"></a>4. 使用转换函数和条件表达式</h2><blockquote>
<p>隐式数据类型转换, Oracle Server 可以自动执行以下转换:</p>
<ul>
<li>VARCHAR2 或CHAR —&gt; NUMBER</li>
<li>VARCHAR2 或CHAR —&gt; DATE</li>
<li>NUMBER —&gt; VARCHAR2 或CHAR</li>
<li>DATE   —&gt; VARCHAR2 或CHAR</li>
</ul>
<p>注： number 与date 不能隐式转换</p>
</blockquote>
<a id="more"></a>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div></pre></td><td class="code"><pre><div class="line">-- 日期可以和字符串自动转换，但是需要与数据库定义的格式一致</div><div class="line">SQL&gt; show parameter nls</div><div class="line"></div><div class="line">NAME                                 TYPE        VALUE</div><div class="line">------------------------------------ ----------- ------------------------------</div><div class="line">nls_date_format                      string      DD-MON-RR</div><div class="line"></div><div class="line"></div><div class="line">SQL&gt; select employee_id, first_name, hire_date from employees where hire_date = '30-JAN-04';</div><div class="line"></div><div class="line">EMPLOYEE_ID FIRST_NAME           HIRE_DATE</div><div class="line">----------- -------------------- ---------</div><div class="line">        156 Janette              30-JAN-04</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">-------------------------------------------------------</div><div class="line">TO_CHAR(date, 'format_model'): 将指定的日期按照某种格式转换为字符串</div><div class="line">-- • 必须放在单引号内</div><div class="line">-- • 区分大小写</div><div class="line">-- • 可以包含任何有效的日期格式元素</div><div class="line">-- • 具有一个fm 元素，用于删除填充的空格或隐藏前导零</div><div class="line">-- • 与日期值之间用逗号分隔</div><div class="line">/*</div><div class="line">YYYY 用数字表示的完整年份</div><div class="line">YEAR 拼写出的年份（用英文表示）</div><div class="line">DY 一周中某日的三个字母缩写</div><div class="line">DAY 一周中某日的完整名称</div><div class="line">MM 月份的两位数值</div><div class="line">MONTH 月份的完整名称</div><div class="line">MON 月份的三个字母缩写</div><div class="line">DD 用数字表示的月份中某日</div><div class="line">FM 去掉查询后的前导0</div><div class="line"></div><div class="line">HH24:MI:SS AM 15:45:32 PM</div><div class="line">DD "of" MONTH 12 of OCTOBER</div><div class="line">ddspth fourteenth</div><div class="line">*/</div><div class="line"></div><div class="line">select last_name,</div><div class="line">to_char(hire_date, 'fmDD Month YYYY')</div><div class="line">as HIREDATE</div><div class="line">from employees;</div><div class="line"></div><div class="line">LAST_NAME                 HIREDATE</div><div class="line">------------------------- -----------------</div><div class="line">OConnell                  21 June 2007</div><div class="line">Grant                     13 January 2008</div><div class="line"></div><div class="line">select sysdate, </div><div class="line">       to_char(sysdate,'yyyy-mm-dd HH24:MI:SS') date1,</div><div class="line">       to_char(sysdate,'year-mm-dd HH:MI:SS') date_year,</div><div class="line">       to_char(sysdate,'yy-month-dd HH:MI:SS') date_month,</div><div class="line">       to_char(sysdate,'yy-mm-dd DY HH:MI:SS') date_num</div><div class="line">from dual;</div><div class="line"></div><div class="line">SYSDATE             DATE1               DATE_YEAR                    </div><div class="line">------------------- ------------------- -----------------------------</div><div class="line">2016-11-02 01:27:05 2016-11-02 01:27:05 twenty sixteen-11-02 01:27:05</div><div class="line"></div><div class="line"> DATE_MONTH               DATE_NUM                 DATE_FM</div><div class="line"> ------------------------ ------------------------ ------------------</div><div class="line"> 16-november -02 01:27:05 16-11-02 WED 01:27:05    16-11-2 WED 1:27:5</div><div class="line"> </div><div class="line"> #查询2月份雇员的员工</div><div class="line"> SQL&gt; select employee_id, first_name, hire_date from employees where to_char(hire_date,'MM')=02;</div><div class="line"></div><div class="line">EMPLOYEE_ID FIRST_NAME                HIRE_DATE</div><div class="line">----------- ------------------------- -------------------</div><div class="line">        201 Michael                   2004-02-17 00:00:00</div><div class="line">        183 Girard                    2008-02-03 00:00:00</div><div class="line">        185 Alexis                    2005-02-20 00:00:00</div><div class="line">        301 Den                       1999-02-03 00:00:00</div><div class="line">        302 test1                     2014-02-01 00:00:00</div><div class="line"></div><div class="line"></div><div class="line">/*</div><div class="line">TO_CHAR(number, 'format_model')： 将指定的数字按照某种格式转换为字符串</div><div class="line"></div><div class="line">9 代表一个数字</div><div class="line">0 强制显示零</div><div class="line">$ 放置一个浮动的美元符号</div><div class="line">L 使用浮动的本地货币符号</div><div class="line">. 显示小数点</div><div class="line">, 显示作为千位指示符的逗号</div><div class="line">*/</div><div class="line"></div><div class="line">select TO_CHAR(salary, '$99,999.00') SALARY</div><div class="line">from employees</div><div class="line">where last_name = 'Ernst';</div><div class="line"></div><div class="line">SALARY</div><div class="line">-----------</div><div class="line">  $6,000.00</div><div class="line"></div><div class="line"># 使用TO_NUMBER 函数可将字符串转换为数字格式：  字符串转换数字可以自动转换</div><div class="line">TO_NUMBER(char[, 'format_model'])</div><div class="line"></div><div class="line"># 使用TO_DATE 函数可将字符串转换为日期格式： 在查询的时候使用的不多，主要用在更新数据时</div><div class="line">TO_DATE(char[, 'format_model'])</div><div class="line"></div><div class="line">select last_name, TO_CHAR(hire_date, 'DD-Mon-YYYY')</div><div class="line">from employees</div><div class="line">where hire_date &lt; TO_DATE('01-Jan-90','DD-Mon-RR');</div><div class="line"></div><div class="line">to_char()：可以匹配2008年的所有记录</div><div class="line">SQL&gt; select employee_id, first_name, to_char(hire_date, 'yyyy-mm-dd')  from employees where to_char(hire_date, 'yyyy') = 2008;</div><div class="line"></div><div class="line">EMPLOYEE_ID FIRST_NAME           TO_CHAR(HI</div><div class="line">----------- -------------------- ----------</div><div class="line">        199 Douglas              2008-01-13</div><div class="line">        183 Girard               2008-02-03</div><div class="line">        128 Steven               2008-03-08</div><div class="line">        136 Hazel                2008-02-06</div><div class="line">        149 Eleni                2008-01-29</div><div class="line"></div><div class="line"></div><div class="line">to_date()：只可以匹配确切的日期</div><div class="line">SQL&gt; select employee_id, first_name, to_char(hire_date, 'yyyy-mm-dd')  from employees where hire_date = to_date(2008,'yyyy');</div><div class="line"></div><div class="line">no rows selected</div><div class="line"></div><div class="line">SQL&gt; select employee_id, first_name, to_char(hire_date, 'yyyy-mm-dd')  from employees where hire_date = to_date(20080113,'yyyymmdd');</div><div class="line"></div><div class="line">EMPLOYEE_ID FIRST_NAME           TO_CHAR(HI</div><div class="line">----------- -------------------- ----------</div><div class="line">        199 Douglas              2008-01-13</div><div class="line"></div><div class="line"></div><div class="line">-- 嵌套函数</div><div class="line">/*</div><div class="line">• 单行函数可以嵌套到任意层。</div><div class="line">• 嵌套函数的计算顺序是从最内层到最外层。</div><div class="line">F3(F2(F1(col,arg1),arg2),arg3)</div><div class="line">*/</div><div class="line"></div><div class="line">select last_name,</div><div class="line">upper(CONCAT(SUBSTR (LAST_NAME, 1, 8), '_US'))</div><div class="line">from employees</div><div class="line">where department_id = 60;</div><div class="line"></div><div class="line">LAST_NAME                 UPPER(CONCA</div><div class="line">------------------------- -----------</div><div class="line">Hunold                    HUNOLD_US</div><div class="line">Ernst                     ERNST_US</div><div class="line">Austin                    AUSTIN_US</div><div class="line">Pataballa                 PATABALL_US</div><div class="line">Lorentz                   LORENTZ_US</div><div class="line"></div><div class="line">select TO_CHAR (ROUND ( (salary / 7), 2),</div><div class="line">                '99G999D99',</div><div class="line">                'NLS_NUMERIC_CHARACTERS = '',.'' ')</div><div class="line">          "Formatted Salary"</div><div class="line">  from employees;</div><div class="line"></div><div class="line">Formatted</div><div class="line">----------</div><div class="line">    371,43</div><div class="line">    371,43</div><div class="line">  1.185,71</div></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ORACLE简单易懂之分区表和索引]]></title>
      <url>http://wangbinbin0326.github.io/2016/11/03/ORACLE%E7%AE%80%E5%8D%95%E6%98%93%E6%87%82%E4%B9%8B%E5%88%86%E5%8C%BA%E8%A1%A8%E5%92%8C%E7%B4%A2%E5%BC%95/</url>
      <content type="html"><![CDATA[<hr>
<h2 id="分区表，分区索引"><a href="#分区表，分区索引" class="headerlink" title="分区表，分区索引"></a>分区表，分区索引</h2><blockquote>
<p>Oracle对于分区表方式其实就是将表分段存储，<strong>一般普通表格是一个段存储，而分区表会分成多个段</strong>，所以查找数据过程都是先定位根据查询条件定位分区范围，即数据在那个分区或那几个内部，然后在分区内部去查找数据，一个分区一般保证四十多万条数据就比较正常了，但是分区表并非乱建立，而其维护性也相对较为复杂一点，而索引的创建也是有点讲究的。</p>
<p>创建时机:</p>
<ul>
<li>2G以上的表，ORACLE推荐创建分区。</li>
<li>分区的字段一定要是经常用以提取数据的字段，否则会在提取过程中导致遍历多个分区，这样比没有分区还要慢。</li>
<li>分区字段要选择合适，数据较为均匀分布到各个分区，不要太多也不要太少，而且根据分区字段可以很快定位到分区范围。</li>
<li>一般情况下，尽量然业务操作在同一个分区内部完成。</li>
</ul>
</blockquote>
<a id="more"></a>
<h2 id="分区类型"><a href="#分区类型" class="headerlink" title="分区类型"></a>分区类型</h2><blockquote>
<ul>
<li><p><strong>range分区</strong>方式，也算是最常用的分区方式，其通过某字段或几个字段的组合的值，从小到大，按照指定的范围说明进行分区，我们在INSERT数据的时候就会存储到指定的分区中。</p>
</li>
<li><p><strong>List分区</strong>方式，一般是在range基础上做的二级分区较多，是一种列举方式进行分区，一般讲某些地区、状态或指定规则的编码等进行划分。</p>
</li>
<li><p><strong>Hash分区</strong>方式，它没有固定的规则，由ORACLE管理，只需要将值INSERT进去，ORACLE会自动去根据一套HASH算法去划分分区，只需要告诉ORACLE要分几个区即可。</p>
</li>
</ul>
<p>分区可以进行两两组合，ORACLE 11G以前两两组合都必须以range作为一级分区的开头，ORACLE目前最多支持2级别分区，但这个级别已经够我们使用了。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> TABLE_PARTITION(  </div><div class="line">       COL1   <span class="built_in">NUMBER</span>,  </div><div class="line">       COL2   VARCHAR2(<span class="number">10</span>)  </div><div class="line">)  </div><div class="line"><span class="keyword">partition</span> <span class="keyword">by</span> <span class="keyword">range</span>(COL1)(  </div><div class="line">          <span class="keyword">partition</span> TAB_PARTOTION_01 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="number">450000</span>),  </div><div class="line">          <span class="keyword">partition</span> TAB_PARTOTION_02 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="number">900000</span>),  </div><div class="line">          <span class="keyword">partition</span> TAB_PARTOTION_03 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="number">1350000</span>),  </div><div class="line">          <span class="keyword">partition</span> TAB_PARTOTION_04 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="number">1800000</span>),  </div><div class="line">          <span class="keyword">partition</span> TAB_PARTOTION_OTHER <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">THAN</span> (MAXVALUE)  </div><div class="line">);</div></pre></td></tr></table></figure>
<blockquote>
<p>这个分区表创建了四个定长分区，理想情况下，存储450000条数据，扩展分区是超过这个数额的分区，当发现扩展分区有数据的时候，可以进行将扩展分区，插入一些数据进去。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> TABLE_PARTITION(COL1,COL2)  </div><div class="line"><span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="string">'数据测试'</span>);  </div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> TABLE_PARTITION(COL1,COL2)  </div><div class="line"><span class="keyword">VALUES</span>(<span class="number">23</span>,<span class="string">'数据测试'</span>);  </div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> TABLE_PARTITION(COL1,COL2)  </div><div class="line"><span class="keyword">VALUES</span>(<span class="number">449000</span>,<span class="string">'数据测试'</span>);  </div><div class="line">   </div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> TABLE_PARTITION(COL1,COL2)  </div><div class="line"><span class="keyword">VALUES</span>(<span class="number">450000</span>,<span class="string">'数据测试'</span>);  </div><div class="line">   </div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> TABLE_PARTITION(COL1,COL2)  </div><div class="line"><span class="keyword">VALUES</span>(<span class="number">1350000</span>,<span class="string">'数据测试'</span>);  </div><div class="line">   </div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> TABLE_PARTITION(COL1,COL2)  </div><div class="line"><span class="keyword">VALUES</span>(<span class="number">900000</span>,<span class="string">'数据测试'</span>);   </div><div class="line">   </div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> TABLE_PARTITION(COL1,COL2)  </div><div class="line"><span class="keyword">VALUES</span>(<span class="number">1800000</span><span class="number">-1</span>,<span class="string">'数据测试'</span>);  </div><div class="line"><span class="keyword">COMMIT</span>;</div></pre></td></tr></table></figure>
<blockquote>
<p>为了检测哪些分区中有哪些数据分别按照分区去查询数据（应用开发中基本不会用到，因为不会把分区写死）</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> TABLE_PARTITION <span class="keyword">partition</span>(TAB_PARTOTION_01);  </div><div class="line">      COL1     COL2  </div><div class="line"><span class="comment">---------- ---------------  </span></div><div class="line">         1     数据测试  </div><div class="line">        23     数据测试  </div><div class="line">    449000    数据测试</div></pre></td></tr></table></figure>
<blockquote>
<p>说明第一个分区有：1、23、44900这些数据，也就是插入时，ORACLE是自己去找分区的，其实分区这种子表管理自己也可以通过程序去完成，ORACLE给你提供了一套，就可以自己去完成了。其余的数据就自己查了，都是一个道理。</p>
</blockquote>
<hr>
<h2 id="分区索引"><a href="#分区索引" class="headerlink" title="分区索引"></a>分区索引</h2><blockquote>
<p>一般一张表超过2G的大小，ORACLE是推荐使用分区表的，分区一般都需要创建索引，说到分区索引，就可以分为：全局索引、分区索引，即：global索引和local索引，前者为默认情况下在分区表上创建索引时的索引方式，并不对索引进行分区（索引也是表结构，索引大了也需要分区，）而全局索引可创建为分区索引，但是和local索引有所区别，前者的分区方式完全按照自定义方式去创建，和表结构完全无关，所以对于分区表的全局索引有以下两幅网上常用的图解：</p>
<ul>
<li><strong>GLOBAL不分区索引</strong>（表分区，索引不分区）：<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> &lt;index_name&gt; <span class="keyword">ON</span> &lt;partition_table_name&gt;(&lt;column_name&gt;);</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="https://wangbinbin0326.github.io/images/database/oracle/index-global.jpg" alt="此处输入图片的描述"></p>
<ul>
<li><strong>GLOBAL分区索引</strong>（表分区，索引分区）:<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> INX_TAB_PARTITION_COL1 <span class="keyword">ON</span> TABLE_PARTITION(COL1)  </div><div class="line">  <span class="keyword">GLOBAL</span> <span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">RANGE</span>(COL1)(  </div><div class="line">         <span class="keyword">PARTITION</span> IDX_P1 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="number">1000000</span>),  </div><div class="line">         <span class="keyword">PARTITION</span> IDX_P2 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="number">2000000</span>),  </div><div class="line">         <span class="keyword">PARTITION</span> IDX_P3 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (MAXVALUE)  </div><div class="line">  );</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="https://wangbinbin0326.github.io/images/database/oracle/index-global-partition.jpg" alt="此处输入图片的描述"></p>
<ul>
<li><strong>LOCAL索引</strong>:<br>注：分区上的位图索引只能为LOCAL索引，不能为GLOBAL全局索引。<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> INX_TAB_PARTITION_COL1 <span class="keyword">ON</span> TABLE_PARTITION(COL1) <span class="keyword">LOCAL</span>;</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="https://wangbinbin0326.github.io/images/database/oracle/index-local.jpg" alt="此处输入图片的描述"></p>
<p><strong>对比索引方式</strong>：</p>
<ul>
<li>LOCAL索引较为方便，而且维护代价较低，并且LOCAL索引是在分区的基础上去创建索引，在OLAP系统中应用很广泛;<br>LOCAL索引是和分区的个数逐个对应的，可以说先定位分区表的分区也可以说先定位索引的分区，因为他们是一一对应的，找到对应分区后，分区内部索引数据集合。</li>
<li>GLOBAL索引是全局类型的索引，根据实际情况可以调整分区的类别，而并非按照分区结构一一定义，相对维护代价较高一些，在OLTP环境用得相对较多；<br>GLOBAL不分区索引一般不太推荐，因为是用一颗大的索引树来映射一个表，这个过程，这样速度不见得比不分区快。<br>GLOBAL分区索引，查找数据若通过要通过索引，是先定位了索引内部的分区，然后在这个分区索引中找到ROWID，然后回表提取数据。</li>
</ul>
</blockquote>
<hr>
<h2 id="常用视图"><a href="#常用视图" class="headerlink" title="常用视图"></a>常用视图</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--查询当前用户下有哪些是分区表：  </span></div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> USER_PART_TABLES;  </div><div class="line">   </div><div class="line"><span class="comment">--查询当前用户下有哪些分区索引：  </span></div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> USER_PART_INDEXES;  </div><div class="line">   </div><div class="line"><span class="comment">--查询当前用户下分区索引的分区信息：  </span></div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> USER_IND_PARTITIONS T  </div><div class="line"><span class="keyword">WHERE</span> T.INDEX_NAME=?  </div><div class="line">   </div><div class="line"><span class="comment">--查询当前用户下分区表的分区信息：  </span></div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> USER_TAB_PARTITIONS T  </div><div class="line"><span class="keyword">WHERE</span> T.TABLE_NAME=?;  </div><div class="line">   </div><div class="line"><span class="comment">--查询某分区下的数据量：  </span></div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> TABLE_PARTITION <span class="keyword">PARTITION</span>(TAB_PARTOTION_01);  </div><div class="line">   </div><div class="line"><span class="comment">--查询索引、表上在那些列上创建了分区：  </span></div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> USER_PART_KEY_COLUMNS;  </div><div class="line">   </div><div class="line"><span class="comment">--查询某用户下二级分区的信息（只有创建了二级分区才有数据）：  </span></div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> USER_TAB_SUBPARTITIONS;</div></pre></td></tr></table></figure>
<hr>
<h2 id="维护操作"><a href="#维护操作" class="headerlink" title="维护操作"></a>维护操作</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--分区删除:如果是全局索引，因为全局索引的分区结构和表可以不一致，需要添加'UPDATE GLOBAL INDEXES'</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> TABLE_PARTITION <span class="keyword">DROP</span> <span class="keyword">PARTITION</span> TAB_PARTOTION_03;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> TABLE_PARTITION <span class="keyword">DROP</span> <span class="keyword">PARTITION</span> TAB_PARTOTION_03 <span class="keyword">UPDATE</span> <span class="keyword">GLOBAL</span> <span class="keyword">INDEXES</span> </div><div class="line">   </div><div class="line"><span class="comment">--分区合并：合并分区是不会删除数据的</span></div><div class="line"><span class="keyword">alter</span> <span class="keyword">table</span> table_partition <span class="keyword">merge</span> <span class="keyword">partitions</span> P_01, P_02 <span class="keyword">into</span> <span class="keyword">partition</span> P_MERGE;</div><div class="line">   </div><div class="line"><span class="comment">--分区拆分：一般分区从扩展分区拆分</span></div><div class="line"><span class="keyword">alter</span> <span class="keyword">table</span> table_partition <span class="keyword">split</span> <span class="keyword">partition</span> P_MAX <span class="keyword">AT</span>(<span class="number">2800000</span>) </div><div class="line">    <span class="keyword">into</span> (<span class="keyword">partition</span> P_05,<span class="keyword">partition</span> P_MAX); </div><div class="line">   </div><div class="line"><span class="comment">--分区新建：分区数据若不能提供范围，则插入时会报错，需要增加分区来扩大范围</span></div><div class="line">ORA-14400: inserted partition key does not map to any partition  </div><div class="line"><span class="keyword">alter</span> <span class="keyword">table</span> table_partition <span class="keyword">add</span> <span class="keyword">partition</span> P_MAX <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span>(maxvalue);  </div><div class="line">   </div><div class="line"><span class="comment">--分区清除数据：  </span></div><div class="line"><span class="keyword">alter</span> <span class="keyword">table</span> table_partition <span class="keyword">truncate</span> <span class="keyword">partition</span> P_03; </div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**   </span></div><div class="line">磁盘碎片压缩：对分区表的某分区进行磁盘压缩，当对分区内部数据进行了大量的UPDATE、DELETE操作后，</div><div class="line">一定时间需要进行磁盘压缩，否则在查询时，若通过FULL SCAN扫描数据，将会把空块也会扫描到，</div><div class="line">对表进行磁盘压缩需要进行行迁移操作，所以首先需要操作：</div><div class="line">**/</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> &lt;table_name&gt; <span class="keyword">ENABLE</span> <span class="keyword">ROW</span> <span class="keyword">MOVEMENT</span> ;  </div><div class="line">   </div><div class="line"><span class="comment">--对分区表的某分区压缩语法为：  </span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> &lt;table_name&gt;  </div><div class="line"><span class="keyword">modify</span> <span class="keyword">partition</span> &lt;partition_name&gt; <span class="keyword">shrink</span> <span class="keyword">space</span>;  </div><div class="line"><span class="comment">--对普通表压缩：  </span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> &lt;table_name&gt; <span class="keyword">shrink</span> <span class="keyword">space</span>;  </div><div class="line"><span class="comment">--对于索引也需要进行压缩，索引也是表：  </span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">INDEX</span> &lt;index_name&gt; <span class="keyword">shrink</span> <span class="keyword">space</span>; </div><div class="line"><span class="comment">-- 分区表重新分析以及索引重新分析</span></div><div class="line"><span class="keyword">ANALYZE</span> <span class="keyword">TABLE</span> &lt;table_name&gt; <span class="keyword">COMPUTE</span> <span class="keyword">STATISTICS</span>;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">INDEX</span> &lt;index_name&gt; <span class="keyword">REBUILD</span> <span class="keyword">PARTITION</span> &lt;partition_name&gt;;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">INDEX</span> &lt;index_name&gt; <span class="keyword">REBUILD</span>;</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL-日期函数]]></title>
      <url>http://wangbinbin0326.github.io/2016/11/02/SQL-%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0/</url>
      <content type="html"><![CDATA[<h2 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h2><blockquote>
<p>处理日期</p>
<ul>
<li>Oracle DB 以内部数字格式存储日期：世纪、年、月、日、小时、分钟和秒。</li>
<li>默认的日期显示格式为DD-MON-RR。</li>
</ul>
<p>问题：为什么不使用”日期+数字”，而是用add_months<br>答：需要考虑闰年的问题</p>
</blockquote>
<table>
<thead>
<tr>
<th>函数</th>
<th style="text-align:left">结果</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>months_between(‘2016-10-1’,’2016-1-1’)</td>
<td style="text-align:left">9</td>
<td style="text-align:left">两个日期之间的月数</td>
</tr>
<tr>
<td>add_months(sysdate, 24)</td>
<td style="text-align:left">2018-11-01 08:30:01</td>
<td style="text-align:left">将日历月添加到日期</td>
</tr>
<tr>
<td>NEXT_DAY(sysdate,’monday’)</td>
<td style="text-align:left">2016-11-07 08:46:24</td>
<td style="text-align:left">指定日期之后的下一个日期</td>
</tr>
<tr>
<td>LAST_DAY(sysdate)</td>
<td style="text-align:left">2016-11-30 08:47:41</td>
<td style="text-align:left">当月最后一天</td>
</tr>
<tr>
<td>extract(year from date ‘2016-11-1’)</td>
<td style="text-align:left">2016</td>
<td style="text-align:left">或者时间间隔（INTERVAL）中截取出特定的部分</td>
</tr>
<tr>
<td>ROUND(2016-11-02,’YEAR’)</td>
<td style="text-align:left">2017-01-01</td>
<td style="text-align:left">舍入日期</td>
</tr>
<tr>
<td>TRUNC(2016-11-02,’YEAR’)</td>
<td style="text-align:left">2016-01-01</td>
<td style="text-align:left">截断日期</td>
</tr>
</tbody>
</table>
<a id="more"></a>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> last_name, <span class="keyword">round</span>((<span class="keyword">SYSDATE</span>-hire_date)/<span class="number">7</span>) <span class="keyword">AS</span> WEEKS</div><div class="line"><span class="keyword">FROM</span> employees</div><div class="line"><span class="keyword">WHERE</span> department_id = <span class="number">90</span>;</div><div class="line"></div><div class="line">LAST_NAME                      WEEKS</div><div class="line"><span class="comment">------------------------- ----------</span></div><div class="line">King                             562</div><div class="line">Kochhar                          444</div><div class="line">De Haan                          689</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">select</span> months_between(<span class="string">'2016-10-1'</span>,<span class="string">'2016-1-1'</span>) <span class="keyword">from</span> dual;</div><div class="line"></div><div class="line">MONTHS_BETWEEN('2016-10-1','2016-1-1')</div><div class="line"><span class="comment">--------------------------------------</span></div><div class="line">                                     9</div><div class="line"></div><div class="line"><span class="keyword">select</span> <span class="keyword">sysdate</span>, add_months(<span class="keyword">sysdate</span>, <span class="number">24</span>) <span class="keyword">from</span> dual;</div><div class="line"></div><div class="line">SYSDATE             ADD_MONTHS(SYSDATE,</div><div class="line"><span class="comment">------------------- -------------------</span></div><div class="line">2016-11-01 08:30:01 2018-11-01 08:30:01</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">select</span> <span class="keyword">sysdate</span>, next_day(<span class="keyword">sysdate</span>,<span class="string">'monday'</span>) <span class="keyword">from</span> dual;</div><div class="line"></div><div class="line">SYSDATE             NEXT_DAY(SYSDATE</div><div class="line"><span class="comment">------------------- -------------------</span></div><div class="line">2016-11-01 08:46:24 2016-11-07 08:46:24</div><div class="line"></div><div class="line"><span class="keyword">select</span> <span class="keyword">sysdate</span>, <span class="keyword">last_day</span>(<span class="keyword">sysdate</span>) <span class="keyword">from</span> dual;</div><div class="line"></div><div class="line">SYSDATE             LAST_DAY(SYSDATE)</div><div class="line"><span class="comment">------------------- -------------------</span></div><div class="line">2016-11-01 08:47:41 2016-11-30 08:47:41</div><div class="line"></div><div class="line"><span class="keyword">select</span> <span class="keyword">extract</span>(<span class="keyword">year</span> <span class="keyword">from</span> <span class="built_in">date</span> <span class="string">'2016-11-1'</span>) <span class="keyword">year</span>,</div><div class="line">       <span class="keyword">extract</span>(<span class="keyword">month</span> <span class="keyword">from</span> <span class="built_in">date</span> <span class="string">'2016-11-1'</span>) <span class="keyword">month</span>,</div><div class="line">       <span class="keyword">extract</span>(<span class="keyword">day</span> <span class="keyword">from</span> <span class="built_in">date</span> <span class="string">'2016-11-1'</span>) <span class="keyword">day</span></div><div class="line"><span class="keyword">from</span> dual;</div><div class="line"></div><div class="line">      YEAR      MONTH        DAY</div><div class="line"><span class="comment">---------- ---------- ----------</span></div><div class="line">      2016         11          1</div><div class="line"></div><div class="line"><span class="keyword">select</span> <span class="keyword">extract</span>(<span class="keyword">day</span> <span class="keyword">from</span> datatime_one - datatime_two) <span class="keyword">days</span>,</div><div class="line">       <span class="keyword">extract</span>(<span class="keyword">hour</span> <span class="keyword">from</span> datatime_one - datatime_two) hours, </div><div class="line">       <span class="keyword">extract</span>(<span class="keyword">minute</span> <span class="keyword">from</span> datatime_one - datatime_two) minutes,</div><div class="line">       <span class="keyword">extract</span>(<span class="keyword">second</span> <span class="keyword">from</span> datatime_one - datatime_two) seconds</div><div class="line"> <span class="keyword">from</span></div><div class="line">( </div><div class="line">  <span class="keyword">select</span> to_timestamp(<span class="string">'1982-08-13 12:17:57'</span>, <span class="string">'yyyy-mm-dd hh24:mi:ss'</span>) datatime_one,</div><div class="line">         to_timestamp(<span class="string">'1981-09-27 09:08:33'</span>, <span class="string">'yyyy-mm-dd hh24:mi:ss'</span>) datatime_two</div><div class="line"><span class="keyword">from</span> dual);</div><div class="line"></div><div class="line">      DAYS      HOURS    MINUTES    SECONDS</div><div class="line"><span class="comment">---------- ---------- ---------- ----------</span></div><div class="line">       320          3          9         24</div><div class="line"></div><div class="line"><span class="keyword">select</span> <span class="keyword">sysdate</span>, <span class="keyword">ROUND</span>(<span class="keyword">SYSDATE</span> ,<span class="string">'YEAR'</span>) <span class="keyword">year</span>, <span class="keyword">round</span>(<span class="keyword">sysdate</span>,<span class="string">'MONTH'</span>) <span class="keyword">from</span> dual;</div><div class="line"></div><div class="line">SYSDATE             YEAR                ROUND(SYSDATE,'MONT</div><div class="line"><span class="comment">------------------- ------------------- -------------------</span></div><div class="line">2016-11-02 06:04:48 2017-01-01 00:00:00 2016-11-01 00:00:00</div><div class="line"></div><div class="line"><span class="keyword">select</span> <span class="keyword">sysdate</span>, TRUNC(<span class="keyword">SYSDATE</span> ,<span class="string">'YEAR'</span>) <span class="keyword">year</span>, TRUNC(<span class="keyword">sysdate</span>,<span class="string">'MONTH'</span>) <span class="keyword">from</span> dual;</div><div class="line"></div><div class="line">SYSDATE             YEAR                TRUNC(SYSDATE,'MONT</div><div class="line"><span class="comment">------------------- ------------------- -------------------</span></div><div class="line">2016-11-02 06:05:19 2016-01-01 00:00:00 2016-11-01 00:00:00</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">--日期格式显示：</span></div><div class="line"><span class="keyword">SELECT</span> *</div><div class="line">    <span class="keyword">FROM</span> wbxemailtask</div><div class="line">   <span class="keyword">WHERE</span> createtime &lt; <span class="keyword">TO_DATE</span> (<span class="string">'2012-1-01 00:00:00'</span>, <span class="string">'YYYY-MM-DD HH24:MI:SS'</span>)</div><div class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">DESC</span>;</div><div class="line"></div><div class="line"><span class="keyword">select</span> to_char( <span class="keyword">sysdate</span>,<span class="string">'YYYY-MM-DD HH24:MI:SS'</span>) <span class="keyword">from</span> dual;</div><div class="line"></div><div class="line"><span class="keyword">select</span> <span class="keyword">sysdate</span> <span class="keyword">from</span> dual;</div><div class="line"></div><div class="line">SYSDATE</div><div class="line"><span class="comment">---------</span></div><div class="line">01-NOV-16</div><div class="line"></div><div class="line"><span class="keyword">alter</span> <span class="keyword">session</span> <span class="keyword">set</span> nls_date_format=<span class="string">'yyyy-mm-dd hh24:mi:ss'</span>;</div><div class="line"></div><div class="line">Session altered.</div><div class="line"></div><div class="line"><span class="keyword">select</span> <span class="keyword">sysdate</span> <span class="keyword">from</span> dual;</div><div class="line"></div><div class="line">SYSDATE</div><div class="line"><span class="comment">-------------------</span></div><div class="line">2016-11-01 08:11:54</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">日期运算：</div><div class="line">日期 - 数字 = 日期</div><div class="line">日期 + 数字 = 日期</div><div class="line">日期 - 日期 = 数字</div><div class="line">日期 + 日期 = 不允许，会报错</div><div class="line">**/</div><div class="line"></div><div class="line"><span class="keyword">select</span> <span class="keyword">sysdate</span>+<span class="number">3</span> <span class="keyword">from</span> dual;</div><div class="line"></div><div class="line">SYSDATE+3</div><div class="line"><span class="comment">-------------------</span></div><div class="line">2016-11-04 08:16:41</div><div class="line"></div><div class="line"><span class="keyword">select</span> <span class="keyword">sysdate</span><span class="number">-3</span> <span class="keyword">from</span> dual;</div><div class="line"></div><div class="line">SYSDATE-3</div><div class="line"><span class="comment">-------------------</span></div><div class="line">2016-10-29 08:16:46</div><div class="line"></div><div class="line"><span class="keyword">select</span> employee_id, <span class="keyword">sysdate</span> - hire_date <span class="keyword">from</span> employees;</div><div class="line"></div><div class="line">EMPLOYEE_ID SYSDATE-HIRE_DATE</div><div class="line"><span class="comment">----------- -----------------</span></div><div class="line">        199        3215.34737</div><div class="line">        200        4794.34737</div><div class="line">        201        4641.34737</div><div class="line"></div><div class="line"><span class="keyword">select</span> <span class="keyword">sysdate</span>+<span class="keyword">sysdate</span> <span class="keyword">from</span> dual;</div><div class="line"><span class="keyword">select</span> <span class="keyword">sysdate</span>+<span class="keyword">sysdate</span> <span class="keyword">from</span> dual</div><div class="line">              *</div><div class="line"><span class="keyword">ERROR</span> <span class="keyword">at</span> line <span class="number">1</span>:</div><div class="line">ORA<span class="number">-00975</span>: <span class="built_in">date</span> + <span class="built_in">date</span> <span class="keyword">not</span> allowed</div><div class="line"></div><div class="line"><span class="comment">--查询出每个雇员的ID，name, 雇佣日期，已雇佣的年数，月数，天数</span></div><div class="line"><span class="keyword">select</span> employee_id, first_name, hire_date, </div><div class="line">    trunc(months_between(<span class="keyword">sysdate</span>,hire_date)/<span class="number">12</span>) <span class="keyword">year</span> ,    </div><div class="line">    trunc(<span class="keyword">mod</span>(months_between(<span class="keyword">sysdate</span>,hire_date),<span class="number">12</span>)) <span class="keyword">month</span>, </div><div class="line">    trunc(<span class="keyword">sysdate</span>-add_months(hire_date, months_between(<span class="keyword">sysdate</span>,hire_date))) <span class="keyword">day</span> </div><div class="line">    <span class="keyword">from</span> employees <span class="keyword">where</span> <span class="keyword">rownum</span> &lt; <span class="number">10</span>;</div><div class="line"></div><div class="line">EMPLOYEE_ID FIRST_NAME                HIRE_DATE                 YEAR      MONTH        DAY</div><div class="line"><span class="comment">----------- ------------------------- ------------------- ---------- ---------- ----------</span></div><div class="line">        199 Douglas                   2008-01-13 00:00:00          8          9         19</div><div class="line">        200 Jennifer                  2003-09-17 00:00:00         13          1         15</div><div class="line">        201 Michael                   2004-02-17 00:00:00         12          8         15</div><div class="line">        202 Pat                       2005-08-17 00:00:00         11          2         15</div><div class="line">        203 Susan                     2002-06-07 00:00:00         14          4         25</div><div class="line">        204 Hermann                   2002-06-07 00:00:00         14          4         25</div><div class="line">        205 Shelley                   2002-06-07 00:00:00         14          4         25</div><div class="line">        206 William                   2002-06-07 00:00:00         14          4         25</div><div class="line">        182 Martha                    2007-06-21 00:00:00          9          4         11</div></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL-数字函数]]></title>
      <url>http://wangbinbin0326.github.io/2016/11/02/SQL-%E6%95%B0%E5%AD%97%E5%87%BD%E6%95%B0/</url>
      <content type="html"><![CDATA[<h2 id="数字函数"><a href="#数字函数" class="headerlink" title="数字函数"></a>数字函数</h2><table>
<thead>
<tr>
<th>函数</th>
<th style="text-align:left">结果</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ROUND(45.926, 2)</td>
<td style="text-align:left">45.93</td>
<td style="text-align:left">将值舍入到指定的小数位</td>
</tr>
<tr>
<td>TRUNC(45.926, 2)</td>
<td style="text-align:left">45.92</td>
<td style="text-align:left">将值截断到指定的小数位</td>
</tr>
<tr>
<td>MOD(1600, 300)</td>
<td style="text-align:left">100</td>
<td style="text-align:left">返回除法运算的余数</td>
</tr>
</tbody>
</table>
<a id="more"></a>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="number">45.923</span>,<span class="number">2</span>), <span class="keyword">ROUND</span>(<span class="number">45.923</span>,<span class="number">0</span>),</div><div class="line"><span class="keyword">ROUND</span>(<span class="number">45.923</span>,<span class="number">-1</span>)</div><div class="line"><span class="keyword">FROM</span> DUAL; </div><div class="line"></div><div class="line">ROUND(45.923,2) ROUND(45.923,0) ROUND(45.923,-1)</div><div class="line"><span class="comment">--------------- --------------- ----------------</span></div><div class="line">          45.92              46               50</div><div class="line"></div><div class="line"><span class="keyword">SELECT</span> TRUNC(<span class="number">45.923</span>,<span class="number">2</span>), TRUNC(<span class="number">45.923</span>),</div><div class="line">TRUNC(<span class="number">45.923</span>,<span class="number">-1</span>)</div><div class="line"><span class="keyword">FROM</span> DUAL;</div><div class="line"></div><div class="line">TRUNC(45.923,2) TRUNC(45.923) TRUNC(45.923,-1)</div><div class="line"><span class="comment">--------------- ------------- ----------------</span></div><div class="line">          45.92            45               40</div><div class="line"></div><div class="line"><span class="keyword">SELECT</span> last_name, salary, <span class="keyword">MOD</span>(salary, <span class="number">5000</span>)</div><div class="line"><span class="keyword">FROM</span> employees</div><div class="line"><span class="keyword">WHERE</span> job_id = <span class="string">'SA_REP'</span>; </div><div class="line"></div><div class="line">LAST_NAME                     SALARY MOD(SALARY,5000)</div><div class="line"><span class="comment">------------------------- ---------- ----------------</span></div><div class="line">Tucker                         10000                0</div><div class="line">Bernstein                       9500             4500</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL-字符函数]]></title>
      <url>http://wangbinbin0326.github.io/2016/11/02/SQL-%E5%AD%97%E7%AC%A6%E5%87%BD%E6%95%B0/</url>
      <content type="html"><![CDATA[<h2 id="字符函数"><a href="#字符函数" class="headerlink" title="字符函数"></a>字符函数</h2><h3 id="大小写转换函数"><a href="#大小写转换函数" class="headerlink" title="大小写转换函数"></a>大小写转换函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th style="text-align:left">结果</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>LOWER(‘SQL Course’)</td>
<td style="text-align:left">sql course</td>
<td style="text-align:left">字符串转换为小写</td>
</tr>
<tr>
<td>UPPER(‘SQL Course’)</td>
<td style="text-align:left">SQL COURSE</td>
<td style="text-align:left">字符串转换为大写</td>
</tr>
<tr>
<td>INITCAP(‘SQL Course’)</td>
<td style="text-align:left">Sql Course</td>
<td style="text-align:left">字符串首字母大写，其它小写</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_id</div><div class="line"><span class="keyword">FROM</span> employees</div><div class="line"><span class="keyword">WHERE</span> <span class="keyword">LOWER</span>(last_name) = <span class="string">'higgins'</span>;</div></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="字符处理函数"><a href="#字符处理函数" class="headerlink" title="字符处理函数"></a>字符处理函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th style="text-align:left">结果</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>CONCAT(‘Hello’, ‘World’)</td>
<td style="text-align:left">HelloWorld</td>
<td style="text-align:left">字符串连接</td>
</tr>
<tr>
<td>SUBSTR(‘HelloWorld’,1,5)</td>
<td style="text-align:left">Hello</td>
<td style="text-align:left">字符串截取</td>
</tr>
<tr>
<td>LENGTH(‘HelloWorld’)</td>
<td style="text-align:left">10</td>
<td style="text-align:left">字符串长度</td>
</tr>
<tr>
<td>INSTR(‘HelloWorld’, ‘W’)</td>
<td style="text-align:left">6</td>
<td style="text-align:left">查找一个子字符串，返回字符串第一次遇到的位置</td>
</tr>
<tr>
<td>LPAD(salary,10,’*’)</td>
<td style="text-align:left">*****24000</td>
<td style="text-align:left">在左填充指定的字符串</td>
</tr>
<tr>
<td>RPAD(salary, 10, ‘*’)</td>
<td style="text-align:left">24000*****</td>
<td style="text-align:left">在右填充指定的字符串</td>
</tr>
<tr>
<td>REPLACE(‘JACK and JUE’,’J’,’BL’)</td>
<td style="text-align:left">BLACK and BLUE</td>
<td style="text-align:left">字符串替换</td>
</tr>
<tr>
<td>TRIM(‘H’ FROM ‘HelloWorld’)</td>
<td style="text-align:left">elloWorld</td>
<td style="text-align:left">去掉某字符</td>
</tr>
<tr>
<td>TRIM(‘ HelloWorld ‘)</td>
<td style="text-align:left">HelloWorld</td>
<td style="text-align:left">去掉两边的空格</td>
</tr>
<tr>
<td>LTRIM(‘ HelloWorld’)</td>
<td style="text-align:left">HelloWorld</td>
<td style="text-align:left">去掉左边的空格</td>
</tr>
<tr>
<td>RTRIM(‘HelloWorld ‘)</td>
<td style="text-align:left">HelloWorld</td>
<td style="text-align:left">去掉右边的空格</td>
</tr>
<tr>
<td>ASCII(‘A’)</td>
<td style="text-align:left">65</td>
<td style="text-align:left">返回与指定字符对应的十进制数组</td>
</tr>
<tr>
<td>CHR(65)</td>
<td style="text-align:left">A</td>
<td style="text-align:left">给出一个整数，并返回与之对应的字符</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--CONCAT Examples</span></div><div class="line"><span class="keyword">SELECT</span> employee_id, <span class="keyword">CONCAT</span>(first_name, last_name) <span class="keyword">NAME</span>,</div><div class="line">job_id, <span class="keyword">LENGTH</span> (last_name),</div><div class="line"><span class="keyword">INSTR</span>(last_name, <span class="string">'a'</span>) <span class="string">"Contains 'a'?"</span></div><div class="line"><span class="keyword">FROM</span> employees</div><div class="line"><span class="keyword">WHERE</span> <span class="keyword">SUBSTR</span>(job_id, <span class="number">4</span>) = <span class="string">'REP'</span>; </div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">EMPLOYEE_ID NAME   JOB_ID LENGTH(LAST_NAME) Contains 'a'?</div><div class="line">----------- ------------- ---------- ----------------- ---------</div><div class="line">202         PatFay MK_REP           3             2</div><div class="line">**/</div><div class="line"></div><div class="line"><span class="comment">--TRIM TRIM enables you to trim leading or trailing characters (or both) from a character string. </span></div><div class="line"><span class="comment">--Examples</span></div><div class="line"><span class="keyword">SELECT</span> employee_id,hire_date</div><div class="line">      <span class="keyword">FROM</span> employees</div><div class="line">      <span class="keyword">WHERE</span> department_id = <span class="number">60</span></div><div class="line">      <span class="keyword">ORDER</span> <span class="keyword">BY</span> employee_id;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">EMPLOYEE_ID HIRE_DATE</div><div class="line">----------- ---------</div><div class="line">        103 03-JAN-06</div><div class="line">        104 21-MAY-07</div><div class="line">        105 25-JUN-05</div><div class="line">        106 05-FEB-06</div><div class="line">        107 07-FEB-07</div><div class="line">        301 03-FEB-99</div><div class="line">        302 01-FEB-14</div><div class="line"></div><div class="line">7 rows selected.</div><div class="line">**/</div><div class="line"></div><div class="line"><span class="keyword">SELECT</span> employee_id,</div><div class="line">      TO_CHAR(<span class="keyword">TRIM</span>(<span class="keyword">LEADING</span> <span class="number">0</span> <span class="keyword">FROM</span> hire_date))</div><div class="line">      <span class="keyword">FROM</span> employees</div><div class="line">      <span class="keyword">WHERE</span> department_id = <span class="number">60</span></div><div class="line">      <span class="keyword">ORDER</span> <span class="keyword">BY</span> employee_id; </div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">EMPLOYEE_ID TO_CHAR(T</div><div class="line">----------- ---------</div><div class="line">        103 3-JAN-06</div><div class="line">        104 21-MAY-07</div><div class="line">        105 25-JUN-05</div><div class="line">        106 5-FEB-06</div><div class="line">        107 7-FEB-07</div><div class="line">        301 3-FEB-99</div><div class="line">        302 1-FEB-14</div><div class="line"></div><div class="line">7 rows selected.</div><div class="line">**/</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">INSTR （string, substring, position, occurrence）</div><div class="line">The following example searches the string CORPORATE FLOOR, beginning with the third character, for the string "OR". It returns the position in CORPORATE FLOOR at which the second occurrence of "OR" begins:</div><div class="line">**/</div><div class="line"></div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">INSTR</span>(<span class="string">'CORPORATE FLOOR'</span>,<span class="string">'OR'</span>, <span class="number">3</span>, <span class="number">2</span>)</div><div class="line">  <span class="string">"Instring"</span> <span class="keyword">FROM</span> DUAL;</div><div class="line"> </div><div class="line"> <span class="comment">/**</span></div><div class="line">  Instring</div><div class="line">----------</div><div class="line">        14</div><div class="line">**/</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Portus管理Docker的Registry仓库]]></title>
      <url>http://wangbinbin0326.github.io/2016/11/01/Portus%E7%AE%A1%E7%90%86Docker%E7%9A%84Registry%E4%BB%93%E5%BA%93/</url>
      <content type="html"><![CDATA[<blockquote>
<p>系统版本： CentOS Linux release 7.2.1511 (Core)</p>
</blockquote>
<h2 id="step-1-更新系统"><a href="#step-1-更新系统" class="headerlink" title="step 1: 更新系统"></a>step 1: 更新系统</h2><p><code>yum update -y</code></p>
<h2 id="step-2-安装docker-compose"><a href="#step-2-安装docker-compose" class="headerlink" title="step 2: 安装docker-compose"></a>step 2: 安装docker-compose</h2><p><code>yum -y install epel-release    #pip安装包在epel源中</code><br><code>yum -y install python-pip</code><br><code>pip install -U docker-compose</code></p>
<h2 id="step-3-安装git客户端"><a href="#step-3-安装git客户端" class="headerlink" title="step 3: 安装git客户端"></a>step 3: 安装git客户端</h2><p><code>yum install -y git</code></p>
<a id="more"></a>
<h2 id="step-4-复制Portus安装程序"><a href="#step-4-复制Portus安装程序" class="headerlink" title="step 4:复制Portus安装程序"></a>step 4:复制Portus安装程序</h2><p><code>git clone https://github.com/SUSE/Portus.git</code></p>
<h2 id="step-5-配置Docker安装源"><a href="#step-5-配置Docker安装源" class="headerlink" title="step 5:配置Docker安装源"></a>step 5:配置Docker安装源</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@ct7 ~]# more /etc/yum.repos.d/docker.repo</div><div class="line">[dockerrepo]</div><div class="line">name=Docker Repository</div><div class="line">baseurl=https://yum.dockerproject.org/repo/main/centos/7/</div><div class="line">enabled=1</div><div class="line">gpgcheck=1</div><div class="line">gpgkey=https://yum.dockerproject.org/gpg</div></pre></td></tr></table></figure>
<h2 id="step-6-安装docker引擎并启动"><a href="#step-6-安装docker引擎并启动" class="headerlink" title="step 6:安装docker引擎并启动"></a>step 6:安装docker引擎并启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">yum cleal all &amp;&amp; yum makecache</div><div class="line">yum install -y docker-engine</div><div class="line">systemctl start docker.service</div><div class="line">systemctl enable docker.service</div></pre></td></tr></table></figure>
<h2 id="step-7-安装Portus"><a href="#step-7-安装Portus" class="headerlink" title="step 7:安装Portus"></a>step 7:安装Portus</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line">./compose-setup.sh -e 192.168.0.109</div><div class="line">Step 11 : ADD . .</div><div class="line"> ---&gt; 08d874cfd4fa</div><div class="line">Removing intermediate container 0062e29a08fb</div><div class="line">Successfully built 08d874cfd4fa</div><div class="line">WARNING: Image for service web was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`.</div><div class="line">Creating portus_db_1</div><div class="line">Creating portus_web_1</div><div class="line">Creating portus_crono_1</div><div class="line">Creating portus_registry_1</div><div class="line">Waiting for mariadb to be ready in 5 seconds</div><div class="line">Portus: configuring database... [SUCCESS]</div><div class="line"></div><div class="line">###################</div><div class="line">#     SUCCESS     #</div><div class="line">###################</div><div class="line"></div><div class="line">Make sure port 3000 and 5000 are open on host 10.224.172.50</div><div class="line"></div><div class="line">Open http://10.224.172.50:3000 with your browser and perform the following steps:</div><div class="line"></div><div class="line">  1. Create an admin account</div><div class="line">  2. You will be redirected to a page where you have to register the registry. In this form:</div><div class="line">    - Choose a custom name for the registry.</div><div class="line">    - Enter 10.224.172.50:5000 as the hostname.</div><div class="line">    - Do *not* check the &quot;Use SSL&quot; checkbox, since this setup is not using SSL.</div><div class="line"></div><div class="line">Perform the following actions on the docker hosts that need to interact with your registry:</div><div class="line"></div><div class="line">  - Ensure the docker daemon is started with the &apos;--insecure-registry 10.224.172.50:5000&apos;</div><div class="line">  - Perform the docker login.</div><div class="line"></div><div class="line">To authenticate against your registry using the docker cli do:</div><div class="line"></div><div class="line">  $ docker login -u &lt;portus username&gt; -p &lt;password&gt; -e &lt;email&gt; 10.224.172.50:5000</div><div class="line"></div><div class="line">To push an image to the private registry:</div><div class="line"></div><div class="line">  $ docker pull busybox</div><div class="line">  $ docker tag busybox 10.224.172.50:5000/&lt;username&gt;/busybox</div><div class="line">  $ docker push 10.224.172.50:5000/&lt;username&gt;/busybox</div><div class="line"></div><div class="line">###################</div><div class="line">#     Issue1      #</div><div class="line">###################</div><div class="line">以上是安装成功的，由于网络的原因，我们在download phantomjs_1.9.0-1_amd64.deb 发生了 timeout, 所以需要手工的下载好了之后在安装，在文件添加如下命令</div><div class="line">cd /var/cache/apt/archives &amp;&amp; \</div><div class="line">wget http://download.opensuse.org/repositories/home:/flavio_castelli:/phantomjs/Debian_8.0/./amd64/phantomjs_1.9.0-1_amd64.deb &amp;&amp; \</div><div class="line">apt-get install -y --no-install-recommends phantomjs nodejs apt-utils &amp;&amp; \</div><div class="line"></div><div class="line">[root@ct7 Portus]# more /home/tony/Portu/Portus/Dockerfile</div><div class="line">FROM library/ruby:2.3.1</div><div class="line">MAINTAINER Flavio Castelli &lt;fcastelli@suse.com&gt;</div><div class="line"></div><div class="line">ENV COMPOSE=1</div><div class="line">EXPOSE 3000</div><div class="line"></div><div class="line">WORKDIR /portus</div><div class="line">COPY Gemfile* ./</div><div class="line">RUN bundle install --retry=3</div><div class="line"></div><div class="line"># Install phantomjs, this is required for testing and development purposes</div><div class="line"># There are no official deb packages for it, hence we built it inside of the</div><div class="line"># open build service.</div><div class="line">RUN echo &quot;deb http://download.opensuse.org/repositories/home:/flavio_castelli:/phantomjs/Debian_8.0/ ./&quot; &gt;&gt; /etc/apt/sources.list</div><div class="line">RUN wget http://download.opensuse.org/repositories/home:/flavio_castelli:/phantomjs/Debian_8.0/Release.key &amp;&amp; \</div><div class="line">  apt-key add Release.key &amp;&amp; \</div><div class="line">  rm Release.key</div><div class="line">RUN apt-get update &amp;&amp; \</div><div class="line">    cd /var/cache/apt/archives &amp;&amp; \</div><div class="line">    wget http://download.opensuse.org/repositories/home:/flavio_castelli:/phantomjs/Debian_8.0/./amd64/phantomjs_1.9.0-1_amd64.deb &amp;&amp; \</div><div class="line">    apt-get install -y --no-install-recommends phantomjs nodejs apt-utils &amp;&amp; \</div><div class="line">    rm -rf /var/lib/apt/lists/*</div><div class="line"></div><div class="line">ADD . .</div><div class="line"></div><div class="line">###################</div><div class="line">#     Issue2      #</div><div class="line">###################</div><div class="line">创建完，并且docker push 到registry上，访问URL：http://10.224.172.50:3000/，发现没有任何的数据，这个因为防火墙的原因，具体操作看下一步</div></pre></td></tr></table></figure>
<hr>
<h2 id="step-8-打开防火墙端口"><a href="#step-8-打开防火墙端口" class="headerlink" title="step 8:打开防火墙端口"></a>step 8:打开防火墙端口</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --zone=public  --add-port=3000/tcp --permanent</div><div class="line">firewall-cmd --zone=public  --add-port=5000/tcp --permanent</div><div class="line">systemctl restart firewall.service</div></pre></td></tr></table></figure>
<h2 id="step-9-Portus初始化配置"><a href="#step-9-Portus初始化配置" class="headerlink" title="step 9:Portus初始化配置"></a>step 9:Portus初始化配置</h2><blockquote>
<p>在浏览器中打开创建默认管理员用户<br><img src="https://wangbinbin0326.github.io/images/software/docker-portus1.JPG" alt="此处输入图片的描述"></p>
<p>连接到本docker仓库（也可以是其他仓库，必须是registry 2.0以上版本）(不要选择SSL，创建失败会提示 remote check disable 就可以)<br><img src="https://wangbinbin0326.github.io/images/software/docker-portus2.JPG" alt="此处输入图片的描述"></p>
</blockquote>
<h2 id="step-10-在docker-client上传镜像到docker-registry"><a href="#step-10-在docker-client上传镜像到docker-registry" class="headerlink" title="step 10:在docker client上传镜像到docker registry"></a>step 10:在docker client上传镜像到docker registry</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">创建/etc/docker/daemon.json文件，并写入</div><div class="line">[root@ct7 system]# more /etc/docker/daemon.json</div><div class="line">&#123; &quot;insecure-registries&quot;:[&quot;10.224.172.50:5000&quot;] &#125;</div><div class="line">然后重启docker：</div><div class="line">[root@ct7 system]# systemctl daemon-reload</div><div class="line">[root@ct7 system]# service docker restart</div><div class="line"></div><div class="line">[root@ct7 system]# docker login -u admin -p P@ss1234 -e admin@hz-zabbix.qa.webex.com 10.224.172.50:5000</div><div class="line">Flag --email has been deprecated, will be removed in 1.13.</div><div class="line">Login Succeeded</div><div class="line"></div><div class="line">[root@ct7 system]# docker pull busybox</div><div class="line">Using default tag: latest</div><div class="line">latest: Pulling from library/busybox</div><div class="line">56bec22e3559: Pull complete</div><div class="line">Digest: sha256:29f5d56d12684887bdfa50dcd29fc31eea4aaf4ad3bec43daf19026a7ce69912</div><div class="line">Status: Downloaded newer image for busybox:latest</div><div class="line"></div><div class="line">[root@ct7 system]# docker tag busybox 10.224.172.50:5000/admin/busybox</div><div class="line">[root@ct7 system]# docker images</div><div class="line">REPOSITORY                          TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">10.224.172.50:5000/admin/busybox    latest              e02e811dd08f        3 weeks ago         1.093 MB</div><div class="line">busybox                             latest              e02e811dd08f        3 weeks ago         1.093 MB</div><div class="line"></div><div class="line">[root@ct7 system]# docker push 10.224.172.50:5000/admin/busybox</div><div class="line">The push refers to a repository [10.224.172.50:5000/admin/busybox]</div><div class="line">e88b3f82283b: Pushed</div><div class="line">latest: digest: sha256:29f5d56d12684887bdfa50dcd29fc31eea4aaf4ad3bec43daf19026a7ce69912 size: 527</div></pre></td></tr></table></figure>
<h2 id="step-11-检查Portus界面的镜像信息"><a href="#step-11-检查Portus界面的镜像信息" class="headerlink" title="step 11.检查Portus界面的镜像信息"></a>step 11.检查Portus界面的镜像信息</h2><p><img src="https://wangbinbin0326.github.io/images/software/docker-portus3.JPG" alt="此处输入图片的描述"></p>
<h2 id="step-12-重启Portus应用"><a href="#step-12-重启Portus应用" class="headerlink" title="step 12.重启Portus应用"></a>step 12.重启Portus应用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@ct7 Portus]# pwd</div><div class="line">/home/tony/Portu/Portus</div><div class="line"></div><div class="line">[root@ct7 Portus]# docker-compose stop</div><div class="line">Stopping portus_registry_1 ... done</div><div class="line">Stopping portus_web_1 ... done</div><div class="line">Stopping portus_crono_1 ... done</div><div class="line">Stopping portus_db_1 ... done</div><div class="line"></div><div class="line">[root@ct7 Portus]# docker-compose up</div><div class="line">Starting portus_db_1</div><div class="line">Starting portus_web_1</div><div class="line">Starting portus_crono_1</div><div class="line">Starting portus_registry_1</div></pre></td></tr></table></figure>
<p>select extract(year from date ‘2016-11-1’) year,<br>       extract(month from date ‘2016-11-1’) month,<br>       extract(day from date ‘2016-11-1’) day<br>from dual;</p>
<p>SYSDATE             DATE1               DATE_YEAR                     DATE_MONTH                   DATE_NUM</p>
<hr>
<p>2016-11-02 01:22:24 2016-11-02 01:22:24 twenty sixteen-11-02 01:22:24 16-november -02 01:22:24     16-11-02 WED 01:22:24</p>
<p>SYSDATE             DATE1               DATE_YEAR                                                 DATE_MONTH                   DATE_NUM                 DATE_FM</p>
<hr>
<p>2016-11-02 01:27:05 2016-11-02 01:27:05 twenty sixteen-11-02 01:27:05                             16-november -02 01:27:05     16-11-02 WED 01:27:05    16-11-2 WED 1:27:5</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[CentOS搭建docker-registry仓库]]></title>
      <url>http://wangbinbin0326.github.io/2016/10/28/CentOS%E6%90%AD%E5%BB%BAdocker-registry%E4%BB%93%E5%BA%93/</url>
      <content type="html"><![CDATA[<h2 id="在CentOS上搭建docker私服"><a href="#在CentOS上搭建docker私服" class="headerlink" title="在CentOS上搭建docker私服"></a>在CentOS上搭建docker私服</h2><blockquote>
<p>环境：</p>
<ul>
<li><p>IP:<br>10.224.188.50(Docker Registry Server)<br>10.224.188.59(Docker client )</p>
</li>
<li><p>OS: CentOS Linux release 7.2.1511 (Core)</p>
</li>
<li><p>Docker Version: Docker version 1.12.0, build 8eab29e</p>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<p>Step 1: 以下操作运行在10.224.188.50(Docker Registry Server)上</p>
<p>安装docker-registry, 运行以下命令<br><code>docker run -d -e SETTINGS_FLAVOR=dev -e STORAGE_PATH=/tmp/registry -v /opt/data/registry:/tmp/registry  -p 5000:5000 registry</code></p>
<p>安装，启动好之后，运行访问这个URL来验证是否成功：<br><code>[root@ct7 system]# curl http://10.224.188.50:5000/v1/_ping
404 page not found</code></p>
<p>如果有如下返回值则代表成功，无返回则说明进程没有启动，把所有的container都删除然后在重新启动<br><code>docker rm $(docker ps -a -q)</code><br><code>docker run -d -e SETTINGS_FLAVOR=dev -e STORAGE_PATH=/tmp/registry -v /opt/data/registry:/tmp/registry  -p 5000:5000 registry</code></p>
</blockquote>
<a id="more"></a>
<hr>
<blockquote>
<p>Step 2: 以下操作运行在10.224.188.59(Docker client)上</p>
<p>1.查看当前的images</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@ct7 system]# docker images</div><div class="line">REPOSITORY                          TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">gethue/hue                          latest              f7f2abf45534        4 months ago        2.284 GB</div></pre></td></tr></table></figure>
<blockquote>
<p>2.查看当前所有的container</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@ct7 system]# docker ps -a</div><div class="line">CONTAINER ID        IMAGE                               COMMAND             CREATED             STATUS                      PORTS                    NAMES</div><div class="line">5b45fcfb4c4c        gethue/hue:latest                   &quot;bash&quot;              2 weeks ago         Up 31 minutes               0.0.0.0:8888-&gt;8888/tcp   high_lovelace</div><div class="line">--container没有起来，运行如下命令：</div><div class="line">[root@ct7 system]# docker start 5b45fcfb4c4c</div></pre></td></tr></table></figure>
<blockquote>
<p>3.查看当前运行的container</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@ct7 system]# docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES</div><div class="line">5b45fcfb4c4c        gethue/hue:latest   &quot;bash&quot;              2 weeks ago         Up 34 minutes       0.0.0.0:8888-&gt;8888/tcp   high_lovelace</div></pre></td></tr></table></figure>
<blockquote>
<p>4.Create a new image from a container’s changes</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@ct7 system]# docker commit 5b45fcfb4c4c 10.224.188.50:5000/hue-v1</div><div class="line">sha256:8f41bc37f2b4164c79a9924ca9b6f38581a7ca8f50e60d2ac49818a765c35f09</div><div class="line">[root@ct7 system]# docker images</div><div class="line">REPOSITORY                          TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">10.224.188.50:5000/hue-v1           latest              8f41bc37f2b4        15 seconds ago      2.57 GB</div></pre></td></tr></table></figure>
<blockquote>
<p>5.push new image into docker private registry</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@ct7 system]# docker push 10.224.188.50:5000/hue-v1</div><div class="line">The push refers to a repository [10.224.188.50:5000/hue-v1]</div><div class="line">eb8378240c72: Pushed</div><div class="line">1e71236cfd2b: Pushed</div><div class="line">fccab3c2b82b: Pushed</div><div class="line">30c28efdecff: Pushed</div><div class="line">634827038ea7: Pushed</div><div class="line">8f22c1173848: Pushed</div><div class="line">8191da9e7f9a: Pushed</div><div class="line">173f1156fe76: Pushed</div><div class="line">5b771cc18969: Pushed</div><div class="line">ae16cd6221a3: Pushed</div><div class="line">7dce18002c8d: Pushed</div><div class="line">5f70bf18a086: Pushed</div><div class="line">6f8be37bd578: Pushed</div><div class="line">9f7ab087e6e6: Pushed</div><div class="line">dc109d4b4ccf: Pushed</div><div class="line">a7e1c363defb: Pushed</div><div class="line">latest: digest: sha256:b9ee12c606e3da3554b3f5df9f88364eb8986b1f6fe1ae625542c8e3343e1627 size: 3691</div><div class="line">——————————————————————————————————————————————————————————————————————————————————————</div><div class="line">如果push的时候报以下错误时：&quot;server gave HTTP response to HTTPS client&quot;</div><div class="line">创建/etc/docker/daemon.json文件，并写入</div><div class="line">[root@ct7 system]# more /etc/docker/daemon.json</div><div class="line">&#123; &quot;insecure-registries&quot;:[&quot;10.224.188.50:5000&quot;] &#125;</div><div class="line">然后重启docker：</div><div class="line">[root@ct7 system]# service docker restart</div></pre></td></tr></table></figure>
<blockquote>
<p>6.verify the new image from docker private registry</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">--删除old image</div><div class="line">[root@ct7 system]# docker images</div><div class="line">REPOSITORY                          TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">10.224.188.50:5000/hue-v1           latest              9095f95a6f9f        18 hours ago        2.57 GB</div><div class="line">[root@ct7 system]# docker rmi 10.224.188.50:5000/hue-v1</div><div class="line">Untagged: 10.224.188.50:5000/hue-v1:latest</div><div class="line">Deleted: sha256:9095f95a6f9fb97de276752db6a5dd44bf279b58cfdf4c723c48090b6ef3a5f5</div><div class="line">Deleted: sha256:8a560d1d95af6e2436ba2ff73125b383bef343e6e6d4ff45c3dc61352342c7c8</div><div class="line">——————————————————————————————————————————————————————————————————————————————————————</div><div class="line">--查看docker registry images</div><div class="line">[root@ct7 system]# curl http://10.224.188.50:5000/v1/search</div><div class="line">404 page not found</div><div class="line">网上都用这个curl http://10.224.188.50:5000/v1/search,但是报404 page not found，后查证是v1版本的api查看方式，我们现在的版本是v2，所以用如下方法查看：</div><div class="line">curl -X GET http://10.224.188.50:5000/v2/_catalog</div><div class="line">[root@ct7 system]# curl -X GET http://10.224.188.50:5000/v2/_catalog</div><div class="line">&#123;&quot;repositories&quot;:[&quot;centos7-python&quot;,&quot;hue-v1&quot;]&#125;</div><div class="line">——————————————————————————————————————————————————————————————————————————————————————</div><div class="line">-- pull new images</div><div class="line">[root@ct7 system]# docker pull 10.224.188.50:5000/hue-v1</div><div class="line">[root@ct7 system]# docker images</div><div class="line">REPOSITORY                          TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">10.224.188.50:5000/hue-v2           latest              1905f45f6154        15 hours ago        2.486 GB</div><div class="line">10.224.188.50:5000/hue-v1           latest              8f41bc37f2b4        20 hours ago        2.57 GB</div><div class="line">由于commit方式不会保存mount的数据，所以需要对应用做如下操作</div><div class="line">The commit operation will not include any data contained in volumes mounted inside the container.</div><div class="line">root@3201bbe4b443:/home/tony/hue# scp 10.224.188.58:/storage/software/hue/pseudo-distributed.ini /hue/desktop/conf/pseudo-distributed.ini</div><div class="line">source /etc/profile</div><div class="line">root@3201bbe4b443:/home/tony/hue# /home/tony/hue/start_hue.sh</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[python实现递归的汉诺塔]]></title>
      <url>http://wangbinbin0326.github.io/2016/10/25/python%E5%AE%9E%E7%8E%B0%E9%80%92%E5%BD%92%E7%9A%84%E6%B1%89%E8%AF%BA%E5%A1%94/</url>
      <content type="html"><![CDATA[<h2 id="python实现递归的汉诺塔"><a href="#python实现递归的汉诺塔" class="headerlink" title="python实现递归的汉诺塔"></a>python实现递归的汉诺塔</h2><blockquote>
<p>汉诺塔问题是源于印度一个古老传说的益智玩具。大梵天创造世界的时候做了三根金刚石柱子，在一根柱子上从下往上按照大小顺序摞着64片黄金圆盘。大梵天命令婆罗门把圆盘从下面开始按大小顺序重新摆放在另一根柱子上。并且规定，在小圆盘上不能放大圆盘，在三根柱子之间一次只能移动一个圆盘。</p>
</blockquote>
<p><img src="https://wangbinbin0326.github.io/images/python/hanoi.jpg" alt="此处输入图片的描述"></p>
<a id="more"></a>
<blockquote>
<p>编程思想：</p>
<p>step 1: 将第一个柱子的第n个盘子上的（n-1）的盘子，通过第三个柱子的迁移存放，放到第二个柱子上。</p>
<p>step 2: 然后将第二个柱子上的（n-1）的盘子，通过第一个柱子的迁移存放，放入到第三个柱子上。</p>
<p>step 3: 通过递归的方式一层一层的迁移。 </p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#coding: utf-8</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hanota</span><span class="params">(n, x, y, z)</span>:</span></div><div class="line">        <span class="keyword">if</span> n == <span class="number">1</span>:</div><div class="line">                print(x+<span class="string">"----&gt;"</span>+z) <span class="comment">#当 n=1 则直接将盘子从x移到z上</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">                hanota(n<span class="number">-1</span>, x, z, y) <span class="comment"># 当 n!=1 时，需要先将x的第n个盘子上的（n-1）个盘子，从x通过z放到y上</span></div><div class="line">                print(x+<span class="string">"----&gt;"</span>+z)   <span class="comment"># 然后将第n个盘子放入到z上</span></div><div class="line">                hanota(n<span class="number">-1</span>, y, x, z) <span class="comment"># 让后将y上的（n-1）个盘子，通过x放入到z上</span></div><div class="line"></div><div class="line">num = input(<span class="string">"please input the hanota layer number: "</span>)</div><div class="line">n = int(num)</div><div class="line"></div><div class="line">hanota(n, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>)</div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">[root@24902b4429c6 lab1]# python hanota.py</div><div class="line">please input the hanota layer number: 3</div><div class="line">x----&gt;z</div><div class="line">x----&gt;y</div><div class="line">z----&gt;y</div><div class="line">x----&gt;z</div><div class="line">y----&gt;x</div><div class="line">y----&gt;z</div><div class="line">x----&gt;z</div><div class="line">'''</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hanota</span><span class="params">(n)</span>:</span></div><div class="line">        step1xtoz = <span class="number">1</span></div><div class="line">        <span class="keyword">if</span> n == <span class="number">1</span>:</div><div class="line">                <span class="keyword">return</span> step1xtoz</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">                stepcount = hanota(n<span class="number">-1</span>) + hanota(n<span class="number">-1</span>) + step1xtoz</div><div class="line">                <span class="keyword">return</span> stepcount</div><div class="line"></div><div class="line">num = input(<span class="string">"please input the hanota layer number: "</span>)</div><div class="line">n = int(num)</div><div class="line"></div><div class="line">count = hanota(n)</div><div class="line">print(<span class="string">"The step count: "</span>,count)</div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">[root@24902b4429c6 lab1]# python hanota1.py</div><div class="line">please input the hanota layer number: 3</div><div class="line">('The step count: ', 7)</div><div class="line">'''</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[成就DBA职业生涯]]></title>
      <url>http://wangbinbin0326.github.io/2016/10/25/%E6%88%90%E5%B0%B1DBA%E8%81%8C%E4%B8%9A%E7%94%9F%E6%B6%AF/</url>
      <content type="html"><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><blockquote>
<p>许多年来，我在不同的新闻组上花费了很多时间与那些想知道如何得到数据库管理员（DBA）的工作或者如何成长为一名DBA的IT人进行交谈，现在他们有了工作。这些年来许多人针对如何达到这个目标提出了不同意见。本文即是那些意见的综合并且能够在如何才能出色的完成DBA的工作方面给出好的建议。这篇文章同样对于如何让一名DBA变得对老板更有价值。假如你已经是一名DBA，那么也许你会希望跳过文章的前几段。</p>
</blockquote>
<h2 id="我应该成为一名DBA么？"><a href="#我应该成为一名DBA么？" class="headerlink" title="我应该成为一名DBA么？"></a>我应该成为一名DBA么？</h2><blockquote>
<p>我曾问过的一个问题是一个人应该从事DBA这样的职业么。这个问题并不容易回答，因为它因人而异。有的人有成为一名好DBA所需要的天赋。而其他人并不认为能够很容易掌握成为DBA的秘诀。DBA职业需要掌握一定的技能。而且还需要其他IT职业所不必需的要求。因此，为了回答这个问题，我通常给将要成为DBA的人描述DBA职业所必需的要求。下面的段落中，我都将以问题结尾。在继续下一段以前请花一些时间考虑并且回答这些问题。</p>
</blockquote>
<a id="more"></a>
<blockquote>
<p>许多人因为许多原因而立志要成为DBA。其中一个主要原因是薪水。DBA是IT业中薪水最高的职业之一。其他人想成为DBA是因为喜欢赞扬DBA是受到的荣誉，或者因为他看上去很酷！我个人认为，成为DBA是很值得的。它是一个很有意思，令人兴奋的职业。那么，你把DBA作为一个可能的职业选择的原因是什么呢？</p>
<p>除非你已经提前准备好了，否则你可能会发现从事DBA职业充满了挫折和令人头痛。一个数据库存在于操作系统和最终用户应用程序之间。同样地，DBA必须非常精通他的数据库所在的操作系统。DBA并不一定需要知道所有有关操作系统的知识，但是他知道得越多越好。数据库与操作系统联系非常紧密。理解这种关联是十分必要的。DBA还需要知道服务器硬件以及它如何影响与帮助数据库。同时，DBA必须理解应用软件。DBA可能会被要求帮助开发人员创建可靠，健全的数据库应用程序。还有，最重要的也是最明显的，DBA必须十分彻底的理解数据库引擎，它是如何工作的，所有的引擎是如何组合在一起的，以及如何影响数据库引擎向最终用户和应用程序传送数据的能力。我见过的最好的DBA有非常深刻的理解而且不仅仅在数据库本身。他们知道一些系统管理与应用开发。好多时候他们在成为DBA之前有其中一个或两个背景。无论如何，成为一名合格的而不是出色的DBA也需要许多背景知识。你是否已经做好准备开始学习直到你感到已经无法再学下去了？</p>
<p>许多和我交谈过的，在开始DBA职业时遇到困难的人，在尝试着吸收大量DBA所需了解的信息时实际上都会有一些问题。毕竟系统管理员是全职学习操作系统的细节。应用程序开发人员全职学习如何编写好的程序。DBA不仅要非常了解这两种不同的工作，而且还需要花费更多的时间去理解数据库的体系结构，以及理解每一样东西的每一块是如何组合在一起的！听起来是不是很让人畏缩？有许多人失败后这样想，并且把DBA工作看作一项非常困难的事情。也有那些传播和理解所有这些信息，并且使用这些信息做出好的，听起来具有技术性的决定的人。正如我以前是一名DBA时喜欢说的，所有这些对我来说看上去像一个大谜团。把这些所有的很好的组合在一起就是挑战。你是哪一种人？</p>
<p>许多DBA是随时侯命的。他们会在白天或晚上的所有时间接到呼叫去解决他们的数据库出现的致命问题。数据库是商业信息技术基础组织的必不可少的组成部分。没有数据，就没有必要拥有一个计算机系统。数据推动商业。假如amazon.com的网站不能在数据库中搜索产品并且假如没有人能够为他们的产品下订单，那么它会变成什么样？它就不会在商业中存在很久。当数据库down掉，即使只是很短的时间，公司也会损失重大。基于这个原因，DBA到达现场后必须尽可能迅速的解决问题。许多公司有自己的DBA团队以便可以轮流待命。这些DBA 24×7小时的维持数据库应用程序。假如工作需要的话，你准备好随时候命了么？</p>
<p>一些DBA的职责包括为软件打补丁或者对数据库做些改变。通常，这些操作不能在公司职员工作的时候做，因为此时数据库必须运行以便他们能够工作。这意味着DBA经常不得不在很早或者深夜甚至周末，总之，在正常工作时间以外来完成工作。你准备好在非正常时间工作，或者你在找一个朝九晚五的工作？</p>
<p>对DBA而言，需要掌握的一个重要内容就是通常被称为“软技术”的东西。DBA需要在团队中很好的工作，通常团队是在变化的，如系统管理员，网络管理员，应用程序开发人员，项目经理和其他人。DBA要能够用流利的英语解释复杂的技术概念，让团队中其他人明白。DBA还要能够在数据库相关问题上指挥团队队员。你的软技术怎么样？</p>
<p>下面不是全部列表，但是包括了DBA的典型职责：</p>
<ul>
<li>把监视数据库实例当作每日必做工作以保证其可用性。解决不可用的问题。</li>
<li>收集系统统计和性能信息以便定向和配置分析。</li>
<li>配置和调整数据库实例以便在应用程序特定要求下达到最佳性能。</li>
<li>分析和管理数据库安全性。控制和监视用户对数据库的访问。必要时审计数据库的使用。</li>
<li>监视备份程序。必要时提供恢复。测试备份与恢复程序。</li>
<li>升级RDBMS软件并且在必要时使用补丁。必要时升级或者迁移数据库实例。</li>
<li>通过数据库相关动作来支持应用程序开发人员。</li>
<li>跟随数据库趋向和技术。当可应用时使用新技术。安装，测试和评估Oracle新的相关产品。</li>
<li>执行存储和物理设计。均衡设计问题以完成性能优化。</li>
<li>创建，配置和设计信的数据库实例。</li>
<li>诊断，故障检测和解决任何数据库相关问题。必要时联系Oracle支持人员以便使问题得到较好的解决。</li>
<li>确保Oracle网络软件（SQL*Net, Net8, Names, OiD）配置和运行的很好。</li>
<li>与系统管理员（Unix &amp; NT）一起工作以保证Oracle相关事务得到很好的处理。</li>
<li>为有效的，定期的维护数据库创建任何必要的脚本。</li>
</ul>
<p>前面各段的问题是为了使你考虑一名DBA该做些什么，帮助你决定这是不是适合你的职业。我并非意味着假如你的目标是成为DBA这些会阻止你。我只是尝试着展现一些事实。我看到过一些DBA一旦被实际工作打击了就一蹶不振。他们花费时间，精力和一些金钱获得了他们的第一份DBA工作。我个人认为这个职业非常有价值。而且我无法想像现在做任何其他的会怎样。所以，这一段帮助你决定这是不是你希望从事的。假如它是，那么尽你所有去得到它！</p>
</blockquote>
<hr>
<h2 id="我怎样得到第一份DBA工作？"><a href="#我怎样得到第一份DBA工作？" class="headerlink" title="我怎样得到第一份DBA工作？"></a>我怎样得到第一份DBA工作？</h2><blockquote>
<p>你已经阅读了前面的段落并且认为成为一名DBA是一个好的职业。祝贺你！我希望你的职业能变成你想像得那么令人兴奋和有意义。那么，你如何找到第一份DBA工作？这个问题我已经听别人问了许多许多遍。</p>
<p>在90年代早期，因特网急速发展。它使公司象草一般萌芽。公司蜂拥而至并且开始创建他们在网上的形象。几乎所有这些有网站的公司都需要一个数据库作为web应用的后台。不幸的是，当时在该领域却没有那么多DBA。在IT业，DBA变得奇缺。那段时间里，得到一份DBA工作看上去只要可以拼出“Oracle”或者可能只是在大学里接触过一学期的数据库就行。为了使生活变得更好，DBA的匮乏促使公司付给有潜力的职员很高的薪水。假如你想要成为一名DBA，很容易，非常容易。你需要做的就是证明你了解什么是数据库然后工作就会比你预期的更早的出现在你面前。</p>
<p>然后因特网的泡沫破灭了。大量投产因特网的公司破产。许多给公司工作的DBA重新寻找工作。缺少DBA的公司找到一名有DBA经验的人比以前容易得多。在21世纪初期，由于经济并不十分稳固，因此生活并不容易（至少在美国如此）。公司都勒紧了他们的裤腰带。所有这些转化为更少的工作机会和DBA候选人更少的工作空缺。</p>
<p>得到第一份DBA工作的最艰难的部分是每一个职位都要求有一些工作经验。如果你从公司的角度出发，你就可以理解为什么对DBA职位而言经验是必需的。假如他没有一点经验，你会付给这个人很高的工资让他去操作，维护和运行你IT基础组织的最大最重要的一部分么？你的公司会付钱给一名没有经验的DBA么？并且，在等待他成长起来的过程中可能会损失上百万美元的收入。对大多数公司而言，这些问题的答案肯定是‘不’。所以，没有经验，获得你的第一份DBA工作是很困难的。</p>
<p>第一份DBA工作现在成了恶性循环的境遇。假如我没有任何经验，我怎样才能得到DBA的工作呢？我没有工作的话又怎么能得到DBA经验呢？这是要战胜的最困难的障碍。最困难的部分是获得第一个DBA工作。这部分的剩下部分将针对实现你第一个DBA工作的目标给你一些建议。</p>
<ul>
<li><p><strong>提示#1:接受教育。</strong>–尽可能多的学习有关数据库的知识。这很可能将占用你正常工作以外的部分时间也精力。参加本地大学举办的数据库培训班。许多培训公司都会举办数据库管理员的培训班。假如你的老板不资助你的学习，那么你可能不得不自己支付这笔费用。许多DBA职业要求至少为计算机科学或相关专业本科以上学历，因此你必须至少有那样的文凭。</p>
</li>
<li><p><strong>提示#2:锻炼成为DBA。</strong>–许多数据库供应商都允许你下载他们数据库系统的测试版或评估版。下载一份并且在自己的个人电脑上安装软件。练习使用数据库。故意破坏数据库并且尝试修复它。尝试着履行你所能想到的尽可能多的DBA职责。测试和磨练你在自己的测试平台上的技能这样你就可以证明你的数据库管理能力。</p>
</li>
<li><p><strong>提示#3:获得认证。</strong>–许多数据库提供商都提供自己的数据库产品的认证。许多公司现在都把认证看作是一种标准。需要记住的一件事是仅获得认证是不够的。通过DBA认证测试并不意味着你知道如何管理一个数据库。它只是告诉你以后可能的老板，现在你拥有了一定的技术。它还告诉你的老板你对DBA工作的态度是很认真的。我看到许多人抱怨他们已经得到了认证但是没有经验，却仍然不能得到第一份DBA工作。认证本身并不能使你得到工作，但它是无害的。即使没有其他的，在你进行认证的时候你也已经学到了许多知识。只是不要依赖认证来给你带来你要找的工作。你需要的比这还要多。但它会在最后帮助你。</p>
</li>
<li><p><strong>提示#4:利用你现有的技能。</strong>–许多DBA具有系统管理员背景。其他的有应用程序开发背景。假如可能，查看你能否利用现有的技能来得到工作。现在的目标就是为你和你的老板创造一个双赢的局面。例如，让我们假设你已经是一名系统管理员而想进入DBA领域。也许你会找到一份工作，这份工作一部分时间里可以用到你的系统管理技能，并且在剩下的时间里可以使你涉及到数据库管理领域。假如你已经是一名某个产品平台上的DBA但你希望转到其他产品平台，那么看看你能否找到一份同时接触两个产品平台的工作。这样，公司和你都得到了想要的。在你定向到了DBA工作后，你可以试着得到一个能让你全职作它的职位，也许还可以在同一个公司中。</p>
</li>
<li><p><strong>提示#5:利用现在的机会。</strong>–有时候，一个人进入DBA领域仅仅需要的是正确的地方和正确的时机。假如你现在的老板有一个机会让你进行任何数据库的项目，抓住这个机会！任何数据库经验就比没有数据库经验要好。让你的管理者知道你十分积极的在寻找任何可能的数据库机会。他们就有可能在下次机会到来的时候想到你。进行这些数据库项目以及看到你要成为一个DBA的渴望以后，他们可能会决定培训你，提拔你。许多许多人都是以这种方式获得他的第一个DBA工作，在进行了一些数据库相关的项目后不知不觉的成为一名较低级的DBA。通常当一名DBA离开公司后，公司将在内部寻找一个候选人，假如他们认为这名候选人是可训练的话。</p>
</li>
<li><p><strong>提示#6:寻找较低级的DBA职位。</strong>–假如你只是为了一个较低级的DBA工作，看到DBA职位的需求描述说他们正在寻找高级DBA或者其他的。所以，让我们严谨一些。你并没有一个高级方面的经验。我已经讨论过了对于这样的职位为什么公司不会考虑你。但是他们会在低级的职位上考虑你。低级的DBA在高级DBA的指导下完成工作。他们摸索窍门。一般来说，高级DBA对数据库承担责任，同时也获得所有的荣誉。但是不要焦急。随着你的事业发展，你将会有越来越多的责任和得到越来越多的信任。因为你没有任何经验，你应该从这里开始启航。</p>
</li>
</ul>
<p>我也听到过一些公司寻找一名高级DBA，但是到最后，他们实际想要雇一名低级的DBA。你或许希望申请这样的职位虽然你也许没有资格。他们可能还是会决定雇佣你。但是提前说明你仍然在摸索阶段并且已经是较低级的DBA水平。不要试图欺骗他们让他们认为你是高级DBA的水平。这只会降低你得到这项工作的机会。</p>
<p>这些提示将帮助你得到第一份DBA的工作。祝你在寻找工作时有好运气。当你已经找到了第一份DBA工作后，继续下面的部分来学习如何往下走下去。</p>
</blockquote>
<hr>
<h2 id="我刚得到我的第一份工作！现在该怎样？"><a href="#我刚得到我的第一份工作！现在该怎样？" class="headerlink" title="我刚得到我的第一份工作！现在该怎样？"></a>我刚得到我的第一份工作！现在该怎样？</h2><blockquote>
<p>祝贺你！你现在是DBA俱乐部的正式成员了！对于这份梦寐以求的令人激动的职业，你准备好了么？你的工作才刚开始并且你在学习上已经落在后面。你将会发现要成为一名高效的数据库管理员有大量的知识你必须掌握。你的第一年或前两年将花费比以前更多的时间来学习。假如你发现学习知识的数量使你大脑超负荷，那么休息一下，歇口气，然后再回到学习中去。为了帮助你继续走下去，你可以按照下面的方法进行：</p>
<ul>
<li><strong>步骤#1: 关系型数据库理论</strong><br>这部分我假设你将管理的数据库是一个“关系型”数据库。其他数据库模型也存在，但是关系型模式是近二十年工业上占统治地位的一种数据库模式。假如你的数据库系统是其他的模式，那么学习它的理论。相关数据库理论是十分重要的。它是其他一切的基础。我也看到许多跳到数据库管理职位的人从不想去学习纯粹的关系型数据库理论。不可避免的，在他们的事业中对理论基础的匮乏作为缺点暴露了出来。假如你对关系型数据库理论理解得很好，那么你将非常容易的在任何平台的关系型数据库管理系统（RDBMS）中转变。我使用Oracle数据库，或者IBM的DB2，或者微软的SQL Server是无关紧要的。他们都是关系型数据库系统。他们在最底层都在做着相同的事情。区别在于他们怎样去做相同的事情。纯粹的关系型数据库理论对于较低级的DBA来说并非必需的。但是假如你想要超越低级DBA的水平它就是十分重要的。许多大学的教科书都很好的包含了关系型数据库的理论。其中一本被广泛使用的教科书就是由Elmasri and Navathe编写的数据库系统基础，Bejamin/Cummings Press。</li>
<li><strong>步骤#2: 彻底的学习查询语言</strong><br>数据库都有语言让你能够从数据库中得到数据，把数据放到数据库中，以及修改数据库中的数据。对于关系型数据库而言，这种语言就是结构化查询语言（SQL）。这门语言是你与数据库接触的工具。不能让这个工具成为以后学习的障碍，这一点很重要。在你的测试数据库中练习不同的SQL语句直到他们变成了你的习惯。这方面的一本非常好的书叫做Oracle 9i完全参考（Oracle 9i The Complete Reference）由Loney 和Koch编写，Oracle Press。每一名Oracle DBA都应该在他事业的早期阅读这本书。Oracle 9i参考手册（Oracle 9i SQL Reference manual）是另一个很重要的知识来源。在他们的技术网站TechNet上（<a href="http://technet.oracle.com）你可以访问所有的Oracle在线文档。你必须注册一个账号，但是它是免费的。每个都应该在TechNet上有一个账号。" target="_blank" rel="external">http://technet.oracle.com）你可以访问所有的Oracle在线文档。你必须注册一个账号，但是它是免费的。每个都应该在TechNet上有一个账号。</a></li>
<li><strong>步骤#3: 开始学习基本的数据库管理工作</strong> 这难道不是你最开始在这里的原因？为什么它在列表的第三位？我们尝试着建造一个知识的金字塔，我强烈的感觉到一个人需要知道关系型数据库理论和SQL，并且在你学习如何进行基本的数据库管理工作时把他们当作工具来使用。这些工作包括启动和关闭数据库，备份和恢复数据库，以及创建/删除/修改数据库对象。对于Oracle数据库管理而言，在市面上有大量的书籍可以给你所期望的一个很好的体会。这本书是Oracle 9i DBA手册（Oracle 9i DBA Handbook by Loney on Oracle Press）。我知道的大多数DBA都在他们事业的早期不只一遍的阅读过这本书。这里，你应该同时阅读和理解Oracle 9i 概念指导，Oracle 9i管理员指导，以及Oracle 9i备份与恢复指导（Oracle 9i Concepts Guide, the Oracle 9i Administrator’s Guide, and the Oracle 9i Backup and Recovery Guide）都来自Oracle文档。</li>
<li><strong>步骤#4: 阅读，阅读，再阅读</strong><br>由于你才刚开始你的DBA职业生涯，因此你正在开始为你的技能奠定基础。这需要一段很长的时间去形成，吸收和领会所有你将学到的知识。毫无疑问的，比你资深的DBA由许多工作要做，因此他们可能不会总是腾出大量时间辅导你的学习。你不得不靠自己学习很多东西。这就是阅读的目的。市面上有许多书籍可以解答许多数据库相关的话题。Oracle Press是Oracle公司的官方出版社，有大量的Oracle相关书籍。同时也有其他的出版社，如Wrox Press 和 O’Reilly Press。你也可以找到Oracle文档来阅读。并且还有许多网站和新闻组。尽可能多的读书使你能够继续下去。还有，不只一遍的阅读它们可以使你吸收你第一次阅读时错过的内容。</li>
<li><strong>步骤#5: 创建测试案例</strong><br>我经常看到初学者问一些很基础的问题，其实假如他们花一些时间来考虑，这些问题都是很容易解答的。毫无疑问的，在你开始学习Oracle的时候你会有许多的问题。看看这些问题你能不能自己回答出来。例如，我又一次被问到能不能向有唯一性约束的列中插入空值。最开始，这看上去也许不是很容易回答的问题。但它却是非常容易去试验的！只需要创建一个简单的表。在其中的一列，假如唯一性约束。尝试着在该列插入一个空值。有效么？你应该能够非常容易的回答出这个问题了。那么，为什么要创建这些案例呢？一个原因是这样做可以提高你解决问题的能力。创建这些案例需要的技能就是解决问题用到的技能。解决问题的技能将会对你的DBA事业有很大的帮助。另一个原因是随着你的事业的发展，你将经常需要创建更复杂的测试案例以便保证数据库和应用程序的成功。在将来，甚至简单的测试案例也可以组成更复杂的数据库和应用程序分解。</li>
<li><strong>步骤#6: 找一个良师</strong><br>一个良师能够为你的DBA生涯（或者其它类似的职业）引领方向。他们能够给你指示，回答问题以及在你的DBA的成长过程中帮助你节约一些时间。但愿这篇文章能够在你事业发展的一段时间内起到良师益友的作用。假如你与一名资深的DBA共同工作，那么那个人应该有责任为你的事业进行有益的指导。你也可以同时选择其他的人指导你。</li>
<li><strong>步骤#7: 参加本地用户群</strong><br>许多跨国家的城市有本地用户群，他们定期聚会讨论数据库相关的话题。假如可能，参加其中一个本地用户群。这将给你一个与他人相互交流的很好的方法。</li>
</ul>
</blockquote>
<hr>
<h2 id="我如何能够从一名DBA初学者变为一个具有中级水平的DBA？"><a href="#我如何能够从一名DBA初学者变为一个具有中级水平的DBA？" class="headerlink" title="我如何能够从一名DBA初学者变为一个具有中级水平的DBA？"></a>我如何能够从一名DBA初学者变为一个具有中级水平的DBA？</h2><blockquote>
<p>你已经成为DBA一段时间了，你现在希望你的技术水平提高一阶么？下一步该怎么做？首先，往回看前面的部分，确认你已经完成了所有的步骤。彻底理解SQL语言是十分重要的。理解关系型数据库理论和掌握基本的数据库管理任务也是非常重要的。到如今，你应该阅读文档和其他书籍到已经郁闷了。假如没有，那么你还没准备好继续深造，增长你的DBA的技术水平。假如你已经准备好继续了，我已为你的继续深造准备了一些方法。</p>
<ul>
<li><strong>步骤#1: 学习操作系统和你的服务器硬件</strong><br>正如我前面所说，数据库存在于操作系统和服务器硬件之上。理解这些组成部分如何工作是很必要的。你应该知道如何与特殊的操作系统相合。你如何删除或者编辑文件？假如你的操作系统是Unix，你应该掌握命令行以及Unix命令如何辅助你工作。对于运行在Windows或其他操作系统上而言也是一样的。你同时需要对服务器的硬件有一定的了解。物理内存和虚拟内存有什么区别？RAID是什么以及不同的级别是如何产生影响的？为什么数据库喜欢更多的物理硬盘而非一个大硬盘卷？你需要知道这些事情以便你能够容易的与系统管理员进行如何配置好你的服务器以便使它能够充分的支持数据库方面的交谈。</li>
<li><strong>步骤#2: 学习应用程序设计因为它与数据库相关</strong><br>如前面所述，数据库存在于操作系统与数据库应用程序之间。你真的需要这两者。SQL语言是如何帮助创建好的应用程序的？绑定变量是什么并且为什么他们很重要？Tom Kyte 写了一本非常好的书，在Oracle应用程序设计上给出了很好的建议。他的Expert One-on-one Oracle书可在 Wrox Press找到。我强烈推荐阅读此书。他详细的叙述了那些能够生成和破坏Oracle应用程序的东西。你需要知道这些，因为你的应用程序开发人员希望从你这里得到指导和数据库知识。学习任何与应用程序设计有关的知识。也许参加一个关于软件工程，操作系统或数据结构的课程班会有好处。</li>
<li><strong>步骤#3: 取得认证</strong><br>也许你的工作并不需要，但是取得认证一定对你有益。作为DBA的每一天里，你学到了许多新的和令人激动的事情。也许在你职业生涯的这段时间里，有几天你没学到任何新的东西。但你仍然有很多要学习。成为一名OCP（Oracle Certified Professional） DBA要求你必须已经学到了数据库管理所有方面的基础。我发现在OCP考试的学习过程中，我学到了在我工作中从未接触过的东西。一次我学到了我从未碰到过的一个特殊课题，在后来的日子里我就能够使用那个知识解决问题。假如我从为在OCP考试中学倒它，那么我永远也不会用那种特殊的方法去解决问题。这已经一次次的发生在我的面前。有的人可能会说认证实际上真的不值得。我要说它只会对你有益无害。所以，去取得认证吧！</li>
<li><strong>步骤#5: 获得一个资源库</strong><br>在前面的部分中，我指出每个DBA都应该在Technet上有个账号。这是你其中一个主要资源。但是同时还有许多其他资源。很多人共享他们的Oracle知识。假如你还没有开始，你应该用网络浏览器去搜索并收集很多Oracle资源。愿意的话，你可以从访问我的网站（<a href="http://www.peasland.net）开始。下面是一些Oracle" target="_blank" rel="external">http://www.peasland.net）开始。下面是一些Oracle</a> DBA必须了解得网站列表：<br>Ask Tom – <a href="http://asktom.oracle.com" target="_blank" rel="external">http://asktom.oracle.com</a><br>Jonathan Lewis web site – <a href="http://www.jlcomp.demon.co.uk/" target="_blank" rel="external">http://www.jlcomp.demon.co.uk/</a><br>Ixora (Steve Adams) – <a href="http://www.ixora.com.au" target="_blank" rel="external">http://www.ixora.com.au</a><br>Orapub – <a href="http://www.orapub.com" target="_blank" rel="external">http://www.orapub.com</a><br>Metalink (Oracle支持网站) – <a href="http://metalink.oracle.com" target="_blank" rel="external">http://metalink.oracle.com</a><br>还有许多其它的好网站。</li>
<li>步骤#6: 开始在不同的新闻组和论坛上交流<br>也许你已经发现了他们，但假如现在你还没有那么是时候去开始了。有许多的新闻组和论坛可以回答你的任何Oracle问题。在Oracle群落里还有许多高手愿意和你共享他们的知识。你所要做的就是提问。下面是一个列表包含了可以开始交流的最好的因特网团体：<br>Usenet newsgroups – comp.databases.oracle.server 和 comp.databases.oracle.misc 是两个可以交流的非常著名的世界性的新闻组。他们拥有大量的针对Oracle问题的交流卷宗。观看这些组的最好的方法式使用新闻广播员。但是假如你想通过基于web的方式访问，也可以通过Google搜索引擎搜索它。 (<a href="http://groups.google.com/groups?hl=en&amp;lr=&amp;ie=UTF-8&amp;group=comp.databases.oracle" target="_blank" rel="external">http://groups.google.com/groups?hl=en&amp;lr=&amp;ie=UTF-8&amp;group=comp.databases.oracle</a>)<br>Quest Pipelines – 当他们在最开始还属于软件提供商RevealNet的时候，被称为the RevealNet Pipelines。现在，Quest购买了RevealNet 并且拥有Pipelines 。因为Pipelines是中等的，所以这些是我最喜欢的。你可以在这里找到Pipelines (<a href="http://www.quest-pipelines.com/index.asp)。" target="_blank" rel="external">http://www.quest-pipelines.com/index.asp)。</a></li>
</ul>
<p>观察别人是如何经历考验和磨难的是一件好事。假如你有问题，可以自由的在群里提出来。假如你要提出问题，通常应该包括一些信息，比如你的Oracle版本和Oracle运行的平台。这些将会得到有很大的差别的答案。假如你忘记了，会有人提醒你！甚至你不用提问也可以从其他人的答案中学到许多知识。我已经记不得多少次我之所以能够解决问题完全是因为我记得其他人在新闻组里问过相同的问题。</p>
</blockquote>
<hr>
<h2 id="我如何从一名具有中级水平的DBA转变为一名高级DBA"><a href="#我如何从一名具有中级水平的DBA转变为一名高级DBA" class="headerlink" title="我如何从一名具有中级水平的DBA转变为一名高级DBA?"></a>我如何从一名具有中级水平的DBA转变为一名高级DBA?</h2><blockquote>
<p>好，作为DBA你已经坚持不懈的努力了很长时间。你感到自己已经准备好往前再走一步。成为一名高级DBA需要什么？下面的部分将帮助你走下去。</p>
<ul>
<li><strong>步骤#1: 阅读所有的文档</strong><br>Oracle文档通常并不是很容易阅读的。无数次，你翻阅文档只是为了要弄清整件事情。假如文档是最好的东西，那么那些站在你的书架里的Oracle书籍就不会有市场。但是文档确实包含了一些无法在任何其他地方找到的信息。例如，你无法找到每一个专门的INIT.ORA参数或V$视图的详细说明。书本上也许会涉及一部分，但是Oracle文档却包含它们所有。我遇到过一个非常厉害的高级DBA，他没有从头至尾的阅读过Oracle文档。这不是偶然的。Oracle文档是必须阅读的。也许到现在为止你已经读过Oracle概念指导十二遍了。但是当Oracle 10i发布了，你还要再次阅读。任何有关10i的新概念将在文档里记录。假如你真的想更上一层，那么，去阅读那些文档。不要逃避它。</li>
<li><strong>步骤#2: 成为一名专家</strong><br>Oracle数据库是一个非常复杂的东西。为了更上一层，你必须精通产品的许多组成部分。以备份与恢复开始。成为一名备份与恢复的专家。故意的破坏数据库然后察看如何恢复它。尝试以任何可能的方式破坏数据库然后查看还有没有可能恢复。你将彻底的理解备份与恢复的概念。在你成为了备份与恢复的专家以后，再去成为其他领域的专家。你会有无穷无尽的题目要去掌握。在你整个职业生涯中都保持如此。但是请记住，无论你有多么专业，在某些领域，某些人会在某些方面知道的比你多。不要带个人情绪。只是尽可能多的从那个人那里学到知识。</li>
<li><strong>步骤#3: 积极参加新闻组，论坛和用户组</strong><br>在前面，我提过为什么不同的新闻组和论坛是学习新知识的很好的地方。现在轮到你进行下一步并且去回答任何你能够回答的问题。你将会惊讶于在这过程中你能学到那么多！<br><strong>步骤#4: 写白皮书并且展示它们</strong><br>这与前面提到的方法类似。首先，共享你拥有的知识是很重要的。假如你的职业生涯已经走到这一步，那么从某种意义上讲，是离不开他人的贡献的。所以，现在是你为他人奉献的时候了。第二，当你企图共享你的信息的时候会有令人惊异的事情发生。在你要用清楚的，简练的语言表述问题以便其他人能够使用时，那些信息在你的头脑里经过了一个令人瞠目的过程。这个过程使你巩固了知识，这是无法通过其它方法进行的。所以在白皮书中共享那些信息，讨论会，以及新闻组和论坛都是你学习和使你的能力更上一层的非常好的方法。顺着这条路，你应该作两件事。第一，认识到你将会犯错误。其他人将会很高兴的指出那些错误，有时在某种意义上那并不是很好。不要企图掩藏你的错误。承认它们并从它们那里学习。第二，学会说你不知道答案而不是企图以欺骗的方式通过。人们早晚会知道你在企图蒙蔽他们。简单的告诉他们现在你对答案并不肯定，但你会在查到答案后回来告诉他们。假如你时刻谨记这两件事，你就不会违背你的诚实而且你将成长为一名职业的IT人。</li>
<li><strong>步骤#5: 成为解决Oracle问题的专家</strong><br>高级DBA通常都是被看作是解决复杂的Oracle问题的人。你将会用到你所有的技术来解决许多问题，这些技术都是你的职业生涯中积累下来的。我前面提到的任何事都将会在解决问题的过程中用到；文档，书籍，新闻组，测试案例，和其它DBA都将辅助你解决问题。</li>
<li><strong>步骤#6: 成为性能调优的专家</strong><br>高级DBA通常都是被看作是调整数据库和应用程序性能的人。假如你是高级DBA但是你却不能分析性能瓶颈，那么你的公司将会到别处寻找这些服务。</li>
<li><strong>步骤#7: 成为承载能力计划的专家</strong><br>高级DBA通常都是被看作是根据数据增长量和交易增长来计划数据库承载能力的人。高级DBA需要在影响应用程序性能以前发现系统瓶颈。例如，DBA应该知道在数据库将可用的磁盘空间用完以前预置更多的磁盘空间。不密切关注承载能力计划将会导致生产数据库宕机。</li>
<li><strong>步骤#8: 密切关注新的技术</strong><br>高级DBA应该对IT界的关数据库技术的未来有好的建议。有什么可用的技术可以帮助数据库？例如，学习存储领域网的优缺点以及如何把它们应用到数据库系统。有什么技术在不远的将来可以用，哪些能够帮助我们？例如，写这篇文章的时候，linux操作系统正在变得越来越流行。Lunix会给你的数据库操作系统平台带来些什么？它能为你的公司工作么？</li>
</ul>
<p><strong>结论</strong><br>从获得第一份工作，到从一名初级的DBA成长成一名高级DBA，我希望这篇文章在如何度过你的职业生涯的各个阶段方面给了你一些建议。无论你现在处在你的DBA职业生涯的哪一阶段都可以用到这篇文章。</p>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Oracle简单易懂之SCN]]></title>
      <url>http://wangbinbin0326.github.io/2016/10/21/Oracle%E7%AE%80%E5%8D%95%E6%98%93%E6%87%82%E4%B9%8BSCN/</url>
      <content type="html"><![CDATA[<p>#第三章 SCN(system change numbe)</p>
<h2 id="3-1-Oracle-SCN-概念"><a href="#3-1-Oracle-SCN-概念" class="headerlink" title="3.1 Oracle SCN 概念"></a>3.1 Oracle SCN 概念</h2><blockquote>
<p>SCN（system change number）： 系统改变号，用以标识数据库在某个确切的时刻提交的版本。</p>
<ul>
<li>在事务提交时，它被赋予一个唯一的标示事务的SCN。</li>
<li>是Oracle内部的时钟机制；</li>
<li>通过SCN来维护数据库的一致性；</li>
<li>通过SCN来实施恢复机制；</li>
<li>SCN在数据库中是唯一的，并随时间而增加，但是可能并不连贯。</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ol>
<li><strong>系统检查点SCN: 查询目前系统最新的SCN（redo log SCN）</strong><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">col GET_SYSTEM_CHANGE_NUMBER for 99999999999999;</div><div class="line"><span class="keyword">select</span> dbms_flashback.get_system_change_number <span class="keyword">from</span> dual;</div><div class="line"></div><div class="line">GET_SYSTEM_CHANGE_NUMBER</div><div class="line"><span class="comment">------------------------</span></div><div class="line">          11795798036771</div></pre></td></tr></table></figure>
</li>
</ol>
</blockquote>
<a id="more"></a>
<blockquote>
<p>这里返回的SCN，是目前redo log file最新的SCN纪录。因为commit后的交易才会有SCN，而一旦commit就会立刻写入redo log file中。</p>
<hr>
<p><strong>CHECKPOINT和SCN的关联</strong></p>
<p>Checkpoint发生的目的就是要把存储在buffer内的已提交交易写回disk，否则一旦发生crash，需要进行recovery时，就必须花很多时间从redo log file内最后的SCN交易开始进行recovery，这样在商业应用上是很浪费时间和没有效率的。</p>
<p>当commit一笔交易时，只会立刻将redo buffer写入redo log file内，但是并不会马上将该update后的block（dirty block）同步写回disk datafile中，这是为了减少过多disk IO，所以采取batch方式写入。</p>
<p>When a checkpoint occurs. Oracle must update the headers of all datafiles to record the details of the checkpoint.  This is done by the CKPT process.  The CKPT process does not write blocks to disk; DBWn always performs that work.</p>
<hr>
<p><strong>SCN写入的地方</strong></p>
<p>在shutdown normal or shutdown immediate下， checkpoint也会自动触发。当发生checkpoint时，会把SCN写到四个地方去。三个地方在control file 内，一个在datafile header。</p>
<p>Control file三个地方为：</p>
<p><strong>1. System checkpoint SCN</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">col checkpoint_change# for 99999999999999;</div><div class="line">select checkpoint_change# from v$database;</div><div class="line"></div><div class="line">CHECKPOINT_CHANGE#</div><div class="line">------------------</div><div class="line">    11795798023082</div></pre></td></tr></table></figure></p>
<p><strong>2. Datafile checkpoint SCN</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">select name, checkpoint_change# from v$datafile where name like '%user%';</div><div class="line"></div><div class="line">NAME                                                    CHECKPOINT_CHANGE#</div><div class="line">------------------------------------------------------- ------------------</div><div class="line">/home/oracle/app/oracle/oradata/tonytest/users01.dbf        11795798023082</div><div class="line">/home/oracle/app/oracle/oradata/tonytest/user02.dbf         11795798023082</div></pre></td></tr></table></figure></p>
<p><strong>3. Stop SCN</strong> (正常datafile在read-write mode运作下，last_change#一定是null)</p>
<blockquote>
<p>Stop scn记录在数据文件头上。当数据库处在打开状态时，stop scn被设成最大值0xffff.ffffffff。在数据库正常关闭过程中，stop scn被设置成当前系统的最大scn值。在数据库打开过程中，Oracle会比较各文件的stop scn和checkpoint scn，如果值不一致，表明数据库先前没有正常关闭，需要做恢复。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">select name,last_change# from v$datafile where name like '%user%';</div><div class="line"></div><div class="line">NAME                                                    LAST_CHANGE#</div><div class="line">------------------------------------------------------- ------------</div><div class="line">/home/oracle/app/oracle/oradata/tonytest/users01.dbf</div><div class="line">/home/oracle/app/oracle/oradata/tonytest/user02.dbf</div></pre></td></tr></table></figure></p>
</blockquote>
<p>一个SCN在datafile header内:</p>
<p><strong>1. Start SCN</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">select name,checkpoint_change# from v$datafile_header where name like &apos;%user%&apos;;</div><div class="line"></div><div class="line">NAME                                                    CHECKPOINT_CHANGE#</div><div class="line">------------------------------------------------------- ------------------</div><div class="line">/home/oracle/app/oracle/oradata/tonytest/users01.dbf        11795798023082</div><div class="line">/home/oracle/app/oracle/oradata/tonytest/user02.dbf         11795798023082</div></pre></td></tr></table></figure></p>
<blockquote>
<p>注：为什么储存在control file中要分为两个地方（system checkpoint scn, datafile checkpoint scn?）。当把一个tbs设为read-only时，他的scn会冻结停止，此时datafile checkpoint scn是不会再递增改变的，但是整体的system checkpoint scn却仍然会不断递增前进。所以这是为什么需要分别在两个地方储存SCN。</p>
</blockquote>
</blockquote>
<hr>
<blockquote>
<p>正常shutdown database后，SCN会发生什么变化？</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">shutdown immediate;</div><div class="line">Database closed.</div><div class="line">Database dismounted.</div><div class="line">ORACLE instance shut down.</div><div class="line">SQL&gt;</div><div class="line">startup mount;</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 6714322944 bytes</div><div class="line">Fixed Size                  2239192 bytes</div><div class="line">Variable Size            6610224424 bytes</div><div class="line">Database Buffers           83886080 bytes</div><div class="line">Redo Buffers               17973248 bytes</div><div class="line">Database mounted.</div><div class="line">SQL&gt;</div><div class="line">select checkpoint_change# from v$database;</div><div class="line"></div><div class="line">CHECKPOINT_CHANGE#</div><div class="line">------------------</div><div class="line">    11795798038215</div><div class="line"></div><div class="line">select name, checkpoint_change# from v$datafile where name like &apos;%user%&apos;;</div><div class="line"></div><div class="line">NAME                                                    CHECKPOINT_CHANGE#</div><div class="line">------------------------------------------------------- ------------------</div><div class="line">/home/oracle/app/oracle/oradata/tonytest/users01.dbf        11795798038215</div><div class="line">/home/oracle/app/oracle/oradata/tonytest/user02.dbf         11795798038215</div><div class="line"></div><div class="line">col LAST_CHANGE# for 99999999999999;</div><div class="line">select name, last_change# from v$datafile where name like &apos;%user%&apos;;</div><div class="line"></div><div class="line">NAME                                                       LAST_CHANGE#</div><div class="line">------------------------------------------------------- ---------------</div><div class="line">/home/oracle/app/oracle/oradata/tonytest/users01.dbf     11795798038215</div><div class="line">/home/oracle/app/oracle/oradata/tonytest/user02.dbf      11795798038215</div><div class="line">-- 可以看到储存在control file中的三个SCN的数值都是相同的，注意此时的stop scn不会是null，而是等于start scn。</div><div class="line"></div><div class="line">select name,checkpoint_change# from v$datafile_header where name like &apos;%user%&apos;;</div><div class="line"></div><div class="line">NAME                                                    CHECKPOINT_CHANGE#</div><div class="line">------------------------------------------------------- ------------------</div><div class="line">/home/oracle/app/oracle/oradata/tonytest/users01.dbf        11795798038215</div><div class="line">/home/oracle/app/oracle/oradata/tonytest/user02.dbf         11795798038215</div><div class="line"></div><div class="line">/**</div><div class="line">当shutdown时，checkpoint会进行，并且此时datafile的stop scn和start scn会相同。等我们打开数据库时，oracle会检查datafile header中的start scn和存于control file中的datafile的scn是否相同，如果相同，接着检查start scn和stop scn是否相同，如果仍然相同，数据库会正常启动，否则就需要recovery….等到数据库open后，储存在control file中的stop scn就会恢复为null值，此时表示datafile是open在正常模式下。</div><div class="line">如果不正常shutdown(shutdown abort)，则mount数据库后，会发现stop scn并不等于其它位置的scn，而是等于null。这表示oracle在shutdown时没有进行checkpoint，下次启动必须进行crash recovery。</div><div class="line">**/</div></pre></td></tr></table></figure>
<blockquote>
<p>补充：</p>
<ul>
<li><strong>Commit SCN</strong><br>当用户提交commit命令后，系统将当前scn赋给该transaction。这些信息都反映在redo buffer中，并马上更新到redo log 文件里。</li>
<li><strong>Offline SCN</strong><br>除了System tablespace以外的任何表空间，当我们执行<code>SQL&gt;alter tablespace … offline normal</code>命令时，就会触发一个checkpoint，将内存中的dirty buffer写入磁盘文件中。Checkpoint完成后，数据文件头会更新checkpoint scn和offline normal scn值。其中数据库文件头的checkpoint scn值可通过查询列x$kccfe.fecps得到。<br>如果执行<code>SQL&gt;alter tablespace …offline</code>命令时采用temporary或 immediate选项，而不用normal选项时，offline normal scn会被设成0。这样当数据库重启后通过resetlog方式打开时，该表空间就无法再改回在线状态。</li>
<li><strong>Checkpoint SCN</strong><br>当数据库内存的脏数据块(dirty blocks)写到各数据文件中时，就发生一次checkpoint。数据库的当前checkpoint scn值存在x\$kccdi.discn中。Checkpoint scn在数据库恢复中起着至关重要的作用。无论你用何种办法恢复数据库，只有当各个数据库文件的checkpoint scn都相同时，数据库才能打开。<br>虽然参数<code>_allow_resetlogs_corruption</code>可以在checkpoint scn不一致时强制打开数据库，但是这样的数据库在open后必须马上作全库的export，然后重建数据库并import数据。</li>
<li><strong>Resetlog SCN</strong><br>数据库不完全恢复时，在指定时间点后的scn都无法再应用到数据库中。Resetlog时的scn就被设成当前数据库scn，redo log也会被重新设置。</li>
<li><strong>High and Low SCN</strong><br>Oracle的Redo log会顺序纪录数据库的各个变化。一组redo log文件写满后，会自动切换到下一组redo log文件。则上一组redo log的high scn就是下一组redo log的low scn。<br>在视图v\$log_history中，sequence#代表redo log的序列号，first_change#表示当前redo log的low scn，列next_change#表示当前redo log的high scn。</li>
</ul>
</blockquote>
<hr>
<blockquote>
<p>总结：</p>
<ul>
<li>在control file,redo log,data file中都存在SCN值；</li>
<li>数据库open时，检查control file中记录的SCN值与数据文件，redo log文件是否一致，如果是，数据库打开，否则，提示错误；假如数据文件SCN值小于control file中的SCN值则提示该数据文件需要介质恢复；</li>
<li>redo log 中存在低SCN，高SCN值两种，当前的redo log文件的高SCN值为无穷大；日志发生切换时，高SCN值更新为系统当前SCN值，新日志文件低SCN值为前日志文件高SCN值加1，高SCN值仍然为去穷大；数据库发生变化，则写redo log文件，同时SCN值会加1。</li>
<li>检查点发生时，CKPT更新数据文件头。</li>
</ul>
</blockquote>
<hr>
<h2 id="3-2-Oracle-SCN机制解析"><a href="#3-2-Oracle-SCN机制解析" class="headerlink" title="3.2 Oracle SCN机制解析"></a>3.2 Oracle SCN机制解析</h2><blockquote>
<p>SCN（System Chang Number）作为oracle中的一个重要机制，在数据恢复、Data Guard、Streams复制、RAC节点间的同步等各个功能中起着重要作用。理解SCN的运作机制，可以帮助你更加深入地了解上述功能。<br>在理解SCN之前，我们先看下oracle事务中的数据变化是如何写入数据文件的：</p>
<ol>
<li>事务开始；</li>
<li>在buffer cache中找到需要的数据块，如果没有找到，则从数据文件中载入buffer cache中；</li>
<li>事务修改buffer cache的数据块，该数据被标识为“脏数据”，并被写入log buffer中；</li>
<li>事务提交，LGWR进程将log buffer中的“脏数据”写入redo log file中；</li>
<li>当发生checkpoint，CKPT进程更新所有数据文件的文件头中的信息，DBWn进程则负责将Buffer Cache中的脏数据写入到数据文件中。</li>
</ol>
</blockquote>
<p><img src="http://wangbinbin0326.github.io/images/database/oracle/DB-Transcation-flow.png" alt="此处输入图片的描述"></p>
<blockquote>
<p>经过上述5个步骤，事务中的数据变化最终被写入到数据文件中。但是，一旦在上述中间环节时，数据库意外宕机了，在重新启动时如何知道哪些数据已经写入数据文件、哪些没有写呢（同样，在DG、streams中也存在类似疑问：redo log中哪些是上一次同步已经复制过的数据、哪些没有）？SCN机制就能比较完善的解决上述问题。</p>
<p>SCN是一个数字，确切的说是一个只会增加、不会减少的数字。正是它这种只会增加的特性确保了Oracle知道哪些应该被恢复、哪些应该被复制。</p>
<hr>
<p><strong>总共有4种SCN：</strong></p>
<ul>
<li>存在于控制文件中</li>
</ul>
<blockquote>
<ul>
<li>系统检查点（System Checkpoint）SCN、         </li>
<li>数据文件检查点（Datafile Checkpoint）SCN、   </li>
<li>结束SCN（Stop SCN）、                        </li>
</ul>
</blockquote>
<ul>
<li>存在于数据文件的文件头中</li>
</ul>
<blockquote>
<ul>
<li>开始SCN（Start SCN）。</li>
</ul>
</blockquote>
<p>在控制文件中，System Checkpoint SCN是针对整个数据库全局的，因而只存在一个，而Datafile Checkpoint SCN和Stop SCN是针对每个数据文件的，因而一个数据文件就对应在控制文件中存在一份Datafile Checkpoint SCN和Stop SCN。在数据库正常运行期间，Stop SCN(通过视图v$datafile的字段last_change#可以查询)是一个无穷大的数字或者说是NULL。</p>
<p>在一个事务提交后（上述第四个步骤），会在redo log中存在一条redo记录，同时，系统为其提供一个最新的SCN（通过函数<code>dbms_flashback.get_system_change_number</code>可以知道当前的最新SCN），记录在该条记录中。如果该条记录是在redo log被清空（日志满做切换时或发生checkpoint时，所有变化日志已经被写入数据文件中），则其SCN被记录为redo log的low SCN。以后在日志再次被清空前写入的redo记录中SCN则成为Next SCN。</p>
<p>当日志切换或发生checkpoint（上述第五个步骤）时，从Low SCN到Next SCN之间的所有redo记录的数据就被DBWn进程写入数据文件中，而CKPT进程则将所有数据文件（无论redo log中的数据是否影响到该数据文件）的文件头上记录的Start SCN(通过视图<code>v$datafile_header</code>的字段<code>checkpoint_change#</code>可以查询)更新为Next SCN，同时将控制文件中的System Checkpoint SCN（通过视图<code>v$database</code>的字段<code>checkpoint_change#</code>可以查询）、每个数据文件对应的Datafile Checkpoint（通过视图<code>v$datafile</code>的字段<code>checkpoint_change#</code>可以查询）也更新为Next SCN。但是，如果该数据文件所在的表空间被设置为read-only时，数据文件的Start SCN和控制文件中Datafile Checkpoint SCN都不会被更新。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">#从control file的转换trace中可以查到redo log 的SCN， </div><div class="line">***************************************************************************</div><div class="line">LOG FILE RECORDS</div><div class="line">***************************************************************************</div><div class="line"> (size = 72, compat size = 72, section max = 16, section in-use = 3,</div><div class="line">  last-recid= 0, old-recno = 0, last-recno = 0)</div><div class="line"> (extent = 1, blkno = 10, numrecs = 16)</div><div class="line">LOG FILE #1:</div><div class="line">  name #1: /home/oracle/app/oracle/oradata/tonytest/redo01.log</div><div class="line"> Thread 1 redo log links: forward: 2 backward: 0</div><div class="line"> siz: 0x19000 seq: 0x000034b8 hws: 0x2 bsz: 512 nab: 0xebda flg: 0x0 dup: 1</div><div class="line"> Archive links: fwrd: 2 back: 0 Prev scn: 0x0aba.6e5a1de6</div><div class="line"> Low scn: 0x0aba.6e5a4b08 10/07/2016 04:20:30</div><div class="line"> Next scn: 0x0aba.6e5a7a7f 10/07/2016 07:30:04</div><div class="line">LOG FILE #2:</div><div class="line">  name #3: /home/oracle/app/oracle/oradata/tonytest/redo02.log</div><div class="line"> Thread 1 redo log links: forward: 3 backward: 1</div><div class="line"> siz: 0x19000 seq: 0x000034b9 hws: 0x2 bsz: 512 nab: 0xe54d flg: 0x0 dup: 1</div><div class="line"> Archive links: fwrd: 3 back: 1 Prev scn: 0x0aba.6e5a4b08</div><div class="line"> Low scn: 0x0aba.6e5a7a7f 10/07/2016 07:30:04</div><div class="line"> Next scn: 0x0aba.6e5aa93c 10/07/2016 10:46:57</div><div class="line">LOG FILE #3:</div><div class="line">  name #2: /home/oracle/app/oracle/oradata/tonytest/redo03.log</div><div class="line"> Thread 1 redo log links: forward: 0 backward: 2</div><div class="line"> siz: 0x19000 seq: 0x000034ba hws: 0x1 bsz: 512 nab: 0xffffffff flg: 0x8 dup: 1</div><div class="line"> Archive links: fwrd: 0 back: 2 Prev scn: 0x0aba.6e5a7a7f</div><div class="line"> Low scn: 0x0aba.6e5aa93c 10/07/2016 10:46:57</div><div class="line"> Next scn: 0xffff.ffffffff 01/01/1988 00:00:00</div></pre></td></tr></table></figure>
<blockquote>
<p>那系统是如何产生一个最新的SCN的？实际上，这个数字是由当时的timestamp转换过来的。每当需要产生一个最新的SCN到redo记录时，系统获取当时的timestamp，将其转换为数字作为SCN。我们可以通过函数SCN_TO_TIMESTAMP（10g以后）将其转换回timestamp：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">select dbms_flashback.get_system_change_number scn, SCN_TO_TIMESTAMP(dbms_flashback</div><div class="line">.get_system_change_number) time from dual;</div><div class="line"></div><div class="line">            SCN TIME</div><div class="line">--------------- ----------------------------------------</div><div class="line"> 11795798433624 28-DEC-15 06.32.39.000000000 AM</div><div class="line"> </div><div class="line"> #函数timestamp_to_scn将一个timestamp转换为SCN：</div><div class="line"> select timestamp_to_scn(SYSTIMESTAMP) as scn from dual;</div><div class="line"></div><div class="line">            SCN</div><div class="line">---------------</div><div class="line"> 11795798433722</div></pre></td></tr></table></figure>
<blockquote>
<p>最后，SCN除了作为反映事务数据变化并保持同步外，它还起到系统的“心跳”作用——每隔3秒左右系统会刷新一次系统SCN。</p>
<p>下面，在简单介绍一下SCN如何在数据库恢复中起作用。</p>
<ul>
<li>数据库关闭 </li>
</ul>
<blockquote>
<ul>
<li>数据库在正常关闭（shutdown immediate/normal）时，会先做一次checkpoint，将log file中的数据写入数据文件中，将控制文件、数据文件中的SCN（包括控制文件中的Stop SCN）都更新为最新的SCN。</li>
<li>数据库异常/意外关闭不会或者只更新部分Stop SCN。</li>
</ul>
</blockquote>
<ul>
<li>当数据库启动时，</li>
</ul>
<blockquote>
<ol>
<li>Oracle先检查控制文件中的每个Datafile Checkpoint SCN和数据文件中的Start SCN是否相同，</li>
<li>再检查每个Datafile Checkpoint SCN和Stop SCN是否相同。</li>
<li>如果发现有不同，就从Redo Log中找到丢失的SCN，重新写入数据文件中进行恢复。具体的数据恢复过程这里就不再赘述。</li>
</ol>
</blockquote>
<p>SCN作为Oracle中的一个重要机制，在多个重要功能中起着“控制器”的作用。了解SCN的产生和实现方式，帮助DBA理解和处理恢复、DG、Streams复制的问题。</p>
<p>最后提一句，利用SCN机制，在Oracle10g、11g中又增加了一些很实用的功能——数据库闪回、数据库负载重现等。</p>
</blockquote>
<hr>
<h2 id="3-3-Oracle-SCN恢复"><a href="#3-3-Oracle-SCN恢复" class="headerlink" title="3.3 Oracle SCN恢复"></a>3.3 Oracle SCN恢复</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div></pre></td><td class="code"><pre><div class="line">#查看控制文件中的System checkpoint SCN，Datafile checkpoint SCN，Stop SCN， datafile header内Start SCN</div><div class="line">select checkpoint_change# from v$database; --控制文件中的scn</div><div class="line"></div><div class="line">CHECKPOINT_CHANGE#</div><div class="line">------------------</div><div class="line">    11795798441810</div><div class="line"></div><div class="line">select file#,checkpoint_change#,last_change# from v$datafile; --Datafile checkpoint SCN &amp; Stop SCN</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#    LAST_CHANGE#</div><div class="line">---------- ------------------ ---------------</div><div class="line">         1     11795798441810</div><div class="line">         2     11795798441810</div><div class="line">         3     11795798441810</div><div class="line">         4     11795798441810</div><div class="line">         5     11795798441810</div><div class="line">         6     11795798441810</div><div class="line">         7     11795798441810</div><div class="line">         8     11795798441810</div><div class="line">         9     11795798441810</div><div class="line">        10     11795798441810</div><div class="line">        11     11795798441810</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#    LAST_CHANGE#</div><div class="line">---------- ------------------ ---------------</div><div class="line">        12     11795798441810</div><div class="line">        13     11795798441810</div><div class="line">        14     11795798441810    </div><div class="line"></div><div class="line">select file#,checkpoint_change# from v$datafile_header; --start scn：</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1     11795798441810</div><div class="line">         2     11795798441810</div><div class="line">         3     11795798441810</div><div class="line">         4     11795798441810</div><div class="line">         5     11795798441810</div><div class="line">         6     11795798441810</div><div class="line">         7     11795798441810</div><div class="line">         8     11795798441810</div><div class="line">         9     11795798441810</div><div class="line">        10     11795798441810</div><div class="line">        11     11795798441810</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">        12     11795798441810</div><div class="line">        13     11795798441810</div><div class="line">        14     11795798441810</div><div class="line"></div><div class="line">#创建表</div><div class="line">create table test_scn(id number, name varchar2(10));</div><div class="line"></div><div class="line">Table created.</div><div class="line"></div><div class="line">insert into test_scn values(1,&apos;QA1&apos;);</div><div class="line"></div><div class="line">1 row created.</div><div class="line"></div><div class="line">commit;</div><div class="line"></div><div class="line">Commit complete.</div><div class="line"></div><div class="line">insert into test_scn values(2, &apos;QA2&apos;);</div><div class="line"></div><div class="line">1 row created.</div><div class="line"></div><div class="line">select * from test_scn;</div><div class="line"></div><div class="line">        ID NAME</div><div class="line">---------- ----------</div><div class="line">         1 QA1</div><div class="line">         2 QA2</div><div class="line"></div><div class="line">#模拟突然断电，</div><div class="line">shutdown abort;</div><div class="line">ORACLE instance shut down.</div><div class="line">startup mount;</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 6714322944 bytes</div><div class="line">Fixed Size                  2239192 bytes</div><div class="line">Variable Size            6610224424 bytes</div><div class="line">Database Buffers           83886080 bytes</div><div class="line">Redo Buffers               17973248 bytes</div><div class="line">Database mounted.</div><div class="line"></div><div class="line">select checkpoint_change# from v$database;</div><div class="line"></div><div class="line">CHECKPOINT_CHANGE#</div><div class="line">------------------</div><div class="line">    11795798441810</div><div class="line"></div><div class="line"></div><div class="line">select file#,checkpoint_change#,last_change# from v$datafile;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#    LAST_CHANGE#</div><div class="line">---------- ------------------ ---------------</div><div class="line">         1     11795798441810</div><div class="line">         2     11795798441810</div><div class="line">         3     11795798441810</div><div class="line">         4     11795798441810</div><div class="line">         5     11795798441810</div><div class="line">         6     11795798441810</div><div class="line">         7     11795798441810</div><div class="line">         8     11795798441810</div><div class="line">         9     11795798441810</div><div class="line">        10     11795798441810</div><div class="line">        11     11795798441810</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#    LAST_CHANGE#</div><div class="line">---------- ------------------ ---------------</div><div class="line">        12     11795798441810</div><div class="line">        13     11795798441810</div><div class="line">        14     11795798441810</div><div class="line"></div><div class="line"></div><div class="line">select file#,checkpoint_change# from v$datafile_header;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">         1     11795798441810</div><div class="line">         2     11795798441810</div><div class="line">         3     11795798441810</div><div class="line">         4     11795798441810</div><div class="line">         5     11795798441810</div><div class="line">         6     11795798441810</div><div class="line">         7     11795798441810</div><div class="line">         8     11795798441810</div><div class="line">         9     11795798441810</div><div class="line">        10     11795798441810</div><div class="line">        11     11795798441810</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#</div><div class="line">---------- ------------------</div><div class="line">        12     11795798441810</div><div class="line">        13     11795798441810</div><div class="line">        14     11795798441810</div><div class="line"></div><div class="line">#这时发现start scn 与last scn不等，last scn为无穷大，需要例程恢复</div><div class="line">alter database open;</div><div class="line"></div><div class="line">Database altered.</div><div class="line"></div><div class="line">#alter database open; 会自动实例恢复，如下</div><div class="line">[oracle@hzvscmdb alert]$ tail -f log.xml</div><div class="line">&lt;msg time=&apos;2015-12-28T08:22:35.971+00:00&apos; org_id=&apos;oracle&apos; comp_id=&apos;rdbms&apos;</div><div class="line"> client_id=&apos;&apos; type=&apos;UNKNOWN&apos; level=&apos;16&apos;</div><div class="line"> host_id=&apos;hzvscmdb&apos; host_addr=&apos;10.224.188.188&apos; module=&apos;sqlplus@hzvscmdb (TNS V1-V3)&apos;</div><div class="line"> pid=&apos;26632&apos;&gt;</div><div class="line"> &lt;txt&gt;Beginning crash recovery of 1 threads</div><div class="line"> &lt;/txt&gt;</div><div class="line">&lt;/msg&gt;</div><div class="line">&lt;msg time=&apos;2015-12-28T08:22:36.106+00:00&apos; org_id=&apos;oracle&apos; comp_id=&apos;rdbms&apos;</div><div class="line"> client_id=&apos;&apos; type=&apos;UNKNOWN&apos; level=&apos;16&apos;</div><div class="line"> host_id=&apos;hzvscmdb&apos; host_addr=&apos;10.224.188.188&apos; module=&apos;sqlplus@hzvscmdb (TNS V1-V3)&apos;</div><div class="line"> pid=&apos;26632&apos;&gt;</div><div class="line"> &lt;txt&gt; parallel recovery started with 7 processes</div><div class="line"> &lt;/txt&gt;</div><div class="line">&lt;/msg&gt;</div><div class="line">&lt;msg time=&apos;2015-12-28T08:22:36.114+00:00&apos; org_id=&apos;oracle&apos; comp_id=&apos;rdbms&apos;</div><div class="line"> client_id=&apos;&apos; type=&apos;UNKNOWN&apos; level=&apos;16&apos;</div><div class="line"> host_id=&apos;hzvscmdb&apos; host_addr=&apos;10.224.188.188&apos; module=&apos;sqlplus@hzvscmdb (TNS V1-V3)&apos;</div><div class="line"> pid=&apos;26632&apos;&gt;</div><div class="line"> &lt;txt&gt;Started redo scan</div><div class="line"> &lt;/txt&gt;</div><div class="line">&lt;/msg&gt;</div><div class="line">&lt;msg time=&apos;2015-12-28T08:22:36.162+00:00&apos; org_id=&apos;oracle&apos; comp_id=&apos;rdbms&apos;</div><div class="line"> client_id=&apos;&apos; type=&apos;UNKNOWN&apos; level=&apos;16&apos;</div><div class="line"> host_id=&apos;hzvscmdb&apos; host_addr=&apos;10.224.188.188&apos; module=&apos;sqlplus@hzvscmdb (TNS V1-V3)&apos;</div><div class="line"> pid=&apos;26632&apos;&gt;</div><div class="line"> &lt;txt&gt;Completed redo scan</div><div class="line"> &lt;/txt&gt;</div><div class="line">&lt;/msg&gt;</div><div class="line">&lt;msg time=&apos;2015-12-28T08:22:36.162+00:00&apos; org_id=&apos;oracle&apos; comp_id=&apos;rdbms&apos;</div><div class="line"> client_id=&apos;&apos; type=&apos;UNKNOWN&apos; level=&apos;16&apos;</div><div class="line"> host_id=&apos;hzvscmdb&apos; host_addr=&apos;10.224.188.188&apos; module=&apos;sqlplus@hzvscmdb (TNS V1-V3)&apos;</div><div class="line"> pid=&apos;26632&apos;&gt;</div><div class="line"> &lt;txt&gt; read 563 KB redo, 86 data blocks need recovery</div><div class="line"> &lt;/txt&gt;</div><div class="line">&lt;/msg&gt;</div><div class="line">&lt;msg time=&apos;2015-12-28T08:22:36.164+00:00&apos; org_id=&apos;oracle&apos; comp_id=&apos;rdbms&apos;</div><div class="line"> client_id=&apos;&apos; type=&apos;UNKNOWN&apos; level=&apos;16&apos;</div><div class="line"> host_id=&apos;hzvscmdb&apos; host_addr=&apos;10.224.188.188&apos; module=&apos;sqlplus@hzvscmdb (TNS V1-V3)&apos;</div><div class="line"> pid=&apos;26632&apos;&gt;</div><div class="line"> &lt;txt&gt;Started redo application at</div><div class="line"> &lt;/txt&gt;</div><div class="line">&lt;/msg&gt;</div><div class="line">&lt;msg time=&apos;2015-12-28T08:22:36.164+00:00&apos; org_id=&apos;oracle&apos; comp_id=&apos;rdbms&apos;</div><div class="line"> client_id=&apos;&apos; type=&apos;UNKNOWN&apos; level=&apos;16&apos;</div><div class="line"> host_id=&apos;hzvscmdb&apos; host_addr=&apos;10.224.188.188&apos; module=&apos;sqlplus@hzvscmdb (TNS V1-V3)&apos;</div><div class="line"> pid=&apos;26632&apos;&gt;</div><div class="line"> &lt;txt&gt; Thread 1: logseq 12003, block 81045</div><div class="line"> &lt;/txt&gt;</div><div class="line">&lt;/msg&gt;</div><div class="line">&lt;msg time=&apos;2015-12-28T08:22:36.165+00:00&apos; org_id=&apos;oracle&apos; comp_id=&apos;rdbms&apos;</div><div class="line"> client_id=&apos;&apos; type=&apos;UNKNOWN&apos; level=&apos;16&apos;</div><div class="line"> host_id=&apos;hzvscmdb&apos; host_addr=&apos;10.224.188.188&apos; module=&apos;sqlplus@hzvscmdb (TNS V1-V3)&apos;</div><div class="line"> pid=&apos;26632&apos;&gt;</div><div class="line"> &lt;txt&gt;Recovery of Online Redo Log: Thread 1 Group 2 Seq 12003 Reading mem 0</div><div class="line"> &lt;/txt&gt;</div><div class="line">&lt;/msg&gt;</div><div class="line">&lt;msg time=&apos;2015-12-28T08:22:36.165+00:00&apos; org_id=&apos;oracle&apos; comp_id=&apos;rdbms&apos;</div><div class="line"> client_id=&apos;&apos; type=&apos;UNKNOWN&apos; level=&apos;16&apos;</div><div class="line"> host_id=&apos;hzvscmdb&apos; host_addr=&apos;10.224.188.188&apos; module=&apos;sqlplus@hzvscmdb (TNS V1-V3)&apos;</div><div class="line"> pid=&apos;26632&apos;&gt;</div><div class="line"> &lt;txt&gt;  Mem# 0: /home/oracle/app/oracle/oradata/tonytest/redo02.log</div><div class="line"> &lt;/txt&gt;</div><div class="line">&lt;/msg&gt;</div><div class="line">&lt;msg time=&apos;2015-12-28T08:22:36.167+00:00&apos; org_id=&apos;oracle&apos; comp_id=&apos;rdbms&apos;</div><div class="line"> client_id=&apos;&apos; type=&apos;UNKNOWN&apos; level=&apos;16&apos;</div><div class="line"> host_id=&apos;hzvscmdb&apos; host_addr=&apos;10.224.188.188&apos; module=&apos;sqlplus@hzvscmdb (TNS V1-V3)&apos;</div><div class="line"> pid=&apos;26632&apos;&gt;</div><div class="line"> &lt;txt&gt;Completed redo application of 0.19MB</div><div class="line"> &lt;/txt&gt;</div><div class="line">&lt;/msg&gt;</div><div class="line">&lt;msg time=&apos;2015-12-28T08:22:36.267+00:00&apos; org_id=&apos;oracle&apos; comp_id=&apos;rdbms&apos;</div><div class="line"> client_id=&apos;&apos; type=&apos;UNKNOWN&apos; level=&apos;16&apos;</div><div class="line"> host_id=&apos;hzvscmdb&apos; host_addr=&apos;10.224.188.188&apos; module=&apos;sqlplus@hzvscmdb (TNS V1-V3)&apos;</div><div class="line"> pid=&apos;26632&apos;&gt;</div><div class="line"> &lt;txt&gt;Completed crash recovery at</div><div class="line"> &lt;/txt&gt;</div><div class="line">&lt;/msg&gt;</div><div class="line"></div><div class="line">select * from test_scn;</div><div class="line"></div><div class="line">        ID NAME</div><div class="line">---------- ----------</div><div class="line">         1 QA1</div><div class="line"></div><div class="line">#恢复实例完，数据库开启，SCN更新</div><div class="line">select file#,checkpoint_change#,last_change# from v$datafile;</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#    LAST_CHANGE#</div><div class="line">---------- ------------------ ---------------</div><div class="line">         1     11795798466013</div><div class="line">         2     11795798466013</div><div class="line">         3     11795798466013</div><div class="line">         4     11795798466013</div><div class="line">         5     11795798466013</div><div class="line">         6     11795798466013</div><div class="line">         7     11795798466013</div><div class="line">         8     11795798466013</div><div class="line">         9     11795798466013</div><div class="line">        10     11795798466013</div><div class="line">        11     11795798466013</div><div class="line"></div><div class="line">     FILE# CHECKPOINT_CHANGE#    LAST_CHANGE#</div><div class="line">---------- ------------------ ---------------</div><div class="line">        12     11795798466013</div><div class="line">        13     11795798466013</div><div class="line">        14     11795798466013</div><div class="line"></div><div class="line">select checkpoint_change# from v$database;</div><div class="line"></div><div class="line">CHECKPOINT_CHANGE#</div><div class="line">------------------</div><div class="line">    11795798466013</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[如何用github和hexo搭建自己的Blog]]></title>
      <url>http://wangbinbin0326.github.io/2016/10/20/%E5%A6%82%E4%BD%95%E7%94%A8github%E5%92%8Chexo%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84Blog/</url>
      <content type="html"><![CDATA[<h3 id="step-1-在github新建page"><a href="#step-1-在github新建page" class="headerlink" title="step 1. 在github新建page"></a>step 1. 在github新建page</h3><blockquote>
<ol>
<li><p>登录GitHub，注册自定义用户名如wangbinbin0326；</p>
</li>
<li><p>在主页右下角创建New repository，name必须和用户名一致如wangbinbin0326.github.io；</p>
</li>
<li><p>点击新建的repository（wangbinbin0326.github.io），然后点击<code>launch automatic page generator</code>，选择自己喜欢的page 模板，创建后10分钟左右可以访问。<a href="http://wangbinbin0326.github.io/">http://wangbinbin0326.github.io/</a> 此时访问的是默认模板在gh-pages 这个branch；</p>
</li>
</ol>
<p><strong>注意：</strong>我们需要修改这个branch，page 才可以显示我们hexo创建的博客， <code>wangbinbin0326.github.io ---&gt; setting ---&gt; GitHub Pages ---&gt; master branch</code>。</p>
</blockquote>
<hr>
<h3 id="step-2-安装Hexo"><a href="#step-2-安装Hexo" class="headerlink" title="step 2. 安装Hexo"></a>step 2. 安装Hexo</h3><blockquote>
<ul>
<li>安装准备：<blockquote>
<ul>
<li>系统 win7 64bit</li>
<li><a href="https://hexo.io/zh-cn/docs/index.html" target="_blank" rel="external">hexo 3.2.2</a></li>
<li><a href="https://nodejs.org/en/" target="_blank" rel="external">node.js</a> 安装完成后添加Path环境变量，使npm命令生效。新版已经会自动配置Path</li>
<li><a href="https://desktop.github.com/" target="_blank" rel="external">GitHub Windows</a></li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<a id="more"></a>
<blockquote>
<ul>
<li>安装Hexo</li>
</ul>
<blockquote>
<p>配置好GitHub window后，双击桌面上的Git Shell，输入npm命令即可安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">$ npm install hexo-cli -g</div><div class="line">hexo-util@0.6.0 postinstall C:\Users\binbiwan\AppData\Roaming\npm\node_modules\hexo-cli\node_modules\hexo-util</div><div class="line">npm run build:highlight</div><div class="line">C:\Users\binbiwan\AppData\Roaming\npm\hexo -&gt; C:\Users\binbiwan\AppData\Roaming\npm\node_modules\hexo-cli\bin\hexo</div><div class="line">hexo-cli@1.0.2 C:\Users\binbiwan\AppData\Roaming\npm\node_modules\hexo-cli</div><div class="line">├── object-assign@4.1.0</div><div class="line">├── abbrev@1.0.9</div><div class="line">├── minimist@1.2.0</div><div class="line">├── bluebird@3.4.6</div><div class="line">├── tildify@1.2.0 (os-homedir@1.0.2)</div><div class="line">├── chalk@1.1.3 (escape-string-regexp@1.0.5, supports-color@2.0.0, ansi-styles@2.2.1, strip-ansi@3.0.1, has-ansi@2.0.0)</div><div class="line">├── hexo-util@0.6.0 (html-entities@1.2.0, striptags@2.1.1, camel-case@3.0.0, cross-spawn@4.0.2, highlight.js@9.7.0)</div><div class="line">├── hexo-log@0.1.2 (bunyan@1.8.1)</div><div class="line">└── hexo-fs@0.1.6 (graceful-fs@4.1.9, escape-string-regexp@1.0.5, chokidar@1.6.0)</div><div class="line">──────────────────────────────────────────────────────────────────────────────────────────────</div><div class="line">$ npm install hexo --save</div><div class="line">├── swig@1.4.2 (optimist@0.6.1, uglify-js@2.4.24)</div><div class="line">├── hexo-log@0.1.2 (bunyan@1.8.1)</div><div class="line">├── nunjucks@2.5.2 (asap@2.0.5, yargs@3.32.0, chokidar@1.6.0)</div><div class="line">├── moment@2.13.0</div><div class="line">├── cheerio@0.20.0 (entities@1.1.1, dom-serializer@0.1.0, css-select@1.2.0, htmlparser2@3.8.3, jsdom@7.2.2)</div><div class="line">├── hexo-util@0.6.0 (striptags@2.1.1, html-entities@1.2.0, camel-case@3.0.0, cross-spawn@4.0.2, highlight.js@9.7.0)</div><div class="line">├── lodash@4.16.4</div><div class="line">└── warehouse@2.2.0 (graceful-fs@4.1.9, is-plain-object@2.0.1, JSONStream@1.2.1, cuid@1.3.8)</div><div class="line">&gt;</div></pre></td></tr></table></figure></p>
</blockquote>
<ul>
<li><p>安装Hexo插件git</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ npm install hexo-deployer-git --save</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>创建站点BlogHexo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ hexo init BlogHexo</div><div class="line">$ cd BlogHexo</div><div class="line">$ npm install</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>配置站点BlogHexo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">编辑站点BlogHexo目录下的_config.yml</div><div class="line">title: Tony Blog</div><div class="line">subtitle: 迈小步，不停步</div><div class="line">description: 终会有属于自己的一片天空！</div><div class="line">author: Tony Wang</div><div class="line">language: zh-Hans</div><div class="line">timezone:</div><div class="line">url: http://wangbinbin0326.github.io/</div><div class="line">theme: next</div><div class="line">deploy: </div><div class="line">  type: git</div><div class="line">  repo: https://github.com/wangbinbin0326/wangbinbin0326.github.io.git</div><div class="line">  branch: master</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>更改站点BlogHexo的主题<a href="http://theme-next.iissnan.com/getting-started.html" target="_blank" rel="external">NEXT</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$ pwd</div><div class="line">/c/git/BlogHexo/BlogHexo/themes</div><div class="line">git clone https://github.com/iissnan/hexo-theme-next themes/next</div><div class="line">$ mv hexo-theme-next next</div><div class="line">编辑NEXT主题目录下的配置文件_config.yml</div><div class="line">menu:</div><div class="line">  home: 注意这地有个空格符</div><div class="line">  archives: archives</div><div class="line">  tags: /tags</div><div class="line">  avatar: https://wangbinbin0326.github.io/images/job/myself.jpg</div><div class="line">auto_excerpt:</div><div class="line">  enable: true</div><div class="line">  length: 150</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>写Blog</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">$ hexo new post Oracle-DB-概述</div><div class="line">$ pwd</div><div class="line">/c/git/BlogHexo/BlogHexo/source/_posts</div><div class="line">$ ll</div><div class="line">-rw-r--r-- 1 binbiwan 1049089 3948 十月 13 01:15 Oracle-DB-概述.md</div><div class="line">编辑Oracle-DB-概述.md这个文件，使用Markdown格式</div><div class="line">$ hexo g</div><div class="line">$ hexo g</div><div class="line">INFO  Start processing</div><div class="line">INFO  Files loaded in 1.83 s</div><div class="line">INFO  Generated: archives/2016/index.html</div><div class="line">INFO  Generated: tags/DBA/index.html</div><div class="line">INFO  Generated: tags/Oracle/index.html</div><div class="line">INFO  Generated: index.html</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>查看blog</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ hexo s</div><div class="line">INFO  Start processing</div><div class="line">INFO  Hexo is running at http://localhost:4000/. Press Ctrl+C to stop.</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>提交Blog到github</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">──────────────────────────────────────────────────────────────────────────────────────────────</div><div class="line">1. 确保 git remote 是git@github.com, 这种方式连接</div><div class="line">$ git remote -v</div><div class="line">origin  git@github.com:wangbinbin0326/wangbinbin0326.github.io.git (fetch)</div><div class="line">origin  git@github.com:wangbinbin0326/wangbinbin0326.github.io.git (push)</div><div class="line">$ git remote remove origin</div><div class="line">git remote add origin git@github.com:wangbinbin0326/wangbinbin0326.github.io.git</div><div class="line">$ git remote -v</div><div class="line">origin  git@github.com:wangbinbin0326/wangbinbin0326.github.io.git (fetch)</div><div class="line">origin  git@github.com:wangbinbin0326/wangbinbin0326.github.io.git (push)</div><div class="line">──────────────────────────────────────────────────────────────────────────────────────────────</div><div class="line">2. 确保使用桌面上的github登录，会生成以下两个文件</div><div class="line">C:\Users\binbiwan\.ssh&gt; pwd</div><div class="line">C:\Users\binbiwan\.ssh</div><div class="line">C:\Users\binbiwan\.ssh&gt; ls</div><div class="line">    Directory: C:\Users\binbiwan\.ssh</div><div class="line">Mode                LastWriteTime     Length Name</div><div class="line">----                -------------     ------ ----</div><div class="line">-a---        2016/10/13     16:18       1679 github_rsa</div><div class="line">-a---        2016/10/13     16:18        405 github_rsa.pub</div><div class="line">──────────────────────────────────────────────────────────────────────────────────────────────</div><div class="line">3. 确保提交blog代码时，打开Git Shell运行，否则会报错如下错误，</div><div class="line">nothing to commit, working directory clean</div><div class="line">bash: /dev/tty: No such device or address</div><div class="line">error: failed to execute prompt script (exit code 1)</div><div class="line">fatal: could not read Username for &apos;https://github.com&apos;: Invalid argument</div><div class="line">FATAL Something&apos;s wrong. Maybe you can find the solution here: http://hexo.io/docs/troubleshooting.html</div><div class="line">Error: bash: /dev/tty: No such device or address</div><div class="line">error: failed to execute prompt script (exit code 1)</div><div class="line">fatal: could not read Username for &apos;https://github.com&apos;: Invalid argument</div><div class="line">C:\git\BlogHexo\BlogHexo [master +4 ~2 -1 !]&gt; hexo d</div><div class="line">INFO  Deploying: git</div><div class="line">INFO  Clearing .deploy_git folder...</div><div class="line">INFO  Copying files from public folder...</div><div class="line">warning: LF will be replaced by CRLF in 2016/10/11/DBA职责/index.html.</div><div class="line">The file will have its original line endings in your working directory.</div><div class="line">warning: LF will be replaced by CRLF in 2016/10/12/Oracle-DB-概述/index.html.</div><div class="line">The file will have its original line endings in your working directory.</div><div class="line">Branch master set up to track remote branch master from https://github.com/wangb</div><div class="line">inbin0326/wangbinbin0326.github.io.git.</div><div class="line">To https://github.com/wangbinbin0326/wangbinbin0326.github.io.git</div><div class="line">   f3b58e1..bb12b42  HEAD -&gt; master</div><div class="line">INFO  Deploy done: git</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>访问改地址<a href="http://wangbinbin0326.github.io/">wangbinbin0326.github.io</a><br><img src="https://wangbinbin0326.github.io/images/software/git-hexo-01.JPG" alt="此处输入图片的描述"></p>
</li>
</ul>
</blockquote>
<hr>
<h3 id="step-3-优化blog"><a href="#step-3-优化blog" class="headerlink" title="step 3. 优化blog"></a>step 3. 优化blog</h3><blockquote>
<ul>
<li>创建标签云页面</li>
</ul>
<blockquote>
<ul>
<li>新建一个页面，命名为 tags 。命令如下：<code>hexo new page &quot;tags&quot;</code></li>
<li>编辑刚新建的页面，将页面的类型设置为 tags ，主题将自动为这个页面显示标签云。<br><code>title: All tags
date: 2014-12-22 12:39:04
type: &quot;tags&quot;</code></li>
<li>在菜单中添加链接。编辑主题的 _config.yml ，添加 tags 到 menu 中，如下:<br><code>menu:
home: /
archives: /archives
tags: /tags</code></li>
</ul>
</blockquote>
<hr>
<ul>
<li>hexo next 添加分类页</li>
</ul>
<blockquote>
<ul>
<li>新建一个页面，命名为 categories 。命令如下：<code>hexo new page categories</code></li>
<li>编辑刚新建的页面，将页面的类型设置为 categories ，主题将自动为这个页面显示所有分类。<br><code>title: 分类
date: 2014-12-22 12:39:04
type: &quot;categories&quot;</code></li>
<li>在菜单中添加链接。编辑主题的 _config.yml ，将 menu 中的 categories: /categories 注释去掉，如下:<br><code>menu:
home: /
categories: /categories
archives: /archives
tags: /tags</code></li>
<li>hexo中有Front-matter这个概念，是文件最上方以 — 分隔的区域，用于指定个别文件的变量。举个栗子，在hexo new post article时会生成article.md文件，文件生成好的文章属性。在其中添加categories属性，再部署之后就可以在分类页看到分类了。<br><code>---
title: Oracle-DB-概述
date: 2016-10-12 17:12:40
tags: Oracle
categories: Database
---</code></li>
</ul>
</blockquote>
<hr>
<ul>
<li>hexo next 设置背景图片<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">将背景图片放到改目录下backgroud.jpg</div><div class="line">C:\git\BlogHexo\BlogHexo\themes\next\source\images</div><div class="line">编辑改文件</div><div class="line">C:\git\BlogHexo\BlogHexo\themes\next\source\css\_custom\custom.styl</div><div class="line">// Custom styles.</div><div class="line">body&#123;</div><div class="line">background-image:url(/images/backgroud.jpg);</div><div class="line">background-repeat: no-repeat;</div><div class="line">background-attachment:fixed;</div><div class="line">background-position:50% 50%; </div><div class="line">&#125;</div><div class="line">footer&#123;</div><div class="line">color: #eee;</div><div class="line">&#125;</div><div class="line">注：此方法push git 上，背景色无法显示，</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<hr>
<h3 id="step-4-运到的问题"><a href="#step-4-运到的问题" class="headerlink" title="step 4. 运到的问题"></a>step 4. 运到的问题</h3><blockquote>
<ul>
<li>TypeError: Cannot set property ‘lastIndex’ of undefined error, and error message as below<br><code>---
highlight:
enable: true
line_number: true
auto_detect: false   --true改为false
tab_replace:
---</code></li>
</ul>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Oracle-DB-内存结构]]></title>
      <url>http://wangbinbin0326.github.io/2016/10/13/Oracle-DB-%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/</url>
      <content type="html"><![CDATA[<h2 id="第二-Oracle-DB-内存结构"><a href="#第二-Oracle-DB-内存结构" class="headerlink" title="第二. Oracle DB 内存结构"></a>第二. Oracle DB 内存结构</h2><p><img src="http://img.my.csdn.net/uploads/201008/18/0_1282119950IIO1.gif" alt="此处输入图片的描述"></p>
<blockquote>
<p>一个实例有两个关联的基本内存结构：</p>
<ul>
<li><p><strong>系统全局区（SGA）</strong>: 称为SGA组件的共享内存结构组，这些组件包含一个Oracle DB实例的数据和控制信息。SGA由所有服务器和后台进程共享。SGA中存储的数据示例包括高速缓存的数据块和共享SQL区域。</p>
</li>
<li><p><strong>程序全局区（PGA）</strong>:包含某个服务器进程或后台进程的数据及控制信息的内存区域。PGA 是Oracle DB 在服务器进程或后台进程启动时创建的非共享内存。服务器进程对<br>PGA 的访问是互斥的。每个服务器进程和后台进程都具有自己的PGA。</p>
</li>
</ul>
</blockquote>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">SQL&gt; show parameter sga;</div><div class="line"></div><div class="line">NAME                                 TYPE        VALUE</div><div class="line">------------------------------------ ----------- ------------------------------</div><div class="line">lock_sga                             boolean     FALSE</div><div class="line">pre_page_sga                         boolean     FALSE</div><div class="line">sga_max_size                         big integer 6432M</div><div class="line">sga_target                           big integer 0</div><div class="line"></div><div class="line"></div><div class="line">SQL&gt; show parameter pga;</div><div class="line"></div><div class="line">NAME                                 TYPE        VALUE</div><div class="line">------------------------------------ ----------- ------------------------------</div><div class="line">pga_aggregate_target                 big integer 0</div></pre></td></tr></table></figure>
<hr>
<blockquote>
<p>SGA包含的数据结构：</p>
<ul>
<li><strong>数据库缓冲区高速缓存：</strong>用于缓存从数据库中检索到的数据块</li>
<li><strong>重做日志缓冲区：</strong>用来缓存用于实例恢复的重做信息，直到可以将其写入磁盘中存储的物理重做日志文件</li>
<li><strong>共享池：</strong>用于缓存可在用户间共享的各种结构</li>
<li><strong>大型池：</strong>为某些大型进程（例如Oracle 备份和恢复操作）和I/O 服务器进程提供大型内存分配的可选区域。</li>
<li><strong>Java 池：</strong>用于Java 虚拟机(JVM) 中特定于会话的所有Java 代码和数据</li>
<li><strong>流池：</strong> Oracle Streams 使用它来存储捕获和应用操作所需的信息</li>
</ul>
<p>程序全局区(PGA)是一个内存区，其中包含每个服务器进程的数据及控制信息。Oracle 服务器进程为客户机请求提供服务。每个服务器进程都有自己专用的PGA，其PGA 在服务器进程启动时创建，对PGA的访问权限仅限于该服务器进程，并且只能由代表该服务器进程的Oracle 代码对PGA 进行读写。</p>
<p>Oracle DB 使用初始化参数来创建和管理内存结构。管理内存的最简单的方法是允许数据库自动管理和优化内存。要做到这一点（以下操作适用于大多数平台），您只需设置目标内存大小初始化参数(<strong>MEMORY_TARGET</strong>)和最大内存大小初始化参数 (<strong>MEMORY_MAX_TARGET</strong>)。</p>
</blockquote>
<hr>
<h3 id="1-数据库缓冲区高速缓存"><a href="#1-数据库缓冲区高速缓存" class="headerlink" title="1. 数据库缓冲区高速缓存"></a>1. 数据库缓冲区高速缓存</h3><blockquote>
<ul>
<li>属于SGA</li>
<li>存放从数据文件读取的数据块的副本</li>
<li>由所有并行用户共享</li>
</ul>
<p>Oracle DB 用户进程第一次需要特定数据片段时，将在数据库缓冲区高速缓存中搜索数据。如果该进程在高速缓存中找到数据（称为高速缓存命中），则直接从内存中读取数据。如果进程在高速缓存中找不到数据（称为高速缓存未命中），则在访问数据之前，必须将磁盘上的数据文件中的数据块复制到高速缓存中的缓冲区中。高速缓存命中时访问数据要比高速缓存未命中时访问数据快。</p>
<p>高速缓存中的缓冲区由一个复杂算法管理，该算法组合使用最近最少使用(LRU) 列表和停靠计数机制。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="number">1</span> - (phy.VALUE / (cur.VALUE + con.VALUE)) <span class="string">"CACHE HIT RATIO"</span></div><div class="line">  <span class="keyword">from</span> v$sysstat cur, v$sysstat con, v$sysstat phy</div><div class="line"> <span class="keyword">where</span>     cur.name = <span class="string">'db block gets'</span></div><div class="line">       <span class="keyword">AND</span> con.name = <span class="string">'consistent gets'</span></div><div class="line">       <span class="keyword">AND</span> phy.name = <span class="string">'physical reads'</span>;</div><div class="line"></div><div class="line"><span class="comment">-- 运行结果</span></div><div class="line"><span class="comment">-- 0.993163842486823</span></div></pre></td></tr></table></figure>
<hr>
<h3 id="2-重做日志缓冲区"><a href="#2-重做日志缓冲区" class="headerlink" title="2. 重做日志缓冲区"></a>2. 重做日志缓冲区</h3><blockquote>
<ul>
<li>它是SGA中的循环缓冲区</li>
<li>存放有关对数据库所做更改的信息</li>
<li>包含重做条目，这些条目包含有DML和DDL等操作进行的重做更改的相关信息</li>
</ul>
<p>重做日志缓冲区是SGA 中的循环缓冲区，用于存放有关对数据库所做更改的信息。此信<br>息存储在重做条目中。重做条目包含重建（或重做）由DML、DDL 或内部操作对数据库<br>进行的更改所需的信息。如果需要，将使用重做条目进行数据库恢复。</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">#利用下列sql语句在sql语句执行前后取差值即为此session产生的redo</div><div class="line">select name, value</div><div class="line">from v$mystat a, v$statname b</div><div class="line">where a.statistic# = b.statistic#</div><div class="line">  and b.name = 'redo size';</div><div class="line"></div><div class="line">NAME                      VALUE</div><div class="line">-------------------- ----------</div><div class="line">redo size                   764</div><div class="line"></div><div class="line">SQL&gt; insert into emp3 values(5,'n5', 55);</div><div class="line"></div><div class="line">1 row created.</div><div class="line"></div><div class="line">select name, value</div><div class="line">from v$mystat a, v$statname b</div><div class="line">where a.statistic# = b.statistic#</div><div class="line">  and b.name = 'redo size';</div><div class="line"></div><div class="line">NAME                      VALUE</div><div class="line">-------------------- ----------</div><div class="line">redo size                   764</div><div class="line"></div><div class="line">SQL&gt; commit;</div><div class="line"></div><div class="line">Commit complete.</div><div class="line"></div><div class="line">select name, value</div><div class="line">from v$mystat a, v$statname b</div><div class="line">where a.statistic# = b.statistic#</div><div class="line">  and b.name = 'redo size';</div><div class="line"></div><div class="line">NAME                      VALUE</div><div class="line">-------------------- ----------</div><div class="line">redo size                  1764</div><div class="line"></div><div class="line">SQL&gt; delete from emp3 where emp3_id = 5;</div><div class="line"></div><div class="line">1 row deleted.</div><div class="line"></div><div class="line">select name, value</div><div class="line">from v$mystat a, v$statname b</div><div class="line">where a.statistic# = b.statistic#</div><div class="line">  and b.name = 'redo size';</div><div class="line"></div><div class="line">NAME                      VALUE</div><div class="line">-------------------- ----------</div><div class="line">redo size                  1952</div><div class="line"></div><div class="line">SQL&gt; commit;</div><div class="line"></div><div class="line">Commit complete.</div><div class="line"></div><div class="line">select name, value</div><div class="line">from v$mystat a, v$statname b</div><div class="line">where a.statistic# = b.statistic#</div><div class="line">  and b.name = 'redo size';</div><div class="line"></div><div class="line">NAME                      VALUE</div><div class="line">-------------------- ----------</div><div class="line">redo size                  2928</div></pre></td></tr></table></figure>
<hr>
<h3 id="3-共享池"><a href="#3-共享池" class="headerlink" title="3. 共享池"></a>3. 共享池</h3><blockquote>
<ul>
<li>属于SGA</li>
<li>包含：<br>–库高速缓存<br>—-共享SQL 区域<br>–数据字典高速缓存<br>–控制结构</li>
</ul>
</blockquote>
<hr>
<blockquote>
<p>SGA 的共享池部分包含库高速缓存、数据字典高速缓存、SQL查询结果高速缓存、PL/SQL 函数结果高速缓存、并行执行消息的缓冲区以及控制结构。</p>
<p><strong>“数据字典”</strong>是数据库表和视图（它们包含有关数据库、数据库结构及其用户的参考信息）的集合。在SQL 语句语法分析期间，Oracle DB会频繁访问数据字典。该访问操作对于Oracle DB 的持续操作来说至关重要。</p>
</blockquote>
<hr>
<blockquote>
<p>分配和重用共享池中的内存</p>
<ul>
<li>服务器进程检查共享池以查看相同语句是否已存在共享SQL 区域。</li>
<li>服务器进程分配一个代表会话的专用SQL 区域。</li>
</ul>
<p>将SQL 语句提交到Oracle DB以便执行时，将自动执行下列内存分配步骤：</p>
<ul>
<li><p>Oracle DB 检查共享池以查看相同语句是否已存在共享SQL 区域。如果存在，则在执行该语句的后续新实例时使用此共享SQL 区域。如果某条语句没有共享SQL 区域，则Oracle DB 会在共享池中分配一个新的共享SQL 区域。在以上任一情况下，用户的专用SQL 区域都与包含该语句的共享SQL 区域关联。</p>
</li>
<li><p>Oracle DB 分配一个代表会话的专用SQL 区域。该专用SQL 区域的位置取决于为会话建立的连接的类型。</p>
</li>
</ul>
</blockquote>
<p>在以下情况下，Oracle DB 也会从共享池中刷新共享SQL 区域：</p>
<p><img src="http://images.51cto.com/files/uploadimg/20120511/090649172.jpg" alt="此处输入图片的描述"></p>
<blockquote>
<p><strong>V\$SQL、V\$SQLTEXT、V\$SQLAREA与V\$SQL_PLAN</strong></p>
<hr>
<ul>
<li><strong>V$SQL</strong>是共享池中已经分析过的SQL，其中列出了所有SQL的相关信息，但不包含GROUP BY语句，每一个SQL语句都是一笔数据，但此记录只保留SQL语句的前1000个字符。</li>
</ul>
<ul>
<li><p><strong>V\$SQLAREA</strong> 中记录了在共享池中分析过的每个SQL语句和准备运行的SQL语句的统计数据，和V$SQL一样只保留SQL的前1000个字符。</p>
</li>
<li><p><strong>V\$SQLTEXT</strong> 视图会记录完整的SQL，但会将SQL分成不同笔的数据来存储。</p>
</li>
<li><p><strong>V\$SQL_PLAN</strong>视图包含了库缓存中所有游标所产生的执行计划，可结合V$SQLAREA获得库缓存中所有语句的查询计划。</p>
</li>
</ul>
</blockquote>
<hr>
<h3 id="4-大型池"><a href="#4-大型池" class="headerlink" title="4. 大型池"></a>4. 大型池</h3><blockquote>
<ul>
<li>共享服务器的会话内存和Oracle XA接口</li>
<li>I/O服务器进程</li>
<li>Oracle DB 备份和还原操作</li>
</ul>
</blockquote>
<hr>
<h3 id="5-Java池和流池"><a href="#5-Java池和流池" class="headerlink" title="5. Java池和流池"></a>5. Java池和流池</h3><blockquote>
<ul>
<li>存储JVM 中所有特定于会话的Java 代码和数据的服务<br>器内存使用Java 池内存。</li>
<li>Oracle Streams 以独占方式使用流池内存来执行以下<br>操作：<br>存储缓冲的队列消息<br>为Oracle Streams 进程提供内存Java</li>
</ul>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Oracle-DB-概述]]></title>
      <url>http://wangbinbin0326.github.io/2016/10/12/Oracle-DB-%E6%A6%82%E8%BF%B0/</url>
      <content type="html"><![CDATA[<hr>
<h2 id="第一-Oracle-DB-概述"><a href="#第一-Oracle-DB-概述" class="headerlink" title="第一. Oracle DB 概述"></a>第一. Oracle DB 概述</h2><hr>
<h3 id="1-Oracle-DB"><a href="#1-Oracle-DB" class="headerlink" title="1. Oracle DB"></a>1. Oracle DB</h3><blockquote>
<p>Oracle DB 数据库是被视为单元的数据的集合，其用途是存储和检索相关信息。</p>
<p>Oracle DB 能够可靠地管理多用户环境中的大量数据，从而支持许多用户并行访问相同的数据。实现此功能的同时还可以保持较高的性能。同时，它可以阻止未授权的访问，并且为故障恢复提供有效的解决方案。</p>
</blockquote>
<hr>
<h3 id="2-连接到服务器"><a href="#2-连接到服务器" class="headerlink" title="2. 连接到服务器"></a>2. 连接到服务器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">客户机 &lt; ---- &gt; 中间层 &lt; ---- &gt; 服务器</div></pre></td></tr></table></figure>
<blockquote>
<p>数据库用户连接到Oracle服务器</p>
<ul>
<li>用户登录到运行Oracle实例的操作系统，如sqlplus 工具。</li>
<li>用户可以启动本地计算机上的应用程序或工具(客户端/服务器)，如toad, plsql</li>
<li>用户通过本地计算机上的工具（web/服务器），如web浏览器</li>
</ul>
</blockquote>
<hr>
<h3 id="3-体系结构概述"><a href="#3-体系结构概述" class="headerlink" title="3. 体系结构概述"></a>3. 体系结构概述</h3><p><img src="http://www.rjkfw.com/upload/1387509627.png" alt="此处输入图片的描述"></p>
<a id="more"></a>
<blockquote>
<p>Oracle DB 服务器由（一个Oracle DB）和（一个或多个数据库实例）组成。</p>
<ul>
<li><p>实例由（内存结构）和（后台进程）构成。每当启动一个实例时，都会分配一个称为系统全局区（SGA）的共享内存区，并启动后台进程。</p>
</li>
<li><p>数据库包括（物理结构）和（逻辑结构）。由于物理结构和逻辑结构是分开的，因此管理数据的物理存储时不会影响对逻辑存储结构的访问。</p>
</li>
</ul>
</blockquote>
<hr>
<h3 id="4-连接到数据库"><a href="#4-连接到数据库" class="headerlink" title="4. 连接到数据库"></a>4. 连接到数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">用户 &lt;---&gt; SQL&gt; select &lt;---&gt; 用户进程  &lt;---&gt; 服务进程  &lt;---&gt; 数据库</div><div class="line">                                |&lt;----连接------&gt;|</div><div class="line">  |&lt;-------------------------会话----------------------------&gt;|</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>连接：用户进程和实例之间的通信</li>
<li>会话：用户通过用户进程与实例建立的特定连接</li>
</ul>
</blockquote>
<hr>
<h3 id="5-与Oracle-DB交互"><a href="#5-与Oracle-DB交互" class="headerlink" title="5. 与Oracle DB交互"></a>5. 与Oracle DB交互</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">用户（SQL&gt; select） &lt;---&gt; 用户进程  &lt;---&gt; 服务进程  &lt;---&gt; 实例&lt;---&gt; 数据库</div></pre></td></tr></table></figure>
<blockquote>
<ol>
<li><p>在安装了Oracle DB的节点（通常称为“主机”或“数据库服务器”）上启动了一个实例。</p>
</li>
<li><p>用户启动一个应用程序，该应用程序衍生了一个用户进程。该应用程序尝试建立一个与服务器的连接（此连接可能是本地连接、客户机/服务器连接或者来自中间层的三层连接）。</p>
</li>
<li><p>服务器运行具有相应Oracle Net Services处理程序的监听程序。监听程序检查到应用程序发出的连接请求，并创建一个代表用户进程的专用服务器进程。</p>
</li>
<li><p>用户运行一条DML类型的SQL语句并提交事务处理。</p>
</li>
<li><p>服务器进程接受该语句，并检查共享池（一个SGA组件）中是否有包含相同SQL语句的共享SQL区域。如果找到共享SQL区域，服务器进程将检查用户对于所请求数据的访问权限，并且使用现有的共享SQL区域处理该语句。如果未找到共享SQL区域，则为该语句分配一个新的共享SQL区域，以便对该语句进行语法分析和处理。</p>
</li>
<li><p>服务器进程从实际数据文件（表）或数据库缓冲区高速缓存中存储的值中检索任何必需的数据值。</p>
</li>
<li><p>服务器进程修改SGA中的数据。因为提交了事务处理，所以日志写进程（LGWR）会立即将该事务处理记录到重做日志文件中。数据库写进程（DBWn）会待执行效率高时将修改后的块永久写入磁盘。</p>
</li>
<li><p>如果事务处理成功，服务器进程将通过网络向应用程序发送一条消息。如果事务处理不成功，则传送一条错误消息。</p>
</li>
<li><p>在整个过程中，其它后台进程同时在运行，用于监视是否有需要干预的情况。此外，数据库服务器管理其他用户的事务处理，并防止在请求相同数据的事务处理之间发生争用。</p>
</li>
</ol>
</blockquote>
<hr>
<h3 id="6-Oracle-DB服务器结构"><a href="#6-Oracle-DB服务器结构" class="headerlink" title="6. Oracle DB服务器结构"></a>6. Oracle DB服务器结构</h3><blockquote>
<ul>
<li>内存结构</li>
<li>进程</li>
<li>存储结构</li>
</ul>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[DBA职责]]></title>
      <url>http://wangbinbin0326.github.io/2016/10/11/DBA%E8%81%8C%E8%B4%A3/</url>
      <content type="html"><![CDATA[<h2 id="题目2-DBA-职责及日常工作职责"><a href="#题目2-DBA-职责及日常工作职责" class="headerlink" title="题目2, DBA 职责及日常工作职责"></a>题目2, DBA 职责及日常工作职责</h2><h3 id="2-1-工作职责"><a href="#2-1-工作职责" class="headerlink" title="2.1 工作职责"></a>2.1 工作职责</h3><p>1.安装和升级数据库服务器,以及应用程序工具构建和配置网络环境.</p>
<p>2.熟悉数据库系统的存储结构预测未来的存储需求,制订数据库的存储方案.</p>
<p>3.根据开发人员设计的应用系统需求创建数据库存储结构.</p>
<p>4.根据开发人员设计的应用系统需求创建数据库对象</p>
<p>5.根据开发人员的反馈信息,在必要的时候修改数据库的结构</p>
<p>6.管理数据库的用户维护数据库的安全性</p>
<p>7.控制和监控用户对数据库的存取访问</p>
<p>8.监控和优化数据库的性能</p>
<p>9.制定数据库备份计划,灾难出现时对数据库信息进行恢复</p>
<p>10.备份和恢复数据库</p>
<p>11.联系数据库系统生产厂商,跟踪技术信息</p>
<p>12.解决客户端中间层和服务器的链接问题</p>
<p>13.保证安全连接</p>
<a id="more"></a>
<h3 id="2-2-每日工作"><a href="#2-2-每日工作" class="headerlink" title="2.2 每日工作"></a>2.2 每日工作</h3><p>1 确保服务器工作状态正常,各类数据库状态正常</p>
<p>2 检查硬盘空间是否够用</p>
<p>3 查看数据库日志,查看跟踪文件,检查是否有错误信息</p>
<p>4 检查备份的有效性</p>
<p>5 通过系统的性能监视器对服务器的性能参数监控发现数据库的性能是否下降,寻找原因并解决</p>
<p>6 填写dba日志</p>
<h3 id="2-3-每周工作"><a href="#2-3-每周工作" class="headerlink" title="2.3 每周工作"></a>2.3 每周工作</h3><p>1 监控数据库对象的空间扩展情况</p>
<p>2 决定是否调整存储参数</p>
<p>3 对系统健康检查</p>
<p>4 检查删除没有任何意义的数据对象</p>
<p>5 检查删除没有意义的约束和触发器</p>
<p>6 对每周的备份检查处理</p>
<h3 id="2-4-每月工作"><a href="#2-4-每月工作" class="headerlink" title="2.4 每月工作"></a>2.4 每月工作</h3><p>1 根据上面的检查情况,分析数据库中是否有影响性能的存储碎片存在</p>
<p>2 根据数据库性能的历史数据,决定如何优化性能</p>
<p>3 处理每日每周每月的备份</p>
<p>4 总结工作,提出下一步的管理计划</p>
<h3 id="2-5-Oracle-DBA职责实例"><a href="#2-5-Oracle-DBA职责实例" class="headerlink" title="2.5 Oracle DBA职责实例"></a>2.5 Oracle DBA职责实例</h3><p>1 每天对Oracle数据库的运行状态、日志文件、备份情况、数据库空间使用情况、系统资源使用情况进行检查，发现并解决问题。</p>
<p>2 每周对数据库对象的空间扩展情况、数据的增长情况进行监控、对数据库做健康检查、对数据库对象的状态做检查。</p>
<p>3 每月对表和索引等进行analyze、检查表空间碎片、寻找数据库性能调整的机会、进行数据库性能调整、提出下一步空间管理计划。对Oracle数据库状态进行一次全面检查。</p>
<hr>
<p>具体的操作如下：</p>
<p>每天工作</p>
<p>1、确认所有的instance状态正常登录到所有数据库或实例，检测Oracle后台进程：<code>#ps -ef | grep ora</code></p>
<p>2、检查文件系统的使用（剩余空间）。如果文件系统的剩余空间小于20%，需删除不用的文件以释放空间。<code>#df -k</code></p>
<p>3、检查日志文件和trace文件记录alert和trace文件中的错误。 <code>cd $Oracle_BASE/oradata/&lt;sid&gt;/bdump tail -f alert_&lt;sid&gt;.log</code>发现任何新的ORA_错误，记录并解决。</p>
<p>4、检查数据库当日备份的有效性<br> 对RMAN备份方式，检查第三方备份工具的备份日志以确定备份是否成功<br> 对EXPORT备份方式，检查exp日志文件以确定备份是否成功<br> 对其它备份方式，检查相应的日志文件</p>
<p>5、检查数据文件的状态记录状态不是“online”的数据文件，并做恢复。<br><code>select file_name from dba_data_files where status=&quot;OFFLINE&quot;</code></p>
<p>6、检查表空间的使用情况</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> a.tablespace_name,<span class="keyword">round</span>((total-free)/total,<span class="number">3</span>)*<span class="number">100</span> pecent </div><div class="line">    <span class="keyword">from</span> (<span class="keyword">select</span> tablespace_name,<span class="keyword">sum</span>(<span class="keyword">bytes</span>) free <span class="keyword">from</span> dba_free_space <span class="keyword">group</span> <span class="keyword">by</span> tablespace_name) a,</div><div class="line">         (<span class="keyword">select</span> tablespace_name,<span class="keyword">sum</span>(<span class="keyword">bytes</span>) total <span class="keyword">from</span> dba_data_files <span class="keyword">group</span> <span class="keyword">by</span> tablespace_name) b </div><div class="line">    <span class="keyword">where</span> a.tablespace_name=b.tablespace_name;</div></pre></td></tr></table></figure>
<figure class="highlight sql"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">alert('Hello World!');</div><div class="line"></div><div class="line"><span class="keyword">select</span> a.tablespace_name,<span class="keyword">round</span>((total-free)/total,<span class="number">3</span>)*<span class="number">100</span> pecent </div><div class="line">    <span class="keyword">from</span> (<span class="keyword">select</span> tablespace_name,<span class="keyword">sum</span>(<span class="keyword">bytes</span>) free <span class="keyword">from</span> dba_free_space <span class="keyword">group</span> <span class="keyword">by</span> tablespace_name) a,</div><div class="line">         (<span class="keyword">select</span> tablespace_name,<span class="keyword">sum</span>(<span class="keyword">bytes</span>) total <span class="keyword">from</span> dba_data_files <span class="keyword">group</span> <span class="keyword">by</span> tablespace_name) b </div><div class="line">    <span class="keyword">where</span> a.tablespace_name=b.tablespace_name;</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
  
  
</search>
